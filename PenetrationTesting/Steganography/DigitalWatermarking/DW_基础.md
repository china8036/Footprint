- [数字水印：基础概念](#数字水印基础概念)
  - [1. 发展历史](#1-发展历史)
  - [2. 特性](#2-特性)
  - [3. 分类](#3-分类)
    - [3.1. 按特性划分](#31-按特性划分)
    - [3.2. 按附载媒体划分](#32-按附载媒体划分)
    - [3.3. 按检测过程划分](#33-按检测过程划分)
    - [3.4. 按内容划分](#34-按内容划分)
    - [3.5. 按用途划分](#35-按用途划分)
    - [3.6. 按透明性划分](#36-按透明性划分)
    - [3.7. 按隐藏位置划分](#37-按隐藏位置划分)
  - [4. 应用场景](#4-应用场景)
  - [5. 水印算法](#5-水印算法)
    - [5.1. 空间域（时间域）算法 / LSB 算法](#51-空间域时间域算法--lsb-算法)
    - [5.2. 频域算法](#52-频域算法)
      - [5.2.1. 基于离散余弦变换 (DCT)](#521-基于离散余弦变换-dct)
      - [5.2.2. 基于离散小波变换](#522-基于离散小波变换)
    - [5.3. 其他算法](#53-其他算法)
      - [5.3.1. Patchwork 算法](#531-patchwork-算法)
      - [5.3.2. 压缩域算法](#532-压缩域算法)
      - [5.3.3. NEC 算法](#533-nec-算法)
      - [5.3.4. 生理模型算法](#534-生理模型算法)
  - [6. Refer Links](#6-refer-links)

# 数字水印：基础概念

数字水印（Digital Watermarking）技术是将一些标识信息（即数字水印）直接嵌入数字载体当中（包括多媒体、文档、软件等）或是间接表示（修改特定区域的结构），且不影响原载体的使用价值，也不容易被探知和再次修改。但可以被生产方识别和辨认。通过这些隐藏在载体中的信息，可以达到确认内容创建者、购买者、传送隐秘信息或者判断载体是否被篡改等目的。数字水印是保护信息安全、实现防伪溯源、版权保护的有效办法，是信息隐藏技术研究领域的重要分支和研究方向。

## 1. 发展历史

数字水印技术是从信息隐藏技术发展而来的，是数字信号处理，图像处理，密码学应用，算法设计等学科的交叉领域。数字水印最早在 1993 年由 Tirkel 等人提出，在国际学术会议上发表题为“Electronic watermark”的第一篇有关水印的文章，提出了数字水印的概念及可能的应用，并针对灰度图像提出了两种向图像最低有效位中嵌入水印的算法。1996 年在英国剑桥牛顿研究所召开了第一届国际信息隐藏学术研讨会，标志着信息隐藏学的诞生。

## 2. 特性

数字水印系统必须满足一些特定的条件才能使其在数字产品版权保护和完整性鉴定方面成为值得信赖的应用体系。因此，一个安全可靠的数字水印系统一般应满足如下特性：

- 安全性 (Security)：数字水印的信息应是安全的，难以篡改或伪造，同时，应当有较低的误检测率，当原内容发生变化时，数字水印应当发生变化，从而可以检测原始数据的变更；当然数字水印同样对重复添加有很强的抵抗性。

- 隐蔽性 (Invisibility)：数字水印应是不可知觉的，而且应不影响被保护数据的正常使用；不会降质。

- 鲁棒性 (Robustness)：该特性适用于鲁棒水印。是指在经历多种无意或有意的信号处理过程后，数字水印仍能保持部分完整性并能被准确鉴别。可能的信号处理过程包括信道噪声、滤波、数 / 模与模 / 数转换、重采样、剪切、位移、尺度变化以及有损压缩编码等。

- 敏感性 (Sensitivity)：该特性适用于脆弱水印。是经过分发、传输、使用过程后，数字水印能够准确的判断数据是否遭受篡改。进一步的，可判断数据篡改位置、程度甚至恢复原始信息。

## 3. 分类

### 3.1. 按特性划分

按水印的特性可以将数字水印分为鲁棒数字水印和脆弱数字水印两类。

- **鲁棒水印** (Robust Watermarking) **主要用于在数字作品中标识著作权信息**，利用这种水印技术在多媒体内容的数据中嵌入创建者、所有者的标示信息，或者嵌入购买者的标示（即序列号）。在发生版权纠纷时，创建者或所有者的信息用于标示数据的版权所有者，而序列号用于追踪违反协议而为盗版提供多媒体数据的用户。用于版权保护的数字水印要求有很强的鲁棒性和安全性，除了要求在一般图像处理（如：滤波、加噪声、替换、压缩等）中生存外，还需能抵抗一些恶意攻击。

- **脆弱水印** (Fragile Watermarking) 与鲁棒水印的要求相反，脆弱数字水印**主要用于完整性保护和认证**，这种水印同样是在内容数据中嵌入不可见的信息。当内容发生改变时，这些水印信息会发生相应的改变，从而可以鉴定原始数据是否被篡改。根据脆弱水印的应用范围，脆弱水印又可分为选择性和非选择性脆弱水印：
  - 非选择性脆弱水印能够鉴别出比特位的任意变化。
  - 选择性脆弱水印能够根据应用范围选择对某些变化敏感。
  例如，图像的选择性脆弱水印可以实现对同一幅图像的不同格式转换不敏感，而对图像内容本身的处理（如：滤波、加噪声、替换、压缩等）又有较强的敏感性，即：既允许一定程度的失真，又要能将特定的失真情况探测出来。

### 3.2. 按附载媒体划分

按水印所附载的媒体，我们可以将数字水印划分为：
- **图像水印**
- **音频水印**
- **视频水印**
- **文本水印**
- **网格水印**（用于三维网格模型）

随着数字技术的发展，会有更多种类的数字媒体出现，同时也会产生相应的水印技术。

### 3.3. 按检测过程划分

按水印的检测过程可以将数字水印划分为盲水印和非盲水印。

- **盲水印**的检测不需要任何原始数据和辅助信息。盲水印的实用性强，应用范围广。

- **非盲水印**在检测过程中需要原始数据或者预留信息。一般来说，非盲水印的鲁棒性比较强，但其应用需要原始数据的辅助而受到限制。

- **半盲水印**：非盲水印中，新出现的半盲水印能够以少量的存储代价换来更低的误检率、漏检率，提高水印算法的性能。

目前学术界研究的数字水印大多数是盲水印或者半盲水印。

### 3.4. 按内容划分

按数字水印的内容可以将水印划分为有意义水印和无意义水印。

- **有意义水印**是指水印本身也是某个数字图像（如商标图像）或数字音频片段的编码。有意义水印的优势在于，如果由于受到攻击或其他原因致使解码后的水印破损，人们仍然可以通过视觉观察确认是否有水印。

- **无意义水印**则只对应于一个序列。对于无意义水印来说，如果解码后的水印序列有若干码元错误，则只能通过统计决策来确定信号中是否含有水印。

### 3.5. 按用途划分

不同的应用需求造就了不同的水印技术。按水印的用途，我们可以将数字水印划分为票证防伪水印、版权保护水印、篡改提示水印和隐蔽标识水印。

- **票证防伪水印**是一类比较特殊的水印，主要用于打印票据和电子票据、各种证件的防伪。一般来说，伪币的制造者不可能对票据图像进行过多的修改，所以，诸如尺度变换等信号编辑操作是不用考虑的。但另一方面，人们必须考虑票据破损、图案模糊等情形，而且考虑到快速检测的要求，用于票证防伪的数字水印算法不能太复杂。

- **版权标识水印**是目前研究最多的一类数字水印。数字作品既是商品又是知识作品，这种双重性决定了版权标识水印主要强调隐蔽性和鲁棒性，而对数据量的要求相对较小。

- **篡改提示水印**是一种脆弱水印，其目的是标识原文件信号的完整性和真实性。

- **隐蔽标识水印**的目的是将保密数据的重要标注隐藏起来，限制非法用户对保密数据的使用。

### 3.6. 按透明性划分

按数字水印是否透明的性质，可分为可见水印和不可见水印两种。

- **可见水印**就是人眼能看见的水印，比如照片上标记的拍照的日期或者电视频道上的标识等。

- **不可见水印**就是人类视觉系统难以感知的，也是当前数字水印领域关注比较多的。

### 3.7. 按隐藏位置划分

TODO:

按数字水印的隐藏位置，我们可以将其划分为时（空）域数字水印、频域数字水印、时 / 频域数字水印和时间 / 尺度域数字水印。

- **时域数字水印**是直接在信号空间上叠加水印信息。

- **频域数字水印**在 DCT 变换域上隐藏水印。

- **时 / 频域数字水印**在时 / 频变换域上隐藏水印。

- **时间 / 尺度域数字水印**在小波变换域上隐藏水印。

随着数字水印技术的发展，各种水印算法层出不穷，水印的隐藏位置也不再局限于上述四种。应该说，**只要构成一种信号变换，就有可能在其变换空间上隐藏水印**。

## 4. 应用场景

随着数字水印技术的发展，数字水印的应用领域也得到了扩展，数字水印的基本应用领域是防伪溯源、版权保护、隐藏标识、认证和安全隐蔽通信。

- 多媒体作品知识产权保护：利用数字水印的不可见性，在不影响作品的情况下，加入版权信息的数字水印，可抗击拷贝，剪切。

- 证件的防伪认证：如学历证，合同，票据等，携带数字水印后，可通过制定的方式提取水印，验证证件等数字文件是否被涂改。

- 隐蔽信息传递：水印可携带加密信息后，藏在多媒体文件中传播，并通过特定的提取方式获取水印。可以作为一种隐蔽信息的通信方式。
  - e.g. 阿里事件：阿里追查泄密员工的时间本身，说明，水印可以有效的追溯信息的释放源。

## 5. 水印算法

### 5.1. 空间域（时间域）算法 / LSB 算法

早期的数字水印研究主要是在空间域中，在空间域中进行操作的算法称为空域算法，LSB 算法是空域水印算法中最常用、最容易实现的方法。

LSB 算法利用了图像的容噪性，即图像中每个像素的 LSB 对人眼的视觉影响很小。以灰阶图为例，每个 pixel 一般是以八个比特位来表示，且由最高有效位（MSB）开始向右排列至最低有效位（LSB），每一位的重要性逐渐降低，因此可通过更改每个 pixel 中敏感度最低的 LSB 来嵌入数字水印信息。

由于使用了图像不重要的像素位，LSB 算法的缺点是鲁棒性差，容易被滤波、图像量化、几何变形的操作破坏。

通过优化信息的嵌入位置（如利用像素的统计特征将信息嵌入像素的亮度值中），能够降低对图片的污染，影响图片质量；同时能够释放更多的图片边缘位置，从而携带更多的隐藏信息。

LSB 基础实现：http://www.jianshu.com/p/8a89b6ba5e39

LSB 优化实现：https://github.com/Lixinyi-DUT/graduation-project/blob/master/%E7%BF%BB%E8%AF%91/

### 5.2. 频域算法

将图片的灰度强弱，视为图片的频域。频域算法通过某种变换手段（离散傅里叶变换、离散余弦变换、离散小波变换等）将图像变换到频域，在频域对图像添加水印，再通过逆变换，将图像转换为空间域。**相对于空域算法，频域手段隐匿性更强，抗攻击性更高**。

将水印信息嵌入到不同频率的信号中可满足不同需求：
- 当嵌入至高频信号，较不容易被人眼视觉系统所察觉。
- 当嵌入至低频信号，由于能量较高因而不容易被破坏。

该类算法大部分水印算法采用了扩展频谱通信 (spread spectrum communication) 技术。算法实现过程为：先计算图像的离散余弦变换 (DCT)，然后将水印叠加到 DCT 域中幅值最大的前 k 系数上（不包括直流分量)，通常为图像的低频分量。若 DCT 系数的前 k 个最大分量表示为 `D=，i=1 ，… ，k`，水印是服从高斯分布的随机实数序列 `W =，i=1 ，… ，k`，那么水印的嵌入算法为 `di = di(1 + awi)`，其中常数 a 为尺度因子，控制水印添加的强度。然后用新的系数做反变换得到水印图像 I。解码函数则分别计算原始图像 I 和水印图像 I*的离散余弦变换，并提取嵌入的水印 W*，再做相关检验 以确定水印的存在与否。该方法即使当水印图像经过一些通用的几何变形和信号处理操作而产生比较明显的变形后仍然能够提取出一个可信赖的水印拷贝。一个简单改进是不将水印嵌入到 DCT 域的低频分量上，而是嵌入到中频分量上以调节水印的顽健性与不可见性之间的矛盾。另外，还可以将数字图像的空间域数据通过离散傅里叶变换 (DFT) 或离散小波变换 (DWT) 转化为相应的频域系数；其次，根据待隐藏的信息类型，对其进行适当编码或变形；再次，根据隐藏信息量的大小和其相应的安全目标，选择某些类型的频域系数序列（如高频或中频或低频）；再次，确定某种规则或算法，用待隐藏的信息的相应数据去修改前面选定的频域系数序列；最后，将数字图像的频域系数经相应的反变换转化为空间域数据。该类算法的隐藏和提取信息操作复杂，隐藏信息量不能很大，但抗攻击能力强，很适合于数字作品版权保护的数字水印技术中。

总的来说，与空域的方法相比，变换域的方法具有如下优点：
- 在变换域中嵌入的水印信号能量可以分布到空域的所有像素上，有利于保证水印的不可见性。
- 在变换域，人类视觉系统 (HVS) 的某些特性（如频率掩蔽特性）可以更方便地结合到水印编码过程中，因而其隐蔽性更好。
- 变换域的方法可与国际数据压缩标准兼容，从而易实现在压缩域 (compressed domain) 内的水印算法，同时也能抵抗相应的有损压缩。

[知乎：阿里巴巴公司根据截图查到泄露信息的具体员工的技术是什么？](https://www.zhihu.com/question/50735753)

#### 5.2.1. 基于离散余弦变换 (DCT)

最早的基于分块 DCT 水印技术出现于 E Koch，J Zhao 的文献。针对静止图像和视频压缩标准（JPEG 和 MPEG），他们的水印方案中图像也被分成 8×8 的块，由一个密钥随机的选择图像的一些分块，在频域的中频上稍微改变一个三元组以隐藏二进序列信息。选择在中频分量编码是因为在高频编码易于被各种信号处理方法破坏，而在低频编码则由于人的视觉对低频分量很敏感，对低频分量的改变易于被察觉。未经授权者由于不知道水印嵌入的区域，因此是很难测出水印的，此外，该水印算法对有损压缩和低通滤波是鲁棒的。将图像分割成 8×8 块，并对每个块做 DCT 变换，然后随机选择构造所有块的一个子集，对子集的每一个块，选择一组频率并嵌入二进制水印信息。由于频率组的选择不是基于最显著分量，并且频率系数的方差较小，因此该方法对噪声、几何变形以及多文档攻击比较敏感。

Cox 等人于 1995 年提出了基于图像全局变换的水印方法，称之为扩频法。这也是目前大部分变换域水印算法中所用到的技术。它将满足正态分布的伪随机序列加入到图像的 DCT 变换后视觉最重要系数中，利用了序列扩频技术（SS）和人类视觉特性（HVS）。算法原理为先选定视觉重要系数，再进行修改，最常用的嵌入规则如下：

其中分别是修改前和修改后的频域系数，α 是缩放因子，是第 i 个信息位水印。

一般说来，乘法准则的抗失真性能要优于加法准则。水印的检测是通过计算相关函数实现的。从嵌入水印的图像中提取出是嵌入规则的逆过程，把提取出来的水印与原水印作相似性运算，与制定的阈值比较，可确定是否存在水印。这是稳健性水印的奠基性算法。

Chiou-Ting Hsu 等人提出一种基于分块 DCT 的水印，他们的水印是可辨识的图像，而不是简单的一个符号或一个随机数。通过有选择地修改图像的中频系数来嵌入水印。验证时，衡量提取出的水印同原水印之间的相似性来判断是否加入了水印。

通过离散余弦变换，根据浮水印所嵌入的频带位置不同又分为：
- 嵌入 DC 系数的浮水印技术
- 嵌入低频系数的浮水印技术

实现贴：http://www.programgo.com/article/88442707161/

科普贴：http://blog.sina.com.cn/s/blog_626631420100xvxd.html

#### 5.2.2. 基于离散小波变换

与传统的 DCT 变换相比，小波变换是一种变分辨率的，将时域与频域相联合的分析方法，时间窗的大小随频率自动进行调整，更加符合人眼视觉特性。小波分析在时、频域同时具有良好的局部性，为传统的时域分析和频域分析提供了良好的结合。

目前，小波分析已经广泛应用于数字图像和视频的压缩编码、计算机视觉、纹理特征识别等领域。由于小波分析在图像处理上的许多特点可用于信息隐藏的研究，所以这种分析方法在信息隐藏和数字水印领域的应用也越来越受到广大研究者的重视，目前已经有很多比较典型的基于离散小波变换的数字水印算法。

通过离散小波变换，根据浮水印所嵌入的频带位置不同又分为：
- 嵌入频带 HL1 的数字水印技术
- 嵌入频带 LH2 的数字水印技术

百科贴：http://baike.baidu.com/view/586841.htm

### 5.3. 其他算法

#### 5.3.1. Patchwork 算法

Patchwork 算法是随机选择 N 对像素点 (ai，bi) ，然后将每个 ai 点的亮度值加 1 ，每个 bi 点的亮度值减 1，这样整个图像的平均亮度保持不变。适当地调整参数，Patchwork 方法对 JPEG 压缩、FIR 滤波以及图像裁剪有一定的抵抗力，但该方法嵌入的信息量有限。为了嵌入更多的水印信息，可以将图像分块，然后对每一个图像块进行嵌入操作。

#### 5.3.2. 压缩域算法

基于 JPEG、MPEG 标准的压缩域数字水印系统不仅节省了大量的完全解码和重新编码过程，而且在数字电视广播及 VOD(Video on Demand) 中有很大的实用价值。相应地，水印检测与提取也可直接在压缩域数据中进行。下面介绍一种针对 MPEG-2 压缩视频数据流的数字水印方案。虽然 MPEG-2 数据流语法允许把用户数据加到数据流中，但是这种方案并不适合数字水印技术，因为用户数据可以简单地从数据流中去掉，同时，在 MPEG-2 编码视频数据流中增加用户数据会加大位率，使之不适于固定带宽的应用，所以关键是如何把水印信号加到数据信号中，即加入到表示视频帧的数据流中。对于输入的 MPEG-2 数据流而言，它可分为数据头信息、运动向量（用于运动补偿) 和 DCT 编码信号块 3 部分，在方案中只有 MPEG-2 数据流最后一部分数据被改变，其原理是，首先对 DCT 编码数据块中每一输入的 Huffman 码进行解码和逆量化，以得到当前数据块的一个 DCT 系数；其次，把相应水印信号块的变换系数与之相加，从而得到水印叠加的 DCT 系数，再重新进行量化和 Huffman 编码，最后对新的 Huffman 码字的位数 n1 与原来的无水印系数的码字 n0 进行比较，只在 n1 不大于 n0 的时候，才能传输水印码字，否则传输原码字，这就保证了不增加视频数据流位率。该方法有一个问题值得考虑，即水印信号的引入是一种引起降质的误差信号，而基于运动补偿的编码方案会将一个误差扩散和累积起来，为解决此问题，该算法采取了漂移补偿的方案来抵消因水印信号的引入所引起的视觉变形。

#### 5.3.3. NEC 算法

该算法由 NEC 实验室的 Cox 等人提出，该算法在数字水印算法中占有重要地位，其实现方法是，首先以密钥为种子来产生伪随机序列，该序列具有高斯 N(0，1) 分布，密钥一般由作者的标识码和图像的哈希值组成，其次对图像做 DCT 变换，最后用伪随机高斯序列来调制（叠加) 该图像除直流 (DC) 分量外的 1000 个最大的 DCT 系数。该算法具有较强的鲁棒性、安全性、透明性等。由于采用特殊的密钥，因此可防止 IBM 攻击，而且该算法还提出了增强水印鲁棒性和抗攻击算法的重要原则，即水印信号应该嵌入源数据中对人感觉最重要的部分，这种水印信号由独立同分布随机实数序列构成，且该实数序列应该具有高斯分布 N(0，1) 的特征。

#### 5.3.4. 生理模型算法

人的生理模型包括人类视 HVS(HumanVisualSystem) 和人类听觉系统 HAS。该模型不仅被多媒体数据压缩系统利用，同样可以供数字水印系统利用。利用视觉模型的基本思想均是利用从视觉模型导出的 JND(Just Noticeable Difference) 描述来确定在图像的各个部分所能容忍的数字水印信号的最大强度，从而能避免破坏视觉质量。也就是说，利用视觉模型来确定与图像相关的调制掩模，然后再利用其来插入水印。这一方法同时具有好的透明性和强健性。

## 6. Refer Links

[百度百科：数字水印](https://baike.baidu.com/item/%E6%95%B0%E5%AD%97%E6%B0%B4%E5%8D%B0)

[Wikipedia：数字水印](https://zh.wikipedia.org/wiki/%E6%95%B8%E4%BD%8D%E6%B5%AE%E6%B0%B4%E5%8D%B0)
