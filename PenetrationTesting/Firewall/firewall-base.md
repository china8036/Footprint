- [防火墙技术](#%E9%98%B2%E7%81%AB%E5%A2%99%E6%8A%80%E6%9C%AF)
  - [基本概念](#%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5)
    - [定义](#%E5%AE%9A%E4%B9%89)
    - [所处位置](#%E6%89%80%E5%A4%84%E4%BD%8D%E7%BD%AE)
      - [物理位置](#%E7%89%A9%E7%90%86%E4%BD%8D%E7%BD%AE)
      - [逻辑位置](#%E9%80%BB%E8%BE%91%E4%BD%8D%E7%BD%AE)
    - [作用](#%E4%BD%9C%E7%94%A8)
    - [分类](#%E5%88%86%E7%B1%BB)
    - [发展过程](#%E5%8F%91%E5%B1%95%E8%BF%87%E7%A8%8B)
  - [工作原理](#%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86)
    - [包过滤防火墙](#%E5%8C%85%E8%BF%87%E6%BB%A4%E9%98%B2%E7%81%AB%E5%A2%99)
      - [无状态的包过滤防火墙](#%E6%97%A0%E7%8A%B6%E6%80%81%E7%9A%84%E5%8C%85%E8%BF%87%E6%BB%A4%E9%98%B2%E7%81%AB%E5%A2%99)
        - [过滤规则](#%E8%BF%87%E6%BB%A4%E8%A7%84%E5%88%99)
        - [实例](#%E5%AE%9E%E4%BE%8B)
        - [优缺点](#%E4%BC%98%E7%BC%BA%E7%82%B9)
      - [有状态的包过滤防火墙](#%E6%9C%89%E7%8A%B6%E6%80%81%E7%9A%84%E5%8C%85%E8%BF%87%E6%BB%A4%E9%98%B2%E7%81%AB%E5%A2%99)
        - [工作原理](#%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86)
        - [实例](#%E5%AE%9E%E4%BE%8B)
        - [优缺点](#%E4%BC%98%E7%BC%BA%E7%82%B9)
    - [应用网关防火墙](#%E5%BA%94%E7%94%A8%E7%BD%91%E5%85%B3%E9%98%B2%E7%81%AB%E5%A2%99)
      - [优缺点](#%E4%BC%98%E7%BC%BA%E7%82%B9)
  - [体系结构](#%E4%BD%93%E7%B3%BB%E7%BB%93%E6%9E%84)
    - [相关概念](#%E7%9B%B8%E5%85%B3%E6%A6%82%E5%BF%B5)
    - [过滤路由器 / 屏蔽路由器结构结构 (Packetfiltering Router or Screening Router)](#%E8%BF%87%E6%BB%A4%E8%B7%AF%E7%94%B1%E5%99%A8-%E5%B1%8F%E8%94%BD%E8%B7%AF%E7%94%B1%E5%99%A8%E7%BB%93%E6%9E%84%E7%BB%93%E6%9E%84-packetfiltering-router-or-screening-router)
    - [双穴主机 / 双宿主机结构 (Dual Homed Gateway)](#%E5%8F%8C%E7%A9%B4%E4%B8%BB%E6%9C%BA-%E5%8F%8C%E5%AE%BF%E4%B8%BB%E6%9C%BA%E7%BB%93%E6%9E%84-dual-homed-gateway)
    - [屏蔽主机 / 主机过滤结构 (Screened Host Gateway)](#%E5%B1%8F%E8%94%BD%E4%B8%BB%E6%9C%BA-%E4%B8%BB%E6%9C%BA%E8%BF%87%E6%BB%A4%E7%BB%93%E6%9E%84-screened-host-gateway)
    - [过滤子网 / 屏蔽子网结构 (Screened Subnet)](#%E8%BF%87%E6%BB%A4%E5%AD%90%E7%BD%91-%E5%B1%8F%E8%94%BD%E5%AD%90%E7%BD%91%E7%BB%93%E6%9E%84-screened-subnet)
  - [评价标准](#%E8%AF%84%E4%BB%B7%E6%A0%87%E5%87%86)
    - [并发连接数](#%E5%B9%B6%E5%8F%91%E8%BF%9E%E6%8E%A5%E6%95%B0)
    - [吞吐量](#%E5%90%9E%E5%90%90%E9%87%8F)
    - [时延](#%E6%97%B6%E5%BB%B6)
    - [丢包率](#%E4%B8%A2%E5%8C%85%E7%8E%87)
    - [背靠背缓冲](#%E8%83%8C%E9%9D%A0%E8%83%8C%E7%BC%93%E5%86%B2)
    - [最大 TCP 连接建立速率](#%E6%9C%80%E5%A4%A7-tcp-%E8%BF%9E%E6%8E%A5%E5%BB%BA%E7%AB%8B%E9%80%9F%E7%8E%87)
  - [Refer](#refer)

# 防火墙技术

## 基本概念

### 定义

防火墙（Firewall）是在两个网络之间执行访问 控制策略的一个或一组安全系统。它是一种计 算机硬件和软件系统集合，是实现网络安全策 略的有效工具之一，被广泛地应用到内部网络 与外部网络的边界位置。 

- 所有的内部网络与外部网络之间的通信都必须经过防火墙进行检查与连接，只有授权允许的通信才能获准通过防火墙。

- 防火墙可以阻止外界对内部网资源的非法访问，也可以防止内部对外部的不安全访问。

- 防火墙本身必须具有很强的抗攻击能力，以确保其自身的安全性。 

- 防火墙简单的可以只用路由器实现，复杂的可以用主机、专用硬件设备及软件甚至一个子网来实现

### 所处位置

#### 物理位置

从设备部署位置上看，防火墙要部署在本地受保护区域与外部网络的交界点上。

从具体的实现上看，防火墙运行在任何要实现访问控制功能的设备上。 

#### 逻辑位置

防火墙的逻辑位置指的是防火墙与网络协议相对应的逻辑层次关系。
- 处于不同网络层次的防火墙实现不同级别的网络过滤功能，表现出来的特性也不同。

防火墙的目的在于实现访问控制策略，所有防火墙均依赖于对 ISO OSI/RM 网络七层模型中各层协议所产生的信息流进行检查。 
- 一般说来，防火墙越是工作在 ISO OSI/RM 模型的上层，能检查的信息就越多，其提供的安全保护等级就越高

### 作用

1. 保护脆弱和有缺陷的网络服务 
    
    例如，防火墙可以禁止 Telnet、FTP 进出受保护网络，避免外部攻击者利用这些脆弱的协议来攻击内部网络。

2. 实施安全策略，加强对网络系统的访问控制
    
    例如，防火墙可以屏蔽部分主机，使外部网络无法访问。同样，可以屏蔽部分主机的特定服务，使得外部网络可以访问该主机的其它服务，但无法访问该主机的特定服务。 

3. 防止内网信息暴露，加强隐私 
    
    例如，使用防火墙屏蔽泄露网络内部细节的服务（如 Finger 服务，DNS 服务）。 

4. 对网络存取和访问进行监控审计

    由于所有的访问都经过防火墙，因此防火墙可以记录下这些访问并作出日志记录，同时也能提供网络使用情况的统计数据。当发生可疑动作时，防火墙能进行适当的报警，并提供网络是否受到监测和攻击的详细信息。

### 分类

- 按照软、硬件形式划分
  - 软件防火墙：运行于特定的计算机上，它需要客户预先安装好的计算机操作系统的支持，一般来说这台计算机就是整个网络的网关。 
  - 硬件防火墙：基于 PC 架构，这些 PC 架构计算机上运行一些经过裁剪和简化的操作系统。至少应具备三个端口，分别接内网，外网和 DMZ 区。
  - 芯片级防火墙：基于专门的硬件平台，没有操作系统。专有 ASIC 芯片促使它们比其他种类的防火墙速度更快，处理能力更强，性能更高。

- 按防火墙技术划分
  -  包过滤 (Packet filtering) 型： 工作在 OSI 网络参考模型的网络层和传输层，它根据数据包源地址、目的地址、端口号和协议类型等标志确定是否允许通过。只有满足过滤条件的数据包才被转发到相应的目的地，其余数据包则被从数据流中丢弃。 
  -  应用代理 (Application Proxy) 型：工作在 OSI 的最高层—应用层。其特点是完全"阻隔"了网络通信流，通过对每种应用服务编制专门的代理程序，实现监视和控制应用层通信流的作用。

- 按防火墙组成结构划分
  - 单一主机防火墙：需要连接一个以上的内、外部网络。用硬盘来存储防火墙所用的基本程序，如包过滤程序和代理服务器程序等，有的防火墙还把日志记录也记录在此硬盘上。 
  -  路由器集成防火墙
  -  分布式防火墙：这种防火墙已不再是一个独立的硬件实体，而是由多个软、硬件组成的系统。不是只是位于网络边界，而是渗透于网络的每一台主机，对整个内部网络的主机实施保护。

- 按受保护的对象划分
  - 单机防火墙：单机防火墙设计目的是为了保护单台主机网络访问操作的安全。一般是以装载到受保护主机的硬盘里的软件程序的形式存在的。受到主机性能所限，单机防火墙性能不会很高，无法与网络防火墙相比。
  - 网络防火墙：网络防火墙的设计目的是为了保护相应网络的安全。网络防火墙一般采用软件与硬件相结合的形式，也有纯软件的防火墙存在。网络防火墙处于受保护网络与外部网络相接的节点上，对于网络负载吞吐量、过滤速度、过滤强度等参数的要求比单机防火墙要高。目前大部分的防火墙产品都是网络防火墙。 

- 按防火墙体系结构划分
  - 屏蔽路由器结构 
  - 双宿主机结构
  - 屏蔽主机结构 
  - 屏蔽子网结构

### 发展过程

![image](http://img.cdn.firejq.com/jpg/2017/11/26/d537a0fc5d04cfe2313c3e774d6d3e0d.jpg)

静态包过滤防火墙 -> 应用型 / 代理防火墙 -> 动态包过滤防火墙 -> 自适应代理防火墙

自适应代理（Adaptive proxy）防火墙具有应用代理的安全性，但不采用应用代理的数据传送方式，而采用包过滤的传送方式，由此取得安全和效率的一个折中。

## 工作原理

### 包过滤防火墙

#### 无状态的包过滤防火墙

包过滤防火墙根据数据包的包头信息，依据事先设定的过滤规则，决定是否允许数据包通过。由于包过滤防火墙通常是具有包过滤功能的路由器，因此包过滤防火墙也常称为筛选路由器。

**包过滤防火墙主要在网络层和传输层起作用。**

包过滤技术的工作对象是数据包。对 TCP/IP 协议族来说，包过滤技术主要对其数据包包头的各个字段进行操作，包头中的源地址、目的地址、端口号、ICMP 消息类型、各种标志位都常作为判定参数。

##### 过滤规则

过滤规则是防火墙的核心，其作用是执行系统的网络访问策略，每条过滤规则由匹配标准和防火墙操作两个部分组成。
- 包过滤防火墙执行的操作只有允许和拒绝两种。

一组按序排列的过滤规则将构成访问控制列表 (Access Control List, ACL)。ACL 可以绑定在 firewall 某个接口的特定方向上，通常以 in 或 out 描述 ACL 是对进入接口的额数据包或者是对流出接口的数据包起作用。

当数据包到达防火墙的某一接口，包过滤防火墙将包头各个字段的内容与 ACL 进行逐条地比较判断，直至找到一条相符的规则为止。如果某条规则匹配数据包，则立即执行对应的操作，无需继续与 ACL 中剩余的过滤规则进行匹配。如果没有相符的规则，则执行默认规则。因此，ACL 中过滤规则的存储顺序非常重要。

##### 实例

- 针对 TCP 协议的过滤
  - 端口过滤：设定对源或目的端口过滤，只要针对服务使用的端口号进行规则的设置，就可以实现对特定服务的控制。 
  - 标志位过滤：设定对 TCP 协议的标志位过滤，最常用的就是针对 SYN 和 ACK 的过滤。
    - 在 TCP 协议的连接建立过程中，报文头部的一些标志位会发生变化，例如，对 SYN=1 的报文进行操作，就可实现对连接会话的控制：拒绝 SYN=1 的报文，就相当于阻断了通信连接的建立。

- 针对 UDP 协议的过滤
  
  - UDP 协议是基于无连接的服务的，一个 UDP 用户数据报报文中携带了到达目的地所需的全部信息，不需要返回任何的确认，而静态包过滤技术只针对包本身进行操作而不记录通信过程的上下文，也就无法从独立的 UDP 用户数据报中得到必要的信息，报文之间的关系很难确定，因此很难制定相应的过滤规则。

  - 对于 UDP 协议，要么阻塞某个端口，要么听之任之。多数人倾向于前一种方案，除非有很大的压力要求允许进行 UDP 传输。

##### 优缺点
- 优点
  - 包过滤防火墙位于网络边界，简单易行。
  - 包过滤防火墙处理速度快，工作效率高，对正常网络通信影响小。
  - 包过滤防火墙对用户和应用是透明的，内网用户无需对主机进行特殊的设置。
- 缺点
  - 包过滤防火墙依赖于对数据包 header 的检查，不对 payload 进行检查，判定信息不足导致难以对数据包进行细致的分析。
  - 包过滤防火墙规则配置较为困难。
  - 包过滤防火墙支持的规则数量有限，若规则数量过多，每个数据包都需要进行依次匹配，降低了网络效率。
  - 由于数据包中的字段信息容易伪造，而包过滤防火墙本身难以进行用户身份认证，使得攻击者可以通过 IP 欺骗等方法绕过 firewall。

#### 有状态的包过滤防火墙

无状态的包过滤防火墙无法辨别一个 TCP 数据包是属于 TCP 连接建立的初始化阶段，还是数据传输阶段，或者是断链阶段，难以精确地对数据包进行过滤。

有状态的包过滤防火墙 / 状态检测防火墙，通常采用连接状态表跟踪网络连接的状态，记录 TCP 连接状态的信息（如哪台主机发出了 TCP 连接请求、连接是否建立、连接是否释放等），在接收到数据包时，以连接状态表为基础，依据配置的 ACL，判断是否允许数据包通过，从而更加有效地保护网络安全。

##### 工作原理

1. 当一个连接的初始数据报文到达执行状态检测的防火墙时，首先检查该报文是否符合过滤规则规定。

2. 如果该报文与规定相符合，则将该连接的信息记录下来并自动添加一条允许该连接通过的过滤规则，然后向目的地转发该报文。以后凡是属于该连接的数据防火墙一律予以放行，包括从内向外的和从外向内的双向数据流。

3. 在通信结束、释放该连接以后，防火墙将自动地删除关于该连接的过滤规则。 

4. 动态过滤规则存储在连接状态表中并由防火墙进行维护。 

5. 为了更好地为用户提供网络服务以及更精确地执行安全过滤，**状态检测技术往往需要察看网络层和应用层的信息，但主要还是在传输层上工作**。

##### 实例

- TCP 协议及状态 
  
  TCP 协议是面向连接的协议，对于通信过程各个阶段的状态都有很明确的定义，并可以通过 TCP 协议的标志位进行跟踪。 
  
  TCP 协议共有 11 种状态，这些状态标识由 RFC 793 定义，分别为：CLOSED、LISTEN、SYN-SENT、SYN-RECEIVED、 ESTABLISHED、FIN-WAIT-1、CLOSE-WAIT、FINWAIT-2、LAST-ACK、TIME-WAIT、CLOSING。

  以状态为基础，结合相应的标志位信息，再加上通信双方的 IP 地址和端口号，即可很容易地建立 TCP 协议的状态连接表项并进行精确地跟踪监控。

- UDP 协议及状态

  UDP 协议是一种无连接的协议，其状态很难进行定义和跟踪。通常的做法是将某个基于 UDP 协议的会话的所有数据报文看作是一条 UDP 连接，并在这个连接的基础之上定义该会话的伪状态信息（主要由源 IP 地址、目的 IP 地址、源端口号以及目的端口号构成)。

  由于 UDP 协议是无连接的，所以无法定义连接的结束状态，只能是设定一个不长的超时参数，在超时到来的时候从状态连接表中删除该 UDP 连接信息。

- ICMP 协议及状态

  ICMP 协议是无连接的协议，ICMP 协议的状态和连接的建立、维护与删除与 UDP 协议类似。但是在建立的过程中不是简单地只通过 IP 地址来判别连接属性，ICMP 协议的状态和连接需要考虑 ICMP 报文的类型和代码字段含义，甚至还要提取 ICMP 报文的内容来决定其到底与哪一个已有连接相关。

  维护和删除过程：
  - 通过设定超时计时器来完成 。
  - 按照部分类型的 ICMP 报文的对称性来完成。当属于同一连接的 ICMP 报文完成请求—应答过程后，即可将其从状态连接表中删除。

##### 优缺点

- 优点
  - 使用有状态的包过滤防火墙，提升网络攻击难度，加强了安全性。
  - 能够比一般的无状态包过滤防火墙提供更加全面的日志信息。
  - 与静态包过滤技术相比，提升了防火墙的性能：状态检测机制对连接的初始报文进行详细检查，而对后续报文不需要进行相同的动作，只需快速通过即可。 
- 缺点
  - 很多网络协议并没有状态信息，这种情况下只能采取一些变通的方法。
  - 主要工作在网络层和传输层，对报文的数据部分检查很少，安全性还不够高。 
  - 为建立和管理状态表，需要付出高昂的处理开销，对硬件设备的性能提出了更高的要求。

### 应用网关防火墙

应用网关防火墙以代理服务器 (Proxy Server) 技术为基础。代理服务器作用在应用层，在内网主机与外网主机之间进行信息交换。在通信过程中，代理服务器对内网用户与外网服务器完全透明。

使用代理服务器的最初目的是通过使用缓存提高网络通信的速度。

#### 优缺点

- 优点
  - 与包过滤防火墙相比，代理服务器直接与应用程序交互，其判定的信息除了 IP、端口号等数据包 header 信息，还能理解应用协议，对数据包进行细粒度地详细分析，根据应用上下文对网络通信进行精准的判定，有助于应用层攻击行为 （如缓冲区溢出攻击、SQL 注入攻击） 的检测。

  - 所有数据包的 header 与 payload 都可以被记录，从而实现完善的审计。

  - 可以通过应用网关防火墙对用户身份进行认证，确保只有允许的用户才能通过。

- 缺点
  - 应用层协议无法采用统一的方法进行分析，给代理模块带来了很大的困难。大部分代理服务器只能处理相对较少的应用服务。
  - 不能使用户免于协议本身缺点的限制。
  - 有些服务要求建立直接连接，无法使用代理，如聊天服务、或者即时消息服务。
  - 从性能上看，应用网关防火墙的性能往往弱于包过滤防火墙。因为应用网关防火墙需要检查数据 payload，分析应用层的内容，增加了处理的负担。若设计不当，容易导致数据传输出现明显延迟，甚至数据包重传，网络拥塞。
  - 对硬件要求更高，价格更为昂贵。
  - 管理的复杂性较高。

## 体系结构

### 相关概念

-  堡垒主机（Bastion Host）：被网络管理员认定为网络安全核心点的系统，必须具有很强的安全性。
  - 堡垒主机常常充当内部网络或防火墙中应用代理的角色。
  - 堡垒主机是最显露的主机，因此也应当是最安全的主机。

- 中立区或非军事化区域（Demilitarized Zone, DMZ）：存在于企业内部网络和外部网络之间的一个小型网络。 
  - 由屏蔽路由器建立或阻塞路由器建立。 
  - DMZ 用来作为外网和内网的缓冲区以进一步隔离公网和内部私有网络。 
  - 通常在 DMZ 中放置一些必须公开的服务器。

### 过滤路由器 / 屏蔽路由器结构结构 (Packetfiltering Router or Screening Router) 

![image](http://img.cdn.firejq.com/jpg/2017/11/26/00964f41b671614a04324f208fac765b.jpg)

屏蔽路由器结构是最简单的防火墙结构。

- 优点：速度快、提供透明服务、实现简单。
- 缺点：
  - 核心组件是包过滤防火墙，如果规则配置不当，可能对内网构成威胁。 
  - 依靠一个单一的部件来保护网络系统，一旦部件出现问题，会对内网失去保护作用。 
  - 没有或仅有很简单的日志记录功能，网络管理员很难确定网络系统是否正在被攻击或已经被入侵。

### 双穴主机 / 双宿主机结构 (Dual Homed Gateway) 

![image](http://img.cdn.firejq.com/jpg/2017/11/26/c6bc993aace67f9629c0391a9840a761.jpg)

该结构的防火墙是放在内网与外网接口上的一台堡垒主机。这台主机上最少有两个网络接口：一个与内网相连，另外一个与外网相连。内、外网之间禁止直接通信。堡垒主机上运行着防火墙软件（应用层网关)，可以转发应用程序，也可提供服务等功能。

- 优点：双穴主机网关优于屏蔽路由器的地方是堡垒主机可以监视内外网之间的通信，可进行详细的日志记录，对于日后的安全检查非常有用。
- 缺点：一旦入侵者侵入堡垒主机并使其只具有路由功能，则任何网上用户均可以随便访问内部网络。

### 屏蔽主机 / 主机过滤结构 (Screened Host Gateway) 

![image](http://img.cdn.firejq.com/jpg/2017/11/26/a92f49e5cf17a29d4f17a7aaeba342dd.jpg)

屏蔽主机体系结构包括：一个分组（包）过滤路由器（或称为屏蔽路由器) 连接外部网络，再通过一个堡垒主机与内部网络相连。

来自外部网络的数据包先经过屏蔽路由器过滤，不符合过滤规则的数据包被过滤掉；符合规则的包则被传送到堡垒主机上，其代理服务软件将允许通过的信息传输到受保护的内部网上。

- 优点
  - 无论内网络如何变化都不会对包过滤防火墙和堡垒主机配置产生影响。 
  - 安全风险主要只限制在堡垒主机和屏蔽路由器，主要这两个组件本身不存在漏洞并配置完善，攻击者很难对内部网络实施攻击。 

- 缺点
  - 一旦包过滤路由器被攻破，整个内网和堡垒主机与外网之间就再也没有任何阻挡。
  - 一旦入侵者侵入堡垒主机并使其只具有路由功能，则任何网上用户均可以随便访问内部网络。

### 过滤子网 / 屏蔽子网结构 (Screened Subnet)

![image](http://img.cdn.firejq.com/jpg/2017/11/26/c95e907bd0009138e67d806ecb8ba230.jpg)

![image](http://img.cdn.firejq.com/jpg/2017/11/26/861c3e74efbec7c370aea2ff8c9b28a3.jpg)

在外界网络和内部网络之间建立一个双方都可以访问的独立网络（屏蔽子网），用两台分组过滤路由器将这一子网分别与内部网络和外部网络分开。

- 屏蔽子网

  - 屏蔽子网也常常被称为 DMZ（Demilitarized Zone）区或参数网络或周边网络或屏蔽网络，它可以只包含堡垒主机，也可以增加需要对外提供服务的服务器。

  - 屏蔽子网不提供外部网络和内部网络之间的通路，而是在内 / 外部网之间另加的一个安全保护层，相当于一个应用网关。如果入侵者成功地闯过外层保护网到达防火墙，周边网络就能在入侵者与内部网之间再提供一层保护。 

- 堡垒主机 
  - 堡垒主机是内外网相互通信的唯一通道，通过对堡垒主机的正确配置，可对内外网之间的通信进行细粒度的控制。
  - 在堡垒主机上建立代理服务，在内部网用户与外部服务器之间建立间接连接。

- 内部路由器 
  - 内部路由器的主要功能是保护内部网免受来自外部网与屏蔽子网的侵扰。 
  - 内部路由器可以设定，使内网主机只能经由堡垒主机访问外部网络，从而有效禁止内外网之间的直接通信。

## 评价标准

### 并发连接数

RFC 2647：并发连接数是指内网和外网之间穿越防火墙能够同时建立的最大连接数量，即防火墙所能处理的最大会话数量。 

并发连接数的差异主要取决于三方面的因素：
- 内存资源的大小
  
  并发连接表是防火墙用于保存并发连接信息的表结构，位于防火墙的系统内存，通过防火墙的连接会在并发连接表中保存记录，因此并发连接数受限于并发连接表的大小。

  以每个并发连接表项占用 300B 计算，1000 个并发连接将占用 300B×1000×8bit/B≈2.3Mb 内存空间；如果试图实现 1000000 个并发连接的产品，产品需要提供 2.24Gb 内存空间。

- CPU 的处理能力 

  CPU 的主要任务是把网络上的流量从一个网段尽可能快速地转发到另外一个网段上，并且在转发过程中对此流量按照一定的访问控制策略进行许可检查、流量统计和访问审计等操作。 

  如果随意提高防火墙所允许的并发连接表数，CPU 的工作负荷将增大。如果 CPU 的处理能力跟不上并发连接数的增长，势必影响防火墙对连接请求的处理延迟，造成某些连接超时，致使连接报文重发，最后形成雪崩效应，致使整个防火墙系统崩溃。

- 物理链路的实际承载能力

  由于防火墙通常都部署在 Internet 出口处，在客户端 PC 与目的资源中间的路径上，总是存在着瓶颈链路。 

  拥挤的低速链路根本无法承载太多的并发连接，即便是防火墙能够支持大规模的并发访问连接，也无法发挥出其原有的性能。

### 吞吐量

RFC 1242 定义：吞吐量是指在保证不丢失数据帧的情况下，防火墙能够达到的最大数据帧转发速率。

吞吐量测试结果以比特 / 秒或字节 / 秒表示。

### 时延

时延是指数据包的第一个比特进入防火墙，到最后一个比特从防火墙输出的时间间隔。 

数据包到达防火墙，防火墙对数据包的处理将使数据包的传输时延增加。实际应用中时延主要源于对数据包进行排队、检测、日志和转发等操作需要的时间。

时延体现防火墙的处理速度，时延短说明防火墙处理数据速度快。

### 丢包率

RFC 1242 定义：丢包率是指在正常稳定的网络状态下，应当被转发但由于防火墙缺少资源而没有转发、被防火墙丢弃的数据包在全部发送数据包中所占的比率。

丢包率体现防火墙的稳定性和可靠性，较低的丢包率意味着防火墙能在一定负载压力下稳定工作。丢包率须在防火墙的吞吐量范围内进行测试。

### 背靠背缓冲

背靠背缓冲是指防火墙接收到以最小数据帧间隔传输的数据帧时，在不丢弃数据的情况下，能够处理的最大数据帧数目。 

背靠背缓冲体现防火墙的缓冲容量，决定了防火墙对突发数据的处理能力。若防火墙的处理能力够强，背靠背缓冲作用较小。

实施分片重组防火墙的背靠背缓冲大小有重要意义。

### 最大 TCP 连接建立速率

最大 TCP 连接建立速率是指所有 TCP 连接成功建立的前提下，防火墙能够达到的最大连接建立，速率以连接数 / 秒表示，体现了防火墙对连接请求的实时反应能力。

## Refer

《网络攻防原理》 - 吴礼发