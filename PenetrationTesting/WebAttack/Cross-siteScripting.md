- [Cross-site Scripting](#Cross-site-Scripting)
  - [1. Overview](#1-Overview)
  - [2. 本地脚本漏洞攻击](#2-本地脚本漏洞攻击)
  - [3. 反射式跨站脚本攻击](#3-反射式跨站脚本攻击)
  - [4. 储存式跨站脚本攻击](#4-储存式跨站脚本攻击)
  - [5. XSS 防范](#5-XSS-防范)

# Cross-site Scripting

## 1. Overview

跨站脚本攻击（Cross-site Scripting，XSS）指攻击者利用 web 程序对用户输入过滤不足的缺陷，将恶意代码注入到其它用户浏览器显示的页面上执行，从而进行窃取用户敏感信息、伪造用户身份等恶意行为的一种攻击方式；

进行 XSS 有两个前提条件：
- web 程序必须接收用户的输入，输入不仅包括 URL 中的参数和表单字段，还包括 HTTP Header 和 Cookie 值；
- web 程序必须重新显示用户输入的内容，只有用户浏览器将 web 程序提供的数据解释为 HTML 标记时，攻击才会发生；

XSS 主要有三种形式：
- 本地脚本漏洞攻击
- 反射式跨站脚本攻击
- 储存式跨站脚本攻击

## 2. 本地脚本漏洞攻击

本地脚本漏洞攻击利用的是页面中客户端脚本中自身存在的安全漏洞；

例：
1. A 给 B 发送一个恶意构造的 HTML
1. B 点击并查看了该 HTML
1. 恶意页面中的 JavaScript 打开一个具有漏洞的 HTML 页面，并将其安装在 B 计算机上
1. 具有漏洞的 HTML 页面包含了在 B 计算机本地域执行的 JavaScript
1. A 的恶意脚本可以在 B 的计算机上执行 B 所持有的权限下的命令

## 3. 反射式跨站脚本攻击

反射式跨站脚本攻击 / 非持久性跨站脚本攻击，是最常见的一种跨站脚本攻击类型；

与本地脚本漏洞攻击不同的是，web 客户端使用 server 端脚本生成也为用户提供数据时，如果未经验证的用户数据被包含在页面中而未经 HTML 实体编码，客户端代码便能够注入到动态页面中；web 程序不会存储恶意脚本，但会将未经验证的数据发送给客户端，最终达到执行恶意代码的目的；

例：
1. A 在 B 的网站上使用正常用户名和密码登陆，存储敏感信息；
1. C 发现 B 的网站上存在 XSS 漏洞，于是 C 编写了一个利用漏洞的 URL，将其冒充为来自 B 的邮件发送给 A；
1. A 在登录到 B 的网站后，浏览 C 的 URL；
1. 嵌入到 URL 的恶意代码在 A 的浏览器中执行，此脚本盗窃敏感信息，然后在 A 完全不知情的情况下将这些信息发送到 C 的 web 站点；

## 4. 储存式跨站脚本攻击

储存式跨站脚本攻击 / 持久性跨站脚本攻击是一种十分危险的 XSS 类型；

若 web 程序允许存储用户数据，并且存储的输入数据没有经过正确的过滤，便存在储存式跨站脚本攻击漏洞；

hacker 不需要利用一个恶意链接，只要用户访问了储存式跨站脚本网页，那么恶意数据将显示为网站的一部分并以受害者的身份执行；

例：
1. B 拥有一个允许用户发布信息和浏览已发布信息的 web site；
1. C 注意到 B 站点存在 XSS 漏洞，便发布一个热点的信息，吸引其它用户点击阅读；
1. B 或任何其他人浏览该信息时，其会话 Cookie 或其它信息将被 C 窃取；

## 5. XSS 防范
基本上跨站脚本攻击漏洞都是因为未对用户输入进行严格控制和过滤，导致恶意代码可以写入恶意 JavaScript，而这些 JavaScript 又被嵌入到 HTML 页面中，从而得以执行；

在将 HTML 返回给 web 浏览器之前，对用户的所有输入内容进行过滤控制或进行编码，如：使用 HTML 编码将标记字符替代为没有特殊意义的字符；

验证数据通常使用白名单检测；
