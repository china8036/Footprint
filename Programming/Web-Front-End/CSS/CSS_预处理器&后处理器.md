- [CSS 预处理器与后处理器](#css-%E9%A2%84%E5%A4%84%E7%90%86%E5%99%A8%E4%B8%8E%E5%90%8E%E5%A4%84%E7%90%86%E5%99%A8)
  - [1. CSS 预处理器](#1-css-%E9%A2%84%E5%A4%84%E7%90%86%E5%99%A8)
    - [1.1. 背景 & 意义](#11-%E8%83%8C%E6%99%AF-%E6%84%8F%E4%B9%89)
    - [1.2. 常见的 CSS 预处理器](#12-%E5%B8%B8%E8%A7%81%E7%9A%84-css-%E9%A2%84%E5%A4%84%E7%90%86%E5%99%A8)
    - [1.3. 实现原理](#13-%E5%AE%9E%E7%8E%B0%E5%8E%9F%E7%90%86)
    - [1.4. 优缺点](#14-%E4%BC%98%E7%BC%BA%E7%82%B9)
  - [2. CSS 后处理器](#2-css-%E5%90%8E%E5%A4%84%E7%90%86%E5%99%A8)
    - [2.1. CSS 后处理器框架](#21-css-%E5%90%8E%E5%A4%84%E7%90%86%E5%99%A8%E6%A1%86%E6%9E%B6)
    - [2.2. 实现原理](#22-%E5%AE%9E%E7%8E%B0%E5%8E%9F%E7%90%86)
    - [2.3. 优缺点](#23-%E4%BC%98%E7%BC%BA%E7%82%B9)
    - [2.4. 开发模式的变化](#24-%E5%BC%80%E5%8F%91%E6%A8%A1%E5%BC%8F%E7%9A%84%E5%8F%98%E5%8C%96)
  - [3. Refer Links](#3-refer-links)

# CSS 预处理器与后处理器

## 1. CSS 预处理器

### 1.1. 背景 & 意义

CSS 的出现为结构和表现分离提供了便利，为一个文件多处引入，改一处多处改，提供了便利，但**CSS 的痛点在哪里**？

CSS 是一门“面向命名”的语言，其最大的缺陷在于，完全静态，所有代码都需要一板一眼的敲上去。比如：
- 嵌套
- 复用代码段
- 模块化开发的不灵活
- 不具备逻辑能力和抽象能力
开发人员可以通过代码的规划和设计来提高代码的可维护性、可读性和可复用性，但它的硬伤是难以突破的。因此，css 预处理器就是这样被创造出来，弥补了直接写 css 的一些缺憾。

### 1.2. 常见的 CSS 预处理器

- Sass：2007 年诞生，最早也是最成熟的 CSS 预处理器，拥有 ruby 社区的支持和 compass 这一最强大的 css 框架，目前受 LESS 影响，已经进化到了全面兼容 CSS 的 SCSS。

- Less：2009 年出现，受 SASS 的影响较大，但又使用 CSS 的语法，让大部分开发者和设计师更容易上手，在 ruby 社区之外支持者远超过 SASS，其缺点是比起 SASS 来，可编程功能不够，不过优点是简单和兼容 CSS，反过来也影响了 SASS 演变到了 SCSS 的时代，著名的 Twitter Bootstrap 就是采用 LESS 做底层语言的。

- Stylus：2010 年产生，来自 Node.js 社区，主要用来给 Node 项目进行 CSS 预处理支持，在此社区之内有一定支持者，在广泛的意义上人气还完全不如 SASS 和 LESS。

### 1.3. 实现原理

1. 取到 [DSL](https://en.wikipedia.org/wiki/Domain-specific_language) 源代码 的 分析树
1. 将含有 动态生成 相关节点的 分析树 转换为 静态分析树
1. 将 静态分析树 转换为 CSS 的 静态分析树
1. 将 CSS 的 静态分析树 转换为 CSS 代码
1. 现实中的 CSS 预处理器 更复杂一点儿，因为大多功能要同时支持 特有 DSL 与 原生 CSS，一件事情要同时考虑两种情况下的处理。

### 1.4. 优缺点

- 优点：语言级逻辑处理，动态特性，改善项目结构

- 缺点：采用特殊语法，框架耦合度高，复杂度高

## 2. CSS 后处理器

CSS 后处理器 是对 CSS 进行处理，并最终生成 CSS 的 预处理器，它属于广义上的 CSS 预处理器。

### 2.1. CSS 后处理器框架

- Rework: Rework 是一个 高效、简单、易扩展并且模块化的 CSS 预处理器。它在 2012 年 9 月才发布了第一个版本，是 Stylus 的作者 TJ Holowaychuk 大神挖的新坑。实际上，他采用的是 CSS 后处理器 的模型，在其之上有一个模仿 Stylus 风格缩进嵌套的工具 styl，其 CSS 预处理器 部分功能是在 Rework 开始工作之前通过 css-whitespace 实现的。有一些基于 Rework 的样式库，参考了 CSS 标准草案 或 CSS 标准提案，相当于支持了 CSS 的未来标准，如 rework-vars、rework-font-variant、rework-calc、rework-color-function 等。

- PostCSS: PostCSS 是一个 CSS 后处理器 框架，允许你通过 JavaScript 对 CSS 进行修改。它的第一个版本发布于 2013 年 11 月，是从 Autoprefixer 项目中抽象出的框架。它和 Rework 非常相似，但提供了 更高级的 API，更易扩展，可以在现有 Source Map 的基础上生成新的 Source Map。而且 PostCSS 在原有 CSS 格式的保留方面做的更好，便于开发编辑器插件，也比 Rework 更年轻。

### 2.2. 实现原理

1. 将 源代码 做为 CSS 解析，获得 分析树
1. 对 CSS 的 分析树 进行 后处理
1. 将 CSS 的 分析树 转换为 CSS 代码

### 2.3. 优缺点

- 优点：使用 CSS 语法，容易进行模块化，贴近 CSS 的未来标准

- 缺点：逻辑处理能力有限

### 2.4. 开发模式的变化

原来的开发模式是这样的：
```
DSL 源代码 -> 生产环境 CSS
```
与原来相比，新的 开发模式 最大的变化是面向 标准 CSS 编程，将 兼容性、优化 部分交给 CSS 后处理器 自动完成：
```
DSL 源代码 -> 标准 CSS -> 生产环境 CSS
```
等到众多 CSS 未来标准 在 CSS 后处理器 层面实现之后，部分项目甚至可以回归到使用 标准 CSS 编程的模式：
```
标准 CSS（包含未来标准的后处理器实现）-> 生产环境 CSS
```

## 3. Refer Links

[抛开语法，深度剖析 CSS 预处理器](https://div.io/topic/1768)

[CSS 预处理器与 CSS 后处理器](http://caibaojian.com/css-processor.html)
