- [C 语言：预处理](#c-语言预处理)
  - [1. 宏定义](#1-宏定义)
  - [2. 条件编译](#2-条件编译)
  - [3. Refer Links](#3-refer-links)

# C 语言：预处理

## 1. 宏定义

C 语言中允许用一个标识符来标识一个字符串，称为“宏”，标识符为“宏名”。在编译预处理时，对程序中所有出现的“宏名”，都用宏定义时的字符串去代换，简称“宏代换”或“宏展开”。

宏可分为两类：有参数和无参数。
- 无参宏

  凡是以“#”开头的均为预处理命令。“define”为宏定义的命令，标识符为定义的宏名；字符串可以是常量、表达式、格式化字符串等。  一般形式：
  ```
  #define 宏名 字符串
  ```

  eg：
  ```c
  #define P printf
  #define D "%d\n"
  #define F "%f\n"

  int main()
  {
      int a = 5;
      float b = 3.8;
      p(D F, a, b);
  }
  ```

  NOTE
  - 在宏定义时，其字符串要用小括号括起来，否则会产生出错误的编译，在运行时，得不到想要的结果；例如`#define M (x*3+x*5)`。
  - 宏定义不需要再行末加分号，若加上分号，则会连分号也会被替换。
  - 宏定义的作用域：从定义命令至程序结束，若想终止宏的作用域，则使用`#undef`命令。
  - 宏定义是可以嵌套使用的，在展开时，由预处理程序层层替换。
  - define 和 typedef 的区别：
    - define：只是简单的宏替换。
    - typedef：是对类型说明符的重新命名，被命名的标识符具有类型定义说明功能。

- 有参宏

  C 语言允许有参宏（即宏带有参数）。在宏定义中的参数称之为“形式参数”，形式参数在编译的时候是不会分配空间的，在宏调用中的参数称之为“实际参数”。一般形式为：
  ```
  #define 宏名 ( 形参表 ) 字符串

  宏名 ( 实参表 )  
  ```

  eg:
  ```c
  #define SSSV(s1, s2, s3, v)  s1=l*w; s2=l*h; s3=w*h; v=l*w*h
  int main()
  {
      int l = 3, w = 4, h = 5, sa, sb, sc, vv;
      SSSV(sa, sb, sc, vv);
      printf("sa = %d\tsb = %d\tsc = %d\tvv = %d\n", sa, sb, sc, vv);
      return 0;
  }
  ```

  NOTE
  - 有参宏定义中，宏名和形参表之间不能有空格。
  - 在宏定义中的形参是标识符，而宏调用中的实参可以是表达式。
  - 在宏定义中，字符串内的形参通常用括号括起来，以免出错。
  - 宏定义也可以用来定义多个语句。

## 2. 条件编译

多个编译指令允许程序员有选择的编译程序源代码的不同部分，这种过程称为条件编译。

条件编译指令：
```
#if
#else
#elif
#endif
```

## 3. Refer Links
todo:
[C 语言 - 宏的世界](https://www.jianshu.com/p/5463d8a21444)

https://blog.csdn.net/acs713/article/details/6891837

http://km.oa.com/articles/show/5916?kmref=related_post