- [C++ 性能优化](#c-性能优化)
  - [1. 寻找优化点](#1-寻找优化点)
  - [2. 代码优化](#2-代码优化)
  - [3. 内存优化](#3-内存优化)
  - [4. 数据结构优化](#4-数据结构优化)
  - [5. Refer Links](#5-refer-links)

# C++ 性能优化

## 1. 寻找优化点

性能优化的关键点在于找准性能瓶颈，盲目优化则会事倍功半，因而找到性能优化点是成功的第一步。

性能分析工具：
- Perftop 可以很好的发现正在运行程序的高频采样点（能看到代码级的分布)，非常方便，同时也可以用 perf record 和 perf report 来生成性能火焰图来可视化分析热点所在。
- Valgrind

## 2. 代码优化

- 代码走读，通过理解和分析代码发现高频点。
- 重写高频函数，去除无效操作。
- 调整 if 顺序，高频调用置前，低频调用置后。

## 3. 内存优化

- 内存池
  - 若程序中有大量 new 和 delete 操作，可以考虑写个内存池来节省频繁申请和释放内存的开销，然后重载 operator new 来使用内存池分配内存和 operator detele 来回收内存至内存池。
  - operator new[] 和 operator detele[] 也可以重载，充分使用内存片第一个 size_t 记录的数组元素个数，就可以回收内存到对应内存池。
  - STL 的内存分配器都可以在定义时指定为我们手写的内存池分配器进行分配，从而进行优化。
- Cache miss 优化

## 4. 数据结构优化

若对性能要求非常苛刻，则可以针对场景设计出对应的数据结构来支持对应功能，考虑重写 STL。因为 STL 做了很多通用性的考虑，而越通用，则很大概率造成不高效，比如若系统需要频繁的用 HashMap，而 STL 的 unordered_map 中 hash 的键值为随机 int，则可针对场景设计一个无需求余操作的高效 HashMap。

## 5. Refer Links

[Linux 工具进阶 » 3. 性能优化](http://linuxtools-rst.readthedocs.io/zh_CN/latest/advance/03_optimization.html)