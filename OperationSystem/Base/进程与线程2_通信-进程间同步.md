- [进程与线程：进程间同步](#进程与线程进程间同步)
  - [1. 文件锁](#1-文件锁)
  - [2. 信号量 (semaphore)](#2-信号量-semaphore)
    - [2.1. XSI System V 信号量](#21-xsi-system-v-信号量)
    - [2.2. POSIX 有名信号量](#22-posix-有名信号量)
  - [3. Refer Links](#3-refer-links)

# 进程与线程：进程间同步

## 1. 文件锁

文件的存在与否来当锁，文件内容来交互数据。

## 2. 信号量 (semaphore)

TODO:
[system V 信号量和 Posix 信号量](https://blog.csdn.net/wangfeng2500/article/details/10541577)

[进程间通信——POSIX 有名信号量与无名信号量](https://blogof33.com/post/9/)

https://www.ctolib.com/topics-82885.html

信号量是一个计数器，可以用来控制多个进程对共享资源的访问。它通常作为一种锁机制，防止某进程正在访问共享资源时，其他进程也访问该资源。因此，主要作为进程间以及同一进程内不同线程之间的同步手段。

**信号量有两种实现：传统的 System V 信号量和新的 POSIX 信号量。它们所提供的函数很容易被区分：对于所有 System V 信号量函数，在它们的名字里面没有下划线**。例如，应该是 semget() 而不是 sem_get()。然而，所有的的 POSIX 信号量函数都有一个下划线。

下面列出了它们提供的所有函数清单：
- Systm V	
  - semctl()	
  - semget()	
  - semop()	
- POSIX
  - sem_getvalue()
  - sem_post()
  - sem_timedwait()
  - sem_trywait()
  - sem_wait()
  - sem_destroy()
  - sem_init()
  - sem_close()
  - sem_open()
  - sem_unlink()

- 初始化并打开有名信号量：sem_open()
- 创建 / 获得无名信号量：sem_init()
- 操作信号量：sem_wait()/sem_trywait()/sem_timedwait()/sem_post()/sem_getvalue()
- 退出有名信号量：sem_close()
- 销毁有名信号量：sem_unlink()
- 销毁无名信号量：sem_destroy()

有名信号量由 sem_open 打开，其第一个参数是一个字符串，正是该信号量的名字；**有名信号量由内核持续，正是因此多个进程间才能利用它**；由于是内核持续，一个进程结束了，信号量并不会被关闭删除，因而最后一个退出的进程，要负责关闭有名信号量并且将其从内核中删除。

**有名信号量可以通过名字访问，因此可以被任何知道它们名字的进程中的线程使用**。

**无名信号量由 sem_init 打开，不需要名字，进程持续，进程结束了，信号量就没了**，因此无名信号量往往在进程内使用，因此多用于线程间；sem_init() 的第二个参数，解释是，0 表示进程间不共享，1 表示进程间共享；实践结果是 1，多个进程间也无法共享，有些博客也说这个 1 是没用的；实际上还是有用的，看怎么用罢了，最后会使用共享内存的方式，用 sem_init 创建一个多进程间共享的信号量，实现同步与互斥。

**无名信号量只能存在于内存中**，要求使用信号量的进程必须能访问信号量所在的这一块内存，所以无名信号量只能应用在同一进程内的线程之间（共享进程的内存），或者不同进程中已经映射相同内存内容到它们的地址空间中的线程（即信号量所在内存被通信的进程共享）。意思是说无名信号量只能通过共享内存访问。

### 2.1. XSI System V 信号量

XSI system V 的信号量是信号量集，可以包括多个信号量（有个数组），每个操作可以同时操作多个信号量。

System V 的信号量一般用于进程同步，且是内核持续的，api 为：semget、semctl、semop。

### 2.2. POSIX 有名信号量

**POSIX 信号量意在解决 XSI 信号量接口的几个缺陷，它有两种类型的信号量，有名信号量和无名信号量。POSIX 有名信号量支持进程间通信，POSIX 无名信号量放在共享内存中时才可以用于进程间通信。**

POSIX 是单个信号量。

POSIX 的有名信号量一般用于进程同步，有名信号量是内核持续的。有名信号量的 api 为：sem_open、sem_close、sem_unlink。

## 3. Refer Links
