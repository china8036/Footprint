- [进程与线程：调度算法](#进程与线程调度算法)
  - [1. 调度时机](#1-调度时机)
  - [2. 重要指标](#2-重要指标)
  - [3. 非抢占式调度](#3-非抢占式调度)
    - [3.1. 先来先服务 (FCFS)](#31-先来先服务-fcfs)
    - [3.2. 最短作业优先 (SJF)](#32-最短作业优先-sjf)
  - [4. 抢占式调度](#4-抢占式调度)
    - [4.1. 最短剩余时间优先 (SRTN)](#41-最短剩余时间优先-srtn)
    - [4.2. 时间片轮转调度 (RB)](#42-时间片轮转调度-rb)
    - [4.3. 最高优先级调度](#43-最高优先级调度)
    - [4.4. 多级反馈队列调度](#44-多级反馈队列调度)
    - [4.5. 最短进程优先](#45-最短进程优先)
    - [4.6. 保证调度](#46-保证调度)
    - [4.7. 彩票调度](#47-彩票调度)
    - [4.8. 公平分享调度](#48-公平分享调度)
  - [5. Refer Links](#5-refer-links)

# 进程与线程：调度算法

如果硬件时钟提供 50Hz、60Hz 或其他频率的周期性中断，可以在每个时钟中断或在每 k 个时钟中断时做出调度决策。

根据如何处理时钟中断，可以把调度算法分为两类：

- 非抢占式调度算法

  非抢占式调度算法挑选一个进程，然后让该进程运行直到被阻塞（阻塞在 I/O 或等待另一个进程），或者直到该进程自动释放 CPU。即使该进程运行了若干小时，也不会被强迫挂起。

  因此，在时钟中断发生时不会进行调度，在处理完时钟中断后，如果没有更高优先级的进程等待到时，则被中断的进程会继续执行。

- 抢占式调度算法

  抢占式调度算法挑选一个进程，然后让该进程运行某个固定时段的最大值。如果在该时段结束时，该进程仍在运行，那么它被会被挂起，而调度程序挑选另一个进程运行（如果存在一个就绪进程）。

  进行抢占式调度处理，需要在时间间隔的末端发生时钟中断，以便把 CPU 控制返回给调度程序。因此，如果没有可用的时钟，那么非抢占式调度就是唯一的选择了。

![image](http://img.cdn.firejq.com/jpg/2018/7/13/636f578ffa47a779ba70d019e268fe1b.jpg)

TODO:

[CPU 调度算法总结](https://blog.csdn.net/u013616945/article/details/69569267)

[操作系统概念学习笔记三 CPU 调度算法 - 清水湾 - 博客园](https://www.cnblogs.com/wangtianxj/archive/2009/07/16/1525128.html)

[Redhat 性能调节指南 4.2. CPU 调度](https://access.redhat.com/documentation/zh-cn/red_hat_enterprise_linux/6/html/performance_tuning_guide/s-cpu-scheduler)

[Linux 内核调度算法（2）-- CPU 时间片如何分配](https://blog.csdn.net/russell_tao/article/details/7103012)

[Linux 内核调度算法（3）-- 多核系统的负载均衡](https://blog.csdn.net/russell_tao/article/details/7102297)

## 1. 调度时机

CPU 调度决策可在如下 4 种环境下发生：
- 当一个进程从运行状态切换到阻塞状态，例如：I/O 请求或调用 wait 以等待一个子进程的终止。
- 当一个进程从运行状态切换到就绪状态，例如：当出现中断。
- 当一个进程从阻塞状态切换到就绪状态，例如：I/O 完成。
- 当一个进程终止。

当调度只能发生在第一和第四种情况时，称调度方案是非抢占的，否则调度方案是可抢占的。

## 2. 重要指标

- 批处理系统：吞吐量，周转时间，CPU 利用率，公平平衡
- 交互系统：响应时间，公平平衡

## 3. 非抢占式调度

### 3.1. 先来先服务 (FCFS)

### 3.2. 最短作业优先 (SJF)

## 4. 抢占式调度

### 4.1. 最短剩余时间优先 (SRTN)

SJF 抢占式版本，即当一个新就绪的进程比当前运行进程具有更短完成时间时，系统抢占当前进程，选择新就绪的进程执行。

改善了短作业的周转时间，但如果源源不断有短任务到来，可能使长的任务长时间得不到运行，产生饥饿现象。

### 4.2. 时间片轮转调度 (RB)

每个进程被分配一个时间片，允许该进程在该时间段运行，如果在时间片结束时该进程还在运行，则剥夺 CPU 并分配给另一个进程，如果该进程在时间片结束前阻塞或结束，则 CPU 立即进行切换。

- 当时间片选择太长，其降级为先来先服务算法，引起对短的交互请求响应时间长
- 当时间片选择太短，会导致频繁的进程切换，浪费 CPU 时间。
- 通常选择为 20ms~50ms.
- 对进程表中不同进程的大小差异较大的有利，而对进程都是相同大小的不利。

### 4.3. 最高优先级调度

### 4.4. 多级反馈队列调度

### 4.5. 最短进程优先

### 4.6. 保证调度

### 4.7. 彩票调度

### 4.8. 公平分享调度

## 5. Refer Links
