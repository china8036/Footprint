- [Linux 权限控制](#linux-权限控制)
  - [1. 权限类型](#1-权限类型)
    - [1.1. 基本权限类型](#11-基本权限类型)
    - [1.2. 附加权限类型](#12-附加权限类型)
  - [2. 权限粒度](#2-权限粒度)
  - [3. 权限表示](#3-权限表示)
  - [4. Refer Links](#4-refer-links)

# Linux 权限控制

Linux/Unix 系统中对文件的权限有着严格的控制，如果想对某个文件执行某种操作，必须具有对应的权限才能执行成功。

## 1. 权限类型

### 1.1. 基本权限类型

文件的基本权限类型一般包括：
- 读权限，用 `r`(read) 表示
- 写权限，用 `w`(write) 表示
- 执行权限，用 `x`(execute) 表示
- 无权限，用 `-` 表示

NOTE:

Linux/unix 下文件的权限只控制对文件**内容**的访问 / 修改 / 执行，对**文件**本身的控制是由父目录的权限决定的。

- 对于普通用户：
  - 显示目录（如 ls）需要对目录拥有读权限 (r)。
  - 进入目录（如 cd）需要对目录拥有执行权限 (x)。
  - 创建文件（如 touch、mkdir）和删除文件（如 rm）需要对父目录拥有执行权限 (x) （需要先进入目录才能操作）和写权限 (w)，不需要对文件有任何权限。
  - 读取文件（如 cat）需要对父目录拥有执行权限 (x)（需要先进入目录才能操作），对文件拥有读权限 (r)。
  - 修改文件（如 vim）需要对父目录拥有执行权限 (x)（需要先进入目录才能操作），对文件拥有读权限 (r) 和写权限 (w)。
  - 执行文件需要对父目录拥有执行权限 (x)（需要先进入目录才能操作），对文件拥有执行权限 (x)。

  例：在用户目录下（$HOME）有一个文件 file（$HOME/file），该 file 的 owner 为 root，即权限为 -rw-r--r--;$USER 虽然没有 file 的 write 权限，但是仍可以删除该 file 文件。因为 $USER 拥有 $HOME 目录的 write 和 execute 权限。

- 对于超级用户 (root)：无论权限如何，都可以进入目录，进行读写和执行操作。

### 1.2. 附加权限类型

除了正常的读写操作权限之外，Linux 文件系统还包含了附加权限类型：
- SET 位权限 (SET UID & SET GID)

  SUID/SGID 是为了使没有取得特权的用户要完成一项必须要有特权才可以执行的任务而产生的，一般用于给可执行的程序或脚本文件，其中 SUID 表示对属主用户增加 SET 位权限，SGID 表示对属组内用户增加 SET 位权限。**可执行文件被设置了 SUID、SGID 权限后，任何用户执行该文件时，将获得该文件属主、属组账号对应的身份**。在许多环境中，SUID 和 SGID 很管用，但是不恰当地使用这些位可能使系统的安全遭到破坏。所以应该尽量避免使用 SET 位权限程序。

  **如果一个文件被设置了 SUID 或 SGID 位，会分别表现在所有者或同组用户的权限的可执行位上**。如果文件设置了 SUID 还设置了 x（执行）位，则相应的执行位表示为 s（小写)。如果没有设置 x 位，则相应的位将表示为 S（大写)：
  ```
  -rwsr-xr-x 表示 SUID 被设置，且拥有者有可执行权限
  -rwSr--r-- 表示 SUID 被设置，但拥有者没有可执行权限
  -rwxr-sr-x 表示 SGID 被设置，且群组用户有可执行权限
  -rw-r-Sr-- 表示 SGID 被设置，但群组用户没有可执行权限
  ```

- 粘滞位权限 (Sticky)

  粘滞位权限一般用于为目录设置特殊的附加权限，**当目录被设置了粘滞位权限后，即便用户对该目录有写的权限，也不能删除该目录中其他用户的文件数据**。

  **如果一个文件或目录被设置了粘滞位权限，会表现在其他组用户的权限的可执行位上**。如果文件设置了 sticky 还设置了 x（执行）位，其他组用户的权限的可执行位为 t（小写）。但是，如果没有设置 x 位，它将表示为 T（大写）：
  ```
  -rwsr-xr-t 表示设置了粘滞位且其他用户组有可执行权限
  -rwSr--r-T 表示设置了粘滞位但其他用户组没有可执行权限
  ```

## 2. 权限粒度

权限粒度一般分为三级：`owner`、`group`、`others`，每个文件都可以针对三个粒度，设置不同的 rwx 权限。通常情况下，一个文件只能归属于一个用户和组， 如果其它的用户想有这个文件的权限，则可以将该用户加入具备权限的群组，一个用户可以同时归属于多个组。

eg: `-rwxr--r--` 表示 `-（文件类型）×××（所有者权限）×××（组用户权限）×××（其他用户权限）`

## 3. 权限表示

一个文件的所有权限详情，一般有 2 种表示方式：
- **10 位二进制表示法**：三个属组每个都使用 3 个二进制位表示，再加一个最高位共十位，可简化为 3 位八进制形式。

  如果我们将各个位置权限的有无用二进制数 1 和 0 来代替，则只读、只写、只执行权限，可以用 3 位二进制数来表示，且可以转换为八进制数如下：
  ```
  r-- = 100(2) = 4(8)
  -w- = 010(2) = 2(8)
  --x = 001(2) = 1(8)
  --- = 000(2) = 0(8)
  ```
  也就是说，r、w、x 权限可以分别用数字表示如下：
  - r(read) 权限为 4
  - w(write) 权限为 2
  - x(execute) 权限为 1
  我们可以进一步将所有的权限用二进制形式表现出来，并进一步转变成八进制数字：
  ```
  rwx = 111 = 7
  rw- = 110 = 6
  r-x = 101 = 5
  r-- = 100 = 4
  -wx = 011 = 3
  -w- = 010 = 2
  --x = 001 = 1
  --- = 000 = 0
  ```

  如果我们将每个属组的权限都用八进制数表示，则文件的权限可以表示为 3 位八进制数：
  ```
  -rw------- (600)      只有拥有者有读写权限。
  -rw-r--r-- (644)      只有拥有者有读写权限；而属组用户和其他用户只有读权限。
  -rwx------ (700)      只有拥有者有读、写、执行权限。
  -rwxr-xr-x (755)      拥有者有读、写、执行权限；而属组用户和其他用户只有读、执行权限。
  -rwx--x--x (711)      拥有者有读、写、执行权限；而属组用户和其他用户只有执行权限。
  -rw-rw-rw- (666)      所有用户都有文件读、写权限。
  -rwxrwxrwx (777)      所有用户都有读、写、执行权限。
  ```

  对于最高位，它代表的是文件的类型，类型可以是下面几个中的一个：
  - `d` 代表的是目录 (directroy)。
  - `-` 代表的是文件 (regular file)。
  - `s` 代表的是套接字文件 (socket)。
  - `p` 代表的管道文件 (pipe) 或命名管道文件 (named pipe)。
  - `l` 代表的是符号链接文件 (symbolic link)。
  - `b` 代表的是该文件是面向块的设备文件 (block-oriented device file)。
  - `c` 代表的是该文件是面向字符的设备文件 (charcter-oriented device file)。

- **12 位二进制表示法**：可简化为 4 位八进制形式。

  12 位二进制的权限表示法在 10 位二进制表示法的基础上，高 3 位分别表示 SUID、SGID、Sticky 权限的有无，即第 11 位为 SUID 位，第 10 位为 SGID 位，第 9 位为 sticky 位，第 8-0 位对应于上面的三组 rwx 位（后九位）。
  ```
  -rw-r-sr-- 的值为： 0 1 0  1 1 0  1 0 0  1 0 0
  -rwsr-xr-x 的值为： 1 0 0  1 1 1  1 0 1  1 0 1
  -rwsr-sr-x 的值为： 1 1 0  1 1 1  1 0 1  1 0 1
  -rwsr-sr-t 的值为： 1 1 1  1 1 1  1 0 1  1 0 1
  ```
  将前三位 `SGT` 也转换成一个八进制数，则：
  - SUID 权限为 4
  - SGID 权限为 2
  - Sticky 权限为 1

  因此，文件的权限可以表示为 4 位八进制数
  ```
  -rw-r-sr-- = 0 1 0 1 1 0 1 0 0 1 0 0 = 2644
  -rwsr-xr-x = 1 0 0 1 1 1 1 0 1 1 0 1 = 4755
  -rwsr-sr-x = 1 1 0 1 1 1 1 0 1 1 0 1 = 6755
  -rwsr-sr-t = 1 1 1 1 1 1 1 0 1 1 0 1 = 7755
  ```

## 4. Refer Links
