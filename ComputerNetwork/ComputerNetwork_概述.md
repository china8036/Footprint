- [计算机网络：概述](#计算机网络概述)
  - [1. 网络分类](#1-网络分类)
  - [2. 网络模型](#2-网络模型)
    - [2.1. OSI 模型](#21-osi-模型)
      - [2.1.1. 内容](#211-内容)
      - [2.1.2. 缺陷](#212-缺陷)
    - [2.2. TCP/IP 模型](#22-tcpip-模型)
      - [2.2.1. 内容](#221-内容)
      - [2.2.2. 缺陷](#222-缺陷)
    - [2.3. 比较](#23-比较)
  - [3. 相关概念](#3-相关概念)
    - [3.1. 互联网络](#31-互联网络)
    - [3.2. 对等通信](#32-对等通信)
    - [3.3. 通信信道](#33-通信信道)
    - [3.4. 差错控制](#34-差错控制)
      - [3.4.1. 纠错码](#341-纠错码)
      - [3.4.2. 检错码](#342-检错码)
    - [3.5. 流量控制](#35-流量控制)
    - [3.6. 拥塞控制](#36-拥塞控制)
    - [3.7. 服务质量保证](#37-服务质量保证)
      - [3.7.1. QoS 服务模型](#371-qos-服务模型)
      - [3.7.2. QoS 关键指标](#372-qos-关键指标)
  - [5. Refer Links](#5-refer-links)

# 计算机网络：概述

## 1. 网络分类

- 个域网 (PAN)
  
  围绕个人通信，如蓝牙、图书上的 RFID、智能卡等，包含了蓝牙标准 IEEE 802.15，zigbee 等。

- 局域网 (LAN)
  
  如私有网络、企业内网、无线路由器
  - 无线 LAN：以 IEEE 802.11 (wifi) 为标准
  - 有线 LAN：以 IEEE 802.3（以太网）为标准

- 城域网 (MAN)
  
  如有线电视网，以 IEEE 802.16（WiMAX / 宽带无线） 为标准

- 广域网 (WAN)
  
  如 ISP、ARPANET（分组交换网络）（Internet 前身）

## 2. 网络模型

### 2.1. OSI 模型

开放式系统互联通信参考模型 (OSI 模型，Open System Interconnection Reference Model) 由国际标准化组织 (ISO) 提出，是一个旨在使各种计算机在世界范围内互连为网络的标准框架，定义于 ISO/IEC 7498-1。

#### 2.1.1. 内容

![image](http://img.cdn.firejq.com/jpg/2018/6/16/951d80ecfc09b9e6c00f2b7aa0b56e39.jpg)

![image](http://img.cdn.firejq.com/jpg/2018/6/10/49971354a6408e2f739d3d50efc4042c.jpg)

根据建议 X.200，OSI 将计算机网络体系结构划分为以下七层：
- 应用层（Application Layer）

  提供为应用软件而设的接口，以设定与另一应用软件之间的通讯。例如：HTTP，HTTPS，FTP，TELNET，SSH，SMTP，POP3 等。

  **端到端连接，交换的数据单元为数据 (data)，称为 APDU (Application Protocol Data Unit)**。

- 表示层（Presentation Layer）

  表示层以下的各层关注的是如何传递数据位，而表示层关注的是所传递信息的语法、语义和编码格式。

  **端到端连接，交换的数据单元为数据 (data)，称为 PPDU (Presentation Protocol Data Unit)**。

- 会话层（Session Layer）

  使得不同机器的用户可以建立会话。会话层往往需要提供堆化控制、令牌管理、同步功能等服务。

  **端到端连接，交换的数据单元为数据 (data)，称为 SPDU (Session Protocol Data Unit)**。

- 传输层（Transport Layer）

  接收来自上一层的数据，在必要时将这些数据分割成较小的单元，然后把这些数据单元传递给网络层，并确保这些数据单元正确地到达了另一端。例如：传输控制协议（TCP）等。

  **端到端连接，将数据从源端携带到目的端。交换的数据单元为数据段 (segment)，称为 TPDU (Transport Protocol Data Unit)**。

- 网络层（Network Layer）

  决定数据的路径选择（路由）和转发，将网络表头（NH）加至数据包，以形成封包。例如：互联网协议（IP）等。

  网络层需要解决以下问题：
  - 将数据包从源端路由到目的端。
  - 处理网络拥塞。
  - 解决不同网络的协议差异，从而允许异构网络相互连接称为互联网络。

  **点到点（链路）连接，交换的数据单元为数据包 (package)**。

- 数据链路层（Data Link Layer）

  负责网络寻址、错误侦测和改错，把表头和表尾被加至数据包，以形成数据帧（数据链表头（DLH）包含了实体位址和错误侦测及改错的方法，数据链表尾（DLT）是一串指示数据包末端的字符串）。包括以太网、无线局域网（Wi-Fi）和通用分组无线服务（GPRS）等。
  
  数据链路层需要解决以下问题：
  - 掩盖物理层的真实错误，将一个原始的传输设施转变成一条没有漏检传输错误的线路。发送方将输入的数据拆分成数据帧，然后顺序发送这些数据帧，一个数据帧通常为几百或几千个字节。如果服务是可靠的，那么接收方必须为正确接收的每一帧都回复一个确认帧。
  - 通过流量调节机制，避免一个快速发送方用数据“淹没”一个慢速接收方。
  - 控制对信道的共享访问。介质访问控制子层专门用于处理这个问题。

  数据链路层包含了两个特殊子层：
  - 逻辑链路控制（logic link control，LLC）子层
  - 介质访问控制（media access control，MAC）子层

  **点到点（链路）连接，交换的数据单元为数据帧 (frame)**。

- 物理层（Physical Layer）

  关注在一条通信信道上原始比特的传输，包括针脚、电压、线缆规范、集线器、中继器、网卡、主机介面卡等。

  **点到点（链路）连接，交换的数据单元为比特 (bit)，即 0 和 1 的比特传输**。

#### 2.1.2. 缺陷

OSI 参考模型并没有提供一个可以实现的方法，而是描述了一些概念，用来协调进程间通信标准的制定。即 **OSI 参考模型并不是一个标准，而是一个在制定标准时所使用的概念性框架**。

### 2.2. TCP/IP 模型

TCP/IP 参考模型最初由 Vinton Cerf（互联网之父） 和 Robert E. Kahn 描述，后来又被重新修订并得到了 Internet 团体的标准化，并由互联网工程任务组负责维护。TCP/IP 参考模型以 TCP/IP Protocol Stack 中最核心的 2 个协议进行命名，常被视为是简化的七层 OSI 模型。

#### 2.2.1. 内容

![image](http://img.cdn.firejq.com/jpg/2018/6/10/5d10a21befe0b9df0e3deff1c0af7ed3.jpg)

![image](http://img.cdn.firejq.com/jpg/2018/6/11/241bbd606415baeacaf8463234259927.jpg)

TCP/IP 模型将计算机通信过程抽象为 4 个层次，采取协定堆叠的方式，分别实作出不同通信协定：
- 应用层（Application Layer），如 HTTP、FTP、DNS 等。 
- 传输层（Transport Layer），如 TCP、UDP、RTP、SCTP 等。
- 网络层（Internet Layer），如 IP、ICMP、IGMP 等。
- 链路层（Link Layer），如以太网、Wi-Fi、MPLS 等。

#### 2.2.2. 缺陷

- 该模型没有明确区分服务、接口和协议。
- 通用性差，不适用用于描述 TCP/IP 之外的任何其它协议栈，如蓝牙。
- 没有区分物理层和数据链路层。物理层需要考虑铜线、光纤和无线通信的传输特征，而数据链路层需要确定帧的开始和结束并把帧从一边发送到另外一边，这是 2 个完全不同的层。

### 2.3. 比较

![image](http://img.cdn.firejq.com/jpg/2018/5/26/af86b13a2995d8ace66981d17431d9f0.jpg)

## 3. 相关概念

### 3.1. 互联网络

多个网络的链接称为互联网络。**互联网 (Internet) 是最著名的互联网络实例，但不是唯一的**。

### 3.2. 对等通信

### 3.3. 通信信道

通信信道在概念上就像一条线路（如同轴电缆、电话线、无线信道），其本质特性使得信道上传递的比特顺序宇发送顺序完全一样。

### 3.4. 差错控制

网络设计者针对差错控制已研究出 2 种基本策略，这 2 种策略都需要在发送的数据中加入冗余信息：
- 纠错码 / 前向纠错 (FEC)
  - 在每一个被发送的数据块中包含足够多的冗余信息，以便接收方能据此推断出被发送的数据是什么。
  - 应用：在错误发生频繁的信道上（如无线链路），更好的做法是在每一个数据块中加入足够的冗余信息，以便接收方能计算出原始的正确数据块。**纠错码一般出现在物理层，特别是有噪声干扰的信道**。
- 检错码
  - 在每一个被发送的数据块中只包含少量的冗余信息，这些信息只能让接收发推断出是否发生了错误，而推断不出哪个哪里发生了错误，然后接收发可以请求发送方重传。
  - 应用：在高度可靠的信道上（如光纤），较为合理的做法是使用检错码，当偶尔发生错误时只需重传整个数据块即可。**检错码更经常被用在链路层、网络层和传输层**。

#### 3.4.1. 纠错码

- 海明码
  - 码字：包含数据 m 位和校验位 r 位的 n 位单元 (n=m+r)。
  - 码率 / 速率：码字中不包含冗余部分所占的比例，即 m/n。
  - 海明距离：两个码字之间不同的位的数目，如：10001001 和 10110001 的海明距离为 3，也即异或后结果中 1 的个数。

    全部码字的海明距离：全部码字中任意两个码字之间海明距离的最小值。

    海明距离的意义：
    - 如果海明距离为 d，则一个码字需要发生 d 个 1 位错误才能变成另外一个码字。
    - 为了检测 d 个错误，需要一个距离为 d+1 的编码方案。
    - 为了纠正 d 个错误，需要一个距离为 2d+1 的编码方案。
  - 在给定 m 的情况下，纠正单个错误至少需要的校验位数 r：`(m+r+1) <= 2^r`.
  - 海明纠错码

    海明码的检错、纠错基本思想是将有效信息按某种规律分成若干组，每组安排一个校验位进行奇偶性测试，然后产生多位检测信息，并从中得出具体的出错位置，最后通过对错误位取反来将其纠正。

    采用海明码纠错，需要按以下步骤来进行：确定校验位数 → 确定校验集合 → 实现校验和纠错。

    过程：
    1. 每一个码字从左到右编号，最左边为第 1 位。
    1. 凡编号为 2 的乘幂的位是校验位，如 1、 2、 4、 8、16……，其余是数据位，如 3、 5、 6、 7、 9……。
    1. 每一个校验位设置根据：包括自己在内的一些位的集合的奇偶值（奇数或偶数)。

- 二进制卷积码

- 里德所罗门码

- 低密度奇偶校验码

  Data: 1011010 （1 的个数是 4，偶数）
  - 采用偶校验：1011010 0：1 的个数是偶数，校验位取 0。
  - 采用奇校验：1011010 1：1 的个数是偶数，校验位取 1。

#### 3.4.2. 检错码

在高度可靠的信道（如光纤）上，较为合算的做法是使用检错码，当偶尔发生错误时重传整个数据块即可。

- 奇偶

  海明距离为 2，检 1 位错。

- 校验和
  
  校验和通常是按照 N 位码字来进行模 2 和运算，并将运算结果附加在数据报文尾部，作为校验位。

- 循环冗余校验 (CRC)

  **计算机网络主要采用循环冗余码 (CRC) 来作为检错码**。

  <!-- TODO: http://blog.csdn.net/lycb_gz/article/details/8201987  -->

### 3.5. 流量控制

当发送方的发送速率相比接收方的接收速率快很多时，可能导致接收方被数据“淹没”。因此，需要确保一个一个快速的发送方不会持续地以超过接收方接受能力的速率传输数据，这种措施称为流量控制。

流量控制与特定的发送方和特定的接收方之间的点到点流量有关，**一般在数据链路层中进行处理**。

### 3.6. 拥塞控制

当一个子网或子网的一部分中出现太多分组时，会导致数据包被延迟甚至丢失，网络性能急剧下降，这种情况称为拥塞 (Congestion)。

![image](http://img.cdn.firejq.com/jpg/2018/6/11/31191336cf135d55df75f7c3b6df9134.jpg)

导致拥塞的因素：
- 输入流量速度大于输出线路的容量。
- 慢速的处理器也可能引起拥塞，如线路容量充足，但处理器来不及处理。
- 线路容量和处理器能力不平衡。

拥塞量度（数值越大表示拥塞的程度越严重）：
- 由于缺乏缓存空间而丢弃的分组百分比
- 平均队列长度
- 超时和重传的分组数
- 平均分组延迟
- 分组延迟的标准方差 (standard deviation)

理想中的网络应尽可能地避免拥塞，如果确实发生了拥塞也不会遭遇拥塞崩溃。但实际上，**拥塞不可能完全避免**。拥塞控制的任务就是确保网络能够承载所有到达的流量，这是一个全局性的问题，包括所有主机和所有路由器。

**网络层和传输层共同承担着处理拥塞的责任**：
- 由于拥塞发生在网络层中，网络层直接经历着拥塞，且必须由它最终确定如何处理过载的数据包，因此网络层必须提供拥塞控制的功能。
- 拥塞控制最有效的方法是减少传输层注入网络层的负载，因此，拥塞控制需要网络层和传输层共同努力协调工作。
  - 事实上，**Internet 的拥塞控制严重依赖于传输层，TCP 和其它协议中嵌入了大量用于拥塞控制的特殊算法**。

### 3.7. 服务质量保证

服务质量（Quality of Service，QoS）保证指一个网络能够利用各种基础技术，为指定的网络通信提供更好的服务能力，以提供与应用需求相匹配的服务质量。它是网络的一种安全机制，用来解决网络延迟和阻塞等问题。

在正常情况下，如果网络只用于特定的无时间限制的应用系统，“尽力而为”的服务足以满足而并不需要 QoS，比如 Web 应用，或 E-mail 设置等。然而，存在一些应用对网络性能的保障有很强的需求，特别是多媒体应用往往需要具备最小延迟和最大吞吐量条件才能正常工作。当网络过载或拥塞时，QoS 能确保重要业务量不受延迟或丢弃，同时保证网络的高效运行。

#### 3.7.1. QoS 服务模型

通常 QoS 提供以下三种服务模型：
- Best-Effort service（尽力而为服务模型）。
- Integrated service（综合服务模型，简称 Int-Serv）。
- Differentiated service（区分服务模型，简称 Diff-Serv）。

#### 3.7.2. QoS 关键指标

数据包从起点到终点的传输过程中会发生许多事情，并可能产生如下有问题的结果：
- 丢失数据包：
  
  当数据包到达一个缓冲区（buffer）已满的路由器时，则代表此次的发送失败，路由器会依网络的状况决定要丢弃、不丢弃一部份或者是所有的数据包，而且这不可能在预先就知道，接收端的应用程序在这时必须请求重新传送，而这同时可能造成总体传输严重的延迟。

- 延迟：
  
  或许需要很长时间才能将数据包传送到终点，因为它会被漫长的队列迟滞，或需要运用间接路由以避免阻塞；也许能找到快速、直接的路由。总之，延迟非常难以预料。

- 传输顺序出错：
  
  当一群相关的数据包被路由经过因特网时，不同的数据包可能选择不同的路由器，这会导致每个数据包有不同的延迟时间。最后数据包到达目的地的顺序会和数据包从发送端发送出去的顺序不一致，这个问题必须要有特殊额外的协议负责刷新失序的数据包。

- 出错：
  
  有些时候，数据包在被运送的途中会发生跑错路径、被合并甚至是毁坏的情况，这时接收端必须要能侦测出这些情况，并将它们统统判别为已遗失的数据包，再请求发送端再送一份同样的数据包。

针对这些问题，QoS 的关键指标主要包括：可用性、吞吐量、时延、时延变化（包括抖动和漂移) 和丢失：

- 丢包
  
  数据在通信网络上是以数据包为单位传输的，每个数据包中有表示数据信息和提供数据路由的帧。这就是说，不管网络情况有多好，数据都不是以线性（就像打电话一样）连续传输的，中间总是有空洞的。数据包的传输，不可能百分之百的能够完成，因为物理线路故障、设备故障、病毒攻击、路由信息错误等原因，总会有一定的损失。碰到这种情况，网络会自动的让通信的两端根据协议来补包。如果线路情况好，速度快，包的损失会非常小，补包的工作也相对较易完成，因此可以近似的将数据看作是无损传输。但是，如果线路较差（如用调制解调器），数据的损失量就会非常大，补包工作也不可能百分之百完成。在这种情况下，数据的传输就会出现空洞，造成丢包。
  
  不管是比特丢失还是分组丢失，对分组数据业务的影响比对实时业务的影响都大。在通话期间，丢失一个比特或一个分组的信息往往用户注意不到。在视像广播期间，这在屏幕上可能造成瞬间的波形干扰，然后视像很快恢复如初。即便是用传输控制协议 (TCP) 传送数据也能处理丢失，因为传输控制协议允许丢失的信息重发。事实上，一种叫做随机早丢 (RED) 的拥塞控制机制在故意丢失分组，其目的是在流量达到设定门限时抑制 TCP 传输速率，减少拥塞，同时还使 TCP 流失去同步，以防止因速率窗口的闭合引起吞吐量摆动。但分组丢失多了，会影响传输质量。所以，要保持统计数字，当超过预定门限时就向网络管理人员告警。

- 时延变化
  
  时延变化是指同一业务流中不同分组所呈现的时延不同。**高频率的时延变化称作抖动，而低频率的时延变化称作漂移**。

  - 抖动 (jitter)

    延迟的变化（标准方差）或数据包到达时间的变化（标准方差）称为抖动。如果网络发生拥塞，排队延迟将影响端到端的延迟，并导致通过同一连接传输的分组延迟各不相同，而抖动就是用来描述这样一延迟变化的程度。

    抖动对于话音和视像等实时性的传输将会是一个重要参数，比如：VOIP(Voice over Internet Protocol)，视频等，分组到达时间的差异将在话音或视像中造成断续，特别对于音频，几毫秒的抖动都能被清晰的听到，因此这些实时业务是极不容忍抖动的。

    抖动控制：通过计算出沿途每一跳的期望传输时间，就可以控制抖动。当一个分组到达路由器，路由器检查这个分组，看它是来晚了还是来早了：
    - 如果分组来早了，那么它可能多停留一些时间，以便回到预定的时间点上。
    - 如果分组来晚了，路由器应该尽可能快地将他转发出去。

    当几个分组都要使用同一根输出线路转发出去，哪一个分组优先呢？
    - 路由器总是让偏离预定时间最远的那个分组优先转发。

    **所有传送系统都有抖动，但只要抖动落在规定容差之内就不会影响服务质量**。利用**缓存**可以克服过量的抖动，但这将增加时延，造成其他问题。

    <!-- TODO: 为什么增加 TCP 窗口大小，会加重抖动情况？ -->

  - 漂移
  
    漂移是任何同步传输系统都有的一个问题。在 SDH 系统中是通过严格的全网分级定时来克服漂移的。在异步系统中，漂移一般不是问题。漂移会造成基群失帧，使服务质量的要求不能满足。

- 延迟 / 时延

  时延指一项服务从网络入口到出口的平均经过时间。许多服务，特别是话音和视像等实时服务都是高度不能容忍时延的。当时延超过 200-250 毫秒时，交互式会话是非常麻烦的。为了提供高质量话音和会议电视，网络设备必须能保证低的时延。
  
  产生时延的因素很多，包括分组时延、排队时延、交换时延和传播时延。传播时延是信息通过铜线、光纤或无线链路所需的时间，它是光速的函数。在任何系统中，包括同步数字系列 (SDH)、异步传输模式（ATM）和弹性分组环路 (RPR)，传播时延总是存在的。

- 吞吐量

  吞吐量是在一定时间段内对网上流量（或带宽) 的度量。对 IP 网而言可以从帧中继网借用一些概念。根据应用和服务类型，服务水平协议 (SLA) 可以规定承诺信息速率 (CIR)、突发信息速率 (BIR) 和最大突发信号长度。承诺信息速率是应该予以严格保证的，对突发信息速率可以有所限定，以在容纳预定长度突发信号的同时容纳从话音到视像以及一般数据的各种服务。一般讲，吞吐量越大越好。

- 可用性

  **可用性是当用户需要时网络即能工作的时间百分比**，可用性主要是设备可靠性和网络存活性相结合的结果。对它起作用的还有一些其他因素，包括软件稳定性以及网络演进或升级时不中断服务的能力。

<!-- TODO: 各种应用服务关注的 QoS 指标是什么？ -->

不同的应用程序对 QoS 指标有不同的要求，如：
- 电话服务要求低抖动，不要求高带宽。
- 视频点播要求低抖动，不要求低延迟。
- 远程登陆要求低延迟。
- IP 语音比 web 访问要求更低的抖动。
- 文件共享 （如 BitTorrent 下载） 比电子邮件要求更高的服务质量。

## 5. Refer Links

[wikipedia: OSI 模型](https://zh.wikipedia.org/wiki/OSI%E6%A8%A1%E5%9E%8B)

[wikipedia: TCP/IP 协议族](https://zh.wikipedia.org/wiki/TCP/IP 协议族)

[车小胖谈网络：MTU 与 MSS](https://blog.csdn.net/scythe666/article/details/51967606)

[详解 IP 分片与 TCP 分段的区别](https://blog.csdn.net/qq_15437629/article/details/79873993)

[TCP/IP 协议栈中，为什么选择 IP 层负责分片？](https://www.zhihu.com/question/22181709)

[OSI 模型中，一个协议应该属于哪一层是以什么为标准划分的？](https://www.zhihu.com/question/27668104)