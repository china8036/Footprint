- [计算机网络：网络硬件](#计算机网络网络硬件)
  - [1. 基本概念](#1-基本概念)
    - [1.4. 单播 & 广播 & 组播](#14-单播--广播--组播)
    - [1.5. 冲突域 & 广播域](#15-冲突域--广播域)
      - [1.5.1. 冲突域 (collision domain)](#151-冲突域-collision-domain)
      - [1.5.2. 广播域 (Broadcast domain)](#152-广播域-broadcast-domain)
      - [1.5.3. 域的隔离](#153-域的隔离)
    - [1.6. 共享式网络 & 独享式网络](#16-共享式网络--独享式网络)
  - [2. 硬件设施](#2-硬件设施)
    - [2.1. 网卡 (NIC)](#21-网卡-nic)
    - [1.1. 网关](#11-网关)
    - [1.2. 网桥 (Bridge)](#12-网桥-bridge)
    - [1.3. 中继器](#13-中继器)
    - [2.2. 集线器 (Hub)](#22-集线器-hub)
    - [2.3. 交换机 (Switch)](#23-交换机-switch)
      - [2.3.1. 作用](#231-作用)
      - [2.3.2. 工作原理](#232-工作原理)
      - [2.3.3. 交换模式](#233-交换模式)
    - [2.4. 路由器 (Router)](#24-路由器-router)
      - [2.4.1. 基本结构](#241-基本结构)
      - [2.4.2. 个例解释](#242-个例解释)
    - [2.5. 猫](#25-猫)
    - [2.6. 比较](#26-比较)
  - [3. Refer Links](#3-refer-links)

# 计算机网络：网络硬件

## 1. 基本概念

### 1.4. 单播 & 广播 & 组播

广播的类型可分为二层广播和三层广播：
- 二层广播：目的 MAC（广播地址） xx.xx.xx.xx.xx.FF，不可跨路由器；
- 三层广播：目的 IP（广播地址）x.x.x.255，在二层是单播，但可跨路由器，在三层是广播；

### 1.5. 冲突域 & 广播域

#### 1.5.1. 冲突域 (collision domain)

- 在以太网中，如果某个 CSMA/CD 网络上的两台计算机在同时通信时会发生信道冲突，那么这个 CSMA/CD 网络就是一个冲突域（collision domain)。如果以太网中的各个网段以集线器连接，因为不能避免冲突，所以它们仍然是一个冲突域。
- **冲突域属于 OSI 第一层（物理相连的主机间会冲突)**。

#### 1.5.2. 广播域 (Broadcast domain)

- 广播域是计算机网络的一个逻辑划分。广播域中的任意一个节点可以在数据链路层通过广播的方式到达任意一个节点。广播域可以被部署在同一个局域网或者被桥接到其他的局域网。
- 任意连接到同一个以太网中继器或者交换机的电脑属于同一个广播域，并且任意连接到同一个互相链接的中继器或交换机的集合的电脑也是属于同一个广播域的。而路由器和其他的网络层设备会在广播域间形成隔离。
- 广播域是一个区域（或者说集合)，在这个区域内，任一设备发出广播帧，其他设备都能接收到这个广播帧。
- **广播域可以跨网段，而冲突域只是发生的同一个网段的**。
- **广播域属于 OSI 第二层（数据链路层)**。

#### 1.5.3. 域的隔离

规则：**高层可以隔离低层的域**。如：
- 三层设备能隔离二层域和一层域：路由器可以隔离广播域和冲突域。
- 二层设备能隔离一层域：交换机、网桥可以隔离冲突域。

例 1：广播域个数计算

![image](http://img.cdn.firejq.com/jpg/2018/6/10/d194abf50cfc034f63ba34ff9571d3df.jpg)

如图，**路由器的每个端口就是一个广播域**，因此这里有 2 个广播域。

例 2：冲突域个数计算

![image](http://img.cdn.firejq.com/jpg/2018/6/10/1bdfd72dc5c27bd2fcca7ca8b0de4d2e.jpg)

如图，路由器和交换机都能隔离冲突域；Hub 是物理层设备，不能隔离冲突域；需要注意的是，路由器与交换机直连的线也属于一个冲突域；因此，这里共有 5 个冲突域。

### 1.6. 共享式网络 & 独享式网络

**共享式以太网**存在的主要问题是所有用户共享带宽，每个用户的实际可用带宽随网络用户数的增加而递减。这是因为当信息繁忙时，多个用户可能同时“争用”一个信道，而一个信道在某一时刻只允许一个用户占用，所以大量的用户经常处于监测等待状态，致使信号传输时产生抖动、停滞或失真，严重影响了网络的性能。

**独享式网络**的数据传输效率较高，不会出现广播风暴，在安全性方面也不易出现其它节点侦听的现象。

## 2. 硬件设施

### 2.1. 网卡 (NIC)

MAC 地址被烧录在网卡的 ROM 中。

### 1.1. 网关

**网关 (Gateway) 又称网间连接器、协议转换器，用于两个高层协议不同的网络互连，工作于应用层**。

网关可以分为：协议网关、应用网关和安全网关，它们可以在网络层以上实现网络互连。事实上，**网关不具体特指一类产品，只要连接两个高层协议不同的网络的设备都可以叫网关**。

网关既可以用于广域网互连，也可以用于局域网互连。

路由器可以作网关，集线器、交换机不可以。

### 1.2. 网桥 (Bridge)

**网桥工作在数据链路层，通过检查 MAC 地址做出转发帧的决策，决策是通过在网桥内部的一张地址表（hash table）中查找目的 MAC 地址而作出的**。

**网桥只会检查数据链路层，不会检查网络层**，所以，IPv4、IPv6、AppleTalk、ATM、IPX、OSI 分组均可穿越网桥。到达路由器时，才会检查逻辑地址（如 IP 地址）并作出分组转发的决策。

![image](http://img.cdn.firejq.com/jpg/2018/6/10/fd57b8a0f93908d7da8076b04eb9a952.jpg)

- 作用
  - **将广播域划分为一个一个小的冲突域，增大可用的带宽，在共享环境中的介质争用（冲突）**。
  - 广播域没有变小。
  - **网桥不涉及逻辑地址，所以它工作在第二层（数据链路层），并且端口很少**。
  - 网桥常常是基于软件的，因此可以处理上层事务。

- 工作原理
  
  当每一个帧到达时，网桥启动如下算法： 
  - 如果源 LAN 和目的 LAN 相同，则丢弃该帧。
  - 如果源 LAN 和目的 LAN 不同，则转发该帧。
  - **如果目的 LAN 未知，则广播该帧**。 

### 1.3. 中继器

**中继器（RP repeater）是局域网环境下用来延长网络距离的最简单最廉价的网络互联设备，工作在物理层上的连接设备**。适用于完全相同的两类网络的互连，主要功能是通过对数据信号的重新发送或者转发，对在线路上的信号具有放大再生的功能，来扩大网络传输的距离。

### 2.2. 集线器 (Hub)

集线器 (Hub) 是计算机网络中连接多个计算机或其他设备的连接设备，是对网络进行集中管理的最小单元，属于**一层（物理层）设备**。

集线器 (Hub) 是一个标准的共享式设备，主要提供信号放大和中转的功能，它把一个端口接收的所有信号向所有端口分发出去。且同一时刻只有一个端口下联的设备可以发送数据。

集线器本身不能识别 MAC 地址和 IP 地址，当集线器下连接的主机设备间传输数据时，数据包以广播的方式转发给每一台与 HUB 直连的主机，由每一台主机自己眼中 MAC 地址来确定是否接收；正常工作时，集线器随机选出某一端口设备并让它独占全部带宽与集线器上联设备（如交换机、路由器等）进行通信。因此，**集线器设备的所有端口即形成了一个冲突域**。

### 2.3. 交换机 (Switch)

交换机 (Switch) 属于**二层（数据链路层）设备**，在接收到数据后，通过查找自身系统 MAC 地址表中的 MAC 地址与端口对应关系，将数据传送到目的端口。交换机具有学习机制，转发数据包的同时会把其 MAC 地址与端口的映射关系存放在内部地址表中，通过在数据帧的始发者和目标接收者之间建立临时的交换路径，使数据帧直接由源地址到达目的地址。

交换机在同一时刻可进行多个端口之间的数据传输，每一端口都是独立的物理网段，连接在端口上的网络设备独自享有全部的带宽。因此，**交换机起到了分割冲突域的作用，每一个端口为一个冲突域（一条物理信道）**。

局域网中使用交换机（Switch）来分割冲突域。对网络进行分割的原因是为了分离流量并创建更小的冲突域来使用户获得更高的带宽，否则同一时刻数据太多容易导致网络拥挤形成阻塞。

有些交换机还额外地在第三层或以上处理数据，这些交换机常被称为三层交换机或多层交换机。

#### 2.3.1. 作用

- 使网络段处于无冲突环境。
- LAN 交换机利用现有硬件设备。
- 使配置和管理更加灵活方便。

#### 2.3.2. 工作原理

- `flooding`: 当目的地址未知或为广播地址时，桥发送帧到除源端口之外的每个端口。
- `learning`: 通过读取每个帧的源地址和对应源端口来学习连在网段上的每个设备的地址。
- `forwarding`: 对于已学到的目的地址，桥将直接送帧到对应的目的设备所在端口。
- `filtering`: 如果目的地址和源地址在同一端口，桥将丢掉帧。

#### 2.3.3. 交换模式

- 存储转发
- 直通交换（贯穿）
- 无分片交换

### 2.4. 路由器 (Router)

路由器 (Router) 属于三层（互联网层）设备，是连接因特网中各局域网、广域网的设备，提供路由与转送两种重要机制，可以决定封包从来源端到目的端所经过的路由路径（host 到 host 之间的传输路径），这个过程称为路由；将路由器输入端的封包移送至适当的路由器输出端（在路由器内部进行），这称为转发；会根据信道的情况自动选择和设定路由，以最佳路径，按前后顺序发送信号。 路由器是互联网络的枢纽，"交通警察"。

路由器又称网关设备（Gateway），用于**连接多个逻辑上分开的网络**，所谓逻辑网络是代表一个单独的网络或者一个子网。**当数据从一个子网传输到另一个子网时，可通过路由器的路由功能来完成**。因此，路由器具有判断网络地址和选择 IP 路径的功能，它能在多网络互联环境中，建立灵活的连接，可用完全不同的数据分组和介质访问方法连接各种子网，路由器只接受源站或其他路由器的信息，属网络层的一种互联设备。

**路由器的每个端口都是一个广播域，也是一个冲突域**。

现在的路由器大多是交换路由器产品，即把交换机的原理组合到路由器中，使路由器同时具有传统路由器和传统交换机的功能，使数据传输更好更快。

#### 2.4.1. 基本结构

![image](http://img.cdn.firejq.com/jpg/2018/6/10/7224529da22c2b5389f29797a56d3695.jpg)

- 电源接口（POWER）：接口连接电源。
- 复位键（RESET）：此按键可以还原路由器的出厂设置。
- WAN 接口：猫 (MODEM) 或者是交换机与路由器的连接口，此接口用一条网线与家用宽带调制解调器（或者与交换机）进行连接。
- LAN 接口：PC 机与路由器连接口（LAN1~4）：此接口用一条网线把电脑与路由器进行连接，**每个 LAN 接口都可以看作一个交换机接口**。

#### 2.4.2. 个例解释

https://www.zhihu.com/question/30584853 

将路由器的 LAN3 接口与 WAN 接口相连，LAN4 接口连接 MODEM，可以正常上网、使用 wifi。

解释：
- 一般情况下的连接方式是将 router 作为一个二层 + 三层设备，起到局域网网关的作用，光猫只起信号转换的作用，拨号在 router 上完成。
- 这种特别的接法是将 router 仅仅作为一个二层设备（即交换机）和 AP，而光猫既作局域网网关，又起信号转换的作用，拨号在 MODEM 上完成。
- 差别在于用户的无线、有线终端（手机、电脑）选择路由器做网关，还是光纤猫做网关（谁来分配 IP）；后者中用户的流量（无线 & 有线）只会从 LAN 口 4 上行到光纤猫的 LAN 口，然后做 NAT，从光纤猫 WAN 口发送出去，最终两者起到了同样的效果；因此，即便将路由器 LAN3 与 WAN 直连的那根网线拔掉，即只留下路由器 LAN4 与光猫 LAN 相连，一样可以完美上网。

### 2.5. 猫

TODO:

https://www.zhihu.com/question/40006391

https://www.zhihu.com/question/271000574

### 2.6. 比较

- 数据转发依据
  - L1设备对所有比特流进行数据转发。
  - L2设备根据 MAC 地址进行数据转发。
  - L3设备根据 IP 地址进行数据的转发。

- 数据传输方式
  - 集线器的数据传输方式是广播（broadcast）方式，用集线器组成的网络称为共享式网络。

  - 交换机的数据传输是只对目的节点发送，用交换机组成的网络称为交换式（独享式）网络。

    交换机在自己的 MAC 地址表中找不到时，会使用广播方式传输数据。由于交换机具有 MAC 地址学习功能，因此之后的数据传输就是有目的的发送。
  
  - 路由器 todo:

- 传输模式
  - 集线器**只能采用半双工方式**进行传输的，因为集线器是共享传输介质的，这样在上行通道上集线器一次只能传输一个任务，要么是接收数据，要么是发送数据。
  - 交换机**可以是半双工操作，也可以是全双工操作**。
  - 路由器

- 带宽占用方式 
  - 集线器所有端口是共享集线器的总带宽。
  - 交换机的每个端口都具有自己的带宽。
    
    因此，交换机实际上每个端口的带宽比集线器端口可用带宽要高许多，也就决定了交换机的传输速度比集线器要快许多。交换机在传输数据时是并行传输，多个端口对之间可以同时传输数据，或者一个端口内的各台计算机之间的交换数据不会影响到另外一个端口内的数据通信。

  - 路由器 todo:

- 网络划分
  - 集线器什么都不能划分，使用集线器将多台 PC 连接起来只是一种适合用于家庭网络和故障排除的廉价解决方案。
  - 交换机会划分冲突域。
  - 路由器作为一种特殊的交换机，除了划分冲突域之外还可以划分广播域。

## 3. Refer Links

todo:

[集线器和交换机的区别？](https://www.zhihu.com/question/21782368)

[路由器和交换机的不同之处有哪些？](https://www.zhihu.com/question/20465477)