- [计算机网络 - 网络层：服务质量保证](#计算机网络---网络层服务质量保证)
  - [1. 流量整形 (traffic shaping)](#1-流量整形-traffic-shaping)
    - [1.1. 漏桶算法 (leaky bucket)](#11-漏桶算法-leaky-bucket)
    - [1.2. 令牌桶算法 (token bucket)](#12-令牌桶算法-token-bucket)
  - [2. 资源预留](#2-资源预留)
  - [3. 准入控制](#3-准入控制)
  - [4. 分组 / 包调度](#4-分组--包调度)
  - [5. Refer Links](#5-refer-links)

# 计算机网络 - 网络层：服务质量保证

## 1. 流量整形 (traffic shaping)

流量整形 (traffic shaping) 是指调节进入网络的数据流的平均速率和突发性数据流所采用的技术，属于网络层操作。它的目标是在允许应用程序发送适合他们需求的各种流量和某种程度的突发事件的同时，向网络提供一个简单易用的方式来描述可能的流量模式。

流量整形技术可以减少拥塞，有助于服务提供者兑现其服务承诺。

流量整形对于 P2P 和其它消耗可用带宽的数据传输并不是很重要，但对于实时数据传输有着很重要的意义，如音频、视频连接数据流。

### 1.1. 漏桶算法 (leaky bucket)

### 1.2. 令牌桶算法 (token bucket)

<!-- http://baike.baidu.com/item/%E4%BB%A4%E7%89%8C%E6%A1%B6%E7%AE%97%E6%B3%95 百度百科说的很明白 -->

<!-- 以下加粗的都是暂时理解  可能是错的   看课本 P315 理解 -->

在网络中传输数据时，为了防止网络拥塞，需限制流出网络的流量，使流量以比较均匀的速度向外发送。令牌桶算法就实现了这个功能，可控制发送到网络上数据的数目，并允许突发数据的发送。

令牌桶算法是网络流量整形（Traffic Shaping）和速率限制（Rate Limiting）中最常使用的一种算法。典型情况下，令牌桶算法用来控制发送到网络上的数据的数目，并允许突发数据的发送。

大小固定的令牌桶可自行以恒定的速率源源不断地产生令牌。如果令牌不被消耗，或者被消耗的速度小于产生的速度，令牌就会不断地增多，直到把桶填满。后面再产生的令牌就会从桶中溢出。最后桶中可以保存的最大令牌数永远不会超过桶的大小。

传送到令牌桶的数据包需要消耗令牌。不同大小的数据包，消耗的令牌数量不一样。

令牌桶这种控制机制基于令牌桶中是否存在令牌来指示什么时候可以发送流量。**令牌桶中的每一个令牌都代表一个字节**。如果令牌桶中存在令牌，则允许发送流量；而如果令牌桶中不存在令牌，则不允许发送流量。因此，如果突发门限被合理地配置并且令牌桶中有足够的令牌，那么流量就可以以峰值速率发送。

令牌桶算法的基本过程如下：
- 假如用户配置的平均发送速率为 r，则每隔 1/r 秒一个令牌被加入到桶中。
- 假设桶最多可以存发 b 个令牌。如果令牌到达时令牌桶已经满了，那么这个令牌会被丢弃。
- **当一个 n 个字节的数据包到达时，就从令牌桶中删除 n 个令牌，并且数据包被发送到网络；因此，可以理解为数据包不占桶容量，令牌才占—令牌桶是用来放令牌的**。
- 如果令牌桶中少于 n 个令牌，那么不会删除令牌，并且认为这个数据包在流量限制之外。
- 算法允许最长 b 个字节的突发，但从长期运行结果看，数据包的速率被限制成常量 r。对于在流量限制外的数据包可以以不同的方式处理：
  - 它们可以被丢弃。
  - 它们可以排放在队列中以便当令牌桶中累积了足够多的令牌时再传输。
  - 它们可以继续发送，但需要做特殊标记，网络过载的时候将这些特殊标记的包丢弃。

**注意：令牌桶算法不能与另外一种常见算法“漏桶算法（Leaky Bucket）”相混淆。这两种算法的主要区别在于“漏桶算法”能够强行限制数据的传输速率，而“令牌桶算法”在能够限制数据的平均传输速率外，还允许某种程度的突发传输。在“令牌桶算法”中，只要令牌桶中存在令牌，那么就允许突发地传输数据直到达到用户配置的门限，因此它适合于具有突发特性的流量。**

## 2. 资源预留

## 3. 准入控制

## 4. 分组 / 包调度

## 5. Refer Links