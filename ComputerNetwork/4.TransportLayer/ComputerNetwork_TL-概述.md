- [计算机网络 - 传输层 ： 概述](#计算机网络---传输层--概述)
  - [1. 基本概念](#1-基本概念)
    - [1.1. 传输层任务](#11-传输层任务)
    - [1.2. 传输层服务](#12-传输层服务)
    - [1.3. 传输层功能](#13-传输层功能) 
    - [1.4. 与网络层关系](#14-与网络层关系)
  - [2. 传输原语](#2-传输原语)
    - [2.1. 传输服务原语](#21-传输服务原语)
    - [2.2. 套接字](#22-套接字)
      - [2.2.1. 流式套接口](#221-流式套接口)
      - [2.2.2. 数据报套接口](#222-数据报套接口)
  - [3. 传输协议要素](#3-传输协议要素)
  - [4. Refer Links](#4-refer-links)

# 计算机网络 - 传输层 ：概述

## 1. 基本概念

传输层与网络层一起构成了网络协议层次的核心，传输层架构在网络层提供的服务之上，是端到端传输服务的最底层，在应用层和网络层之间提供了无缝接口。

![image](http://otaivnlxc.bkt.clouddn.com/jpg/2018/6/11/3d264c0b1993f78a135c503f74033ffa.jpg)

![image](http://otaivnlxc.bkt.clouddn.com/jpg/2018/6/11/c8dcb6e169ce33ddb124f44d0b50ec16.jpg)

![image](http://otaivnlxc.bkt.clouddn.com/jpg/2018/6/11/23e3fe36a0865ac10a75a605bb5818d5.jpg)

### 1.1. 传输层任务

向上为应用层的进程提供可靠、高效、成本有效的数据传输服务，向下屏蔽不同的通信子网。

### 1.2. 传输层服务

- 面向连接的传输服务
- 无连接的传输服务

### 1.3. 传输层功能

- 对字节流进行数据分段和重组 
- 保证数据可靠传输，进行流量控制
- 建立端到端的操作
- 从一端主机向另一端主机发送数据段，使整个报文到达目的计算机上的正确进程

### 1.4. 与网络层关系

传输层提供的服务与网络层服务非常相似，为什么还要专门设置独立的传输层？
- **传输层的代码完全运行在用户的机器上，而网络层的代码主要运行在由运行商操作的路由器上**。
- 传输层架构在网络层之上，可提高网络层的服务质量。
- **由于传输服务原语可以通过调用库程序来实现，独立于网络服务原语，开发者可以按照一组标准的原语编写可运行于各种网络的程序**。

## 2. 传输原语

### 2.1. 传输服务原语

为允许用户访问传输服务，每个传输服务都应用层程序提供了操作的接口，这些接口称为传输服务原语。

简单的传输服务原语如：

![image](http://otaivnlxc.bkt.clouddn.com/jpg/2018/6/11/ae497563485d1f964890db36169dceed.jpg)

### 2.2. 套接字

**TCP 所用的套接字 (socket) 原语即是一组传输原语，由加州大学伯克利分校 UNIX 小组开发，目前最为流行**。这组原语定义了网络上的各种操作（如生成套接字，发送 / 接收消息等）。

常用的套接字接口：
- Linux / Unix： Berkeley Socket 是最突出的一套接口。
- Windows： Win Socket，也称 winsock，与 BS 很类似的接口。

网络层次位置：

![image](http://otaivnlxc.bkt.clouddn.com/jpg/2018/6/11/c89ff99a98cd2a481a91339652181341.jpg)

功能理解：可认为一个 IP 与一端口（port）联合在一起形成一个套接字，它是网络上的一个传输接口。在网络的另外一端可有一个对应的套接字与通信。

#### 2.2.1. 流式套接口

流式套接口是可靠的双向通讯的数据流。传送的包会按发送时的顺序到达。
```c
int s=socket(PF_INET,SOCK_STREAM,IPPROTO_TCP);
```

#### 2.2.2. 数据报套接口

使用这种方式，传送的包不一定会按发送时的顺序到达。
```c
int s=socket(PF_INET,SOCK_DGRAM,IPPROTO_UDP);
```

## 3. 传输协议要素

**传输层协议与数据链路层通信一样，都要处理错误控制、顺序性、流量控制和一些其它问题**。但在数据链路层，2 个路由器之间通过一条有线或无线物理信道直接进行通信，而在传输层中，该物理信道被整个网络所代替，从而导致了协议设计上的很大差异：
- 在点到点链路上，路由器不必指定要通话的路由器。而在传输层，必须显式指定接收方的地址。
- 在点到点链路上，建立一个连接非常简单。而在传输层，建立连接的初始操作十分复杂。
- 网络中具有延迟、数据包重复等特性，因此需要传输层协议加入特殊的控制算法，以正确地传输信息。
- 数据链路层和传输层都需要缓冲和流量控制，但由于传输层上存在大量、数量可变的连接，且连接之间的相互竞争可能造成连接的可用带宽上下波动。因此，需要一种不同于数据链路层的控制方法。

综合这些差异，传输层协议的设计应包含以下关键要素：
- 寻址
- 建立连接和断开连接
- 差错控制和流量控制
  - 帧携带检错码
  - 自动重复请求
  - 停等式协议
  - 滑动窗口协议
- 拥塞控制
- 多路复用
- 崩溃恢复

## 4. Refer Links