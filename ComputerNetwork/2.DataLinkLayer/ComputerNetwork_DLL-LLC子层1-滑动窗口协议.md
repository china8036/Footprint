- [计算机网络 - 数据链路层 - LLC 子层：基本协议](#计算机网络---数据链路层---llc-子层基本协议)
  - [1. 单工协议](#1-单工协议)
    - [1.1. 乌托邦式单工协议（无限制）](#11-乌托邦式单工协议无限制)
    - [1.2. 无错信道上的单工停 - 等式协议（流量控制）](#12-无错信道上的单工停---等式协议流量控制)
    - [1.3. 有错信道上的单工停 - 等式协议（流量控制 & 差错控制）](#13-有错信道上的单工停---等式协议流量控制--差错控制)
  - [2. 滑动窗口协议 (sliding window protocol)](#2-滑动窗口协议-sliding-window-protocol)
    - [2.1. 一位滑动窗口协议（停等协议)](#21-一位滑动窗口协议停等协议)
    - [2.2. 回退 n 协议](#22-回退-n-协议)
    - [2.3. 选择重传协议](#23-选择重传协议)
  - [3. Refer Links](#3-refer-links)

# 计算机网络 - 数据链路层 - LLC 子层：基本协议

## 1. 单工协议

单工协议指的是数据的在传输时是单向的。

### 1.1. 乌托邦式单工协议（无限制）

### 1.2. 无错信道上的单工停 - 等式协议（流量控制）

问题：

如何避免收方被涌入的数据淹没，即取消“接收方允许无限量接收” 的假设。

解决：

收方回发一个哑帧，接收方收到哑帧，表明收方允许接收数据，此时再次发送下一帧数据。

实际上是半双工协议。

### 1.3. 有错信道上的单工停 - 等式协议（流量控制 & 差错控制）

有噪声就会产生差错，就可能会引起以下这些问题：
- 接收方检测到错误帧，如何通知发送方？
- 接收方检测到错误帧，如何恢复正确帧？
- 数据帧或确认帧在途中丢失将如何解决？
- 有可能收到重复帧，如何解决？

解决以上问题的方法：
- 确认（主动确认重传)
  
  接收端进行差错检查后，发确认帧送回发送端，告诉接收是否正确。为了减少网络内的流量，**只在接收无差错时才发确认帧，出错时不发确认帧**。发送端等候计时器给定的时间后仍未收到确认帧，则知道接收出错，此时发送端重发原来的帧。

- 重发
  
  网络中采用检错码，因此无法纠正错误，只能通过重发原来帧的方式来达到恢复正确帧的目的。

- 计时器
  
  控制何时重发，防止无限期等待（死锁）。

- 帧序号
  - 防止重发时接收端收到重复的帧，序号还用于接收时排序。
  - 重发机制也包括当接收方发送的确认帧丢失而导致发送方的重发。
  - 支持重传的肯定确认协议。
  - 保证送给网络层的都是**按序无重复**的分组。

## 2. 滑动窗口协议 (sliding window protocol)

http://baike.baidu.com/item/%E6%BB%91%E5%8A%A8%E7%AA%97%E5%8F%A3/8351795 

- 滑动窗口协议提高效率的做法
  - 传输方式：全双工 (full-duplex)。

  - 确认方式：捎带确认 (piggyback)。
    - 定义：将确认暂时延迟以便可以“搭上“一个从网络层传过来的出境数据帧的“便车“，；如果无法“捎带” ，即当一个控制捎带确认的计时器超时后，单独发确认帧。
    - 作用：进一步减少确认帧。

  - 发送 / 接收方式：滑动窗口。

    停—等协议是每收到一个确认才能发送下一帧，发送端等待时间太长，网络通信效率不高。为了提高效率，可以在等待的时间发送数据帧，这样大大减少了浪费的时间；
  
    如果发送端可以连续发送一批数据帧，必须考虑接收端是否来得及接纳与处理这么多的帧，这里就提出了网络流量控制问题，即发送方和接收方接收能力的匹配，而滑动窗口协议就是用于控制网络中流量的协议；

- 滑动窗口协议本质
  - 在任何时候发送放总是维持着一组序号，分别对应于允许它发送的帧，这些帧落在发送窗口内，接收方也维持着一个接收窗口，对应一组允许它接收的帧。
  - 发送窗口和接收窗口不必有相同的上下界，甚至不必有同样的大小。

### 2.1. 一位滑动窗口协议（停等协议)

当发送窗口和接收窗口的大小固定为 1 时，滑动窗口协议实质上退化为停等协议（stop-and-wait）。该协议规定发送方每发送一帧后就要停下来，等待接收方已正确接收的确认（acknowledgement）返回后才能继续发送下一帧。由于接收方需要判断接收到的帧是新发的帧还是重新发送的帧，因此发送方要为每一个帧加一个序号。由于停等协议规定只有一帧完全发送成功后才能发送新的帧，因而只用一比特来编号就够了。

### 2.2. 回退 n 协议

由于停等协议要为每一个帧进行确认后才继续发送下一帧，大大降低了信道利用率，因此又提出了后退 n 协议。后退 n 协议中，发送方在发完一个数据帧后，不停下来等待应答帧，而是连续发送若干个数据帧，即使在连续发送过程中收到了接收方发来的应答帧，也可以继续发送。且发送方在每发送完一个数据帧时都要设置超时定时器。只要在所设置的超时时间内仍未收到确认帧，就要重发相应的数据帧。如：当发送方发送了 N 个帧后，若发现该 N 帧的前一个帧在计时器超时后仍未返回其确认信息，则该帧被判为出错或丢失，此时发送方就不得不重新发送出错帧及其后的 N 帧。

从这里不难看出，后退 n 协议一方面因连续发送数据帧而提高了效率，但另一方面，在重传时又必须把原来已正确传送过的数据帧进行重传（仅因这些数据帧之前有一个数据帧出了错），这种做法又使传送效率降低。由此可见，若传输信道的传输质量很差因而误码率较大时，连续测协议不一定优于停止等待协议。此协议中的发送窗口的大小为 k，接收窗口仍是 1。

### 2.3. 选择重传协议

在后退 n 协议中，接收方若发现错误帧就不再接收后续的帧，即使是正确到达的帧，这显然是一种浪费。另一种效率更高的策略是当接收方发现某帧出错后，其后继续送来的正确的帧虽然不能立即递交给接收方的高层，但接收方仍可收下来，存放在一个缓冲区中，同时要求发送方重新传送出错的那一帧。一旦收到重新传来的帧后，就可以原已存于缓冲区中的其余帧一并按正确的顺序递交高层。这种方法称为选择重发（SELECTICE REPEAT）。显然，选择重发减少了浪费，但要求接收方有足够大的缓冲区空间。

## 3. Refer Links
