- [计算机网络 - 数据链路层：概述](#计算机网络---数据链路层概述)
  - [1. 功能](#1-功能)
  - [2. 数据链路帧](#2-数据链路帧)
    - [2.1. 帧结构](#21-帧结构)
    - [2.2. 成帧方法](#22-成帧方法)
  - [3. 数据链路层子层](#3-数据链路层子层)
    - [3.1. LLC 子层](#31-llc-子层)
    - [3.2. MAC 子层](#32-mac-子层)
  - [4. Refer Links](#4-refer-links)

# 计算机网络 - 数据链路层：概述

数据链路层使用物理层提供的服务在通信信道上发送和接受比特。

## 1. 功能

通信信道存在的问题：
- 通信线路偶尔会出错。
- 通信线路只有有限的传输速率，并且在比特的发送时间和接受时间之间存在非零延迟。

针对通信信道存在的问题，数据链路层需要完成的功能有：
- 向网络层提供一个定义良好的服务接口。
- **差错控制**：检测和处理传输错误，保证数据传输的有效、可靠。
- **流量控制**：调节数据流，确保慢速的接收方不会被快速的发送方所淹没。

## 2. 数据链路帧

### 2.1. 帧结构

数据链路层从网络层获取数据包，然后将这些数据包封装成帧以便传输。**每个帧包含了一个帧头（存放控制信息），一个有效载荷（存放数据包），一个帧尾（存放一个校验和）。帧的管理构成了数据链路层的工作核心**。

![image](http://otaivnlxc.bkt.clouddn.com/jpg/2018/6/10/57ee682e8ce7b04c0088bf9c85dbb38a.jpg)

![image](http://otaivnlxc.bkt.clouddn.com/jpg/2018/6/10/d5024fa4b04c64d1b3f8ff5aaece49fe.jpg)

```c
typedef struct {
  frame_kind kind;
  seq_nr seq;
  seq_nr ack;
  packet info;
} frame;
```

一个帧由 4 个字段组成：
- 帧头部分包含了 3 个控制字段：
  - kind：指出了帧中是否有数据。
  - seq：用于标明序号。
  - ack：用于确认。
- 帧中的 info 字段：对于数据帧 info 字段包含了一个数据包，对于控制帧 info 字段完全没有用处。

### 2.2. 成帧方法

将原始的位流分散到离散的帧中的过程称为成帧，成帧的方法有：
- 字符计数法
- **带字节 / 字符填充的标志字节法**
- **比特填充的比特标志法**
- 物理层编码违例法

## 3. 数据链路层子层

IEEE 802 系列标准把数据链路层分成：
- 逻辑链路控制子层 (LLC)
- 介质访问控制子层 (MAC)

![image](http://otaivnlxc.bkt.clouddn.com/jpg/2018/6/10/1caed008c2cb715a3b17824695090646.jpg)

### 3.1. LLC 子层

**逻辑链路控制（logic link control，LLC）子层用于在点到点链路中实现有效、可靠的数据传输，如 WAN**。

数据链路层的 LLC 子层的主要功能包括：
- 传输可靠性保障和控制
- 数据包的分段与重组
- 数据包的顺序传输

**数据链路层的 LLC 子层为上层（网络层）提供一个统一的逻辑视图**，包括以下服务：
- 无确认的无连接服务：无确认是指接收方在收到数据帧后毋需发回一个确认，无连接服务是指在数据传输前毋需建立逻辑链路。

  应用： 
  - 以太网是一个提供此类服务的数据链路层极好实例。
  - 局域网主要采用这种方式，因为：
    - 共享信道毋需建立连接
    - 信道较为理想，数据传输的误码率很低
    - 即使出错或丢失由上层负责恢复即可
  - 实时通信：相比数据受损更重视数据即使到达。

- 有确认的无连接服务：使用前不建立连接，即不建立数据链路，但每帧传输必须得到确认，如果没有得到确认，将重传数据帧。

  应用：适用于不可靠信道，如无线系统 802.11。

- 有确认的面向连接服务：使用前先建立连接，即先建立数据链路，并且每帧的传输都被编号，且必须得到确认；保证每个帧只被接受一次，且所有帧都按正确顺序被接收。

  应用：适用于长距离不可靠链路，如卫星信道、长途电话电路。

**LLC 子层维护一张以 DSAP 为索引的函数列表，每接收到一个数据包，以 DSAP 为索引调用相应的函数，该函数把数据包挂到相应接收队列**。

### 3.2. MAC 子层

**介质访问控制（media access control，MAC）子层用于在广播信道中确定多路访问信道的下一个使用者，如 LAN，特别是无线 LAN**。

**MAC 子层位于数据链路层的底层，在 LLC 子层的下方**。

功能：
- **负责把物理层的“0”、“1”比特流组建成帧，并通过帧尾部的错误校验信息进行错误校验**。

- 信道分配 / 介质访问控制
  
  广播网络面临的问题：可能两个（或更多）站点同时请求占用信道，而**介质访问控制子层的主要任务就是要解决分配信道的问题。MAC 子层提供了对共享介质的访问方法，包括静态分配和动态分配**：
  
  - 静态分配：基本思想是将信道 N 等分，如频分多路复用 FDM、时分多路复用 TDM 等。

    存在问题：
    - 资源分配不合理，不满足用户对资源占用的不同需求。
    - 有资源浪费，效率低。
    - 延迟时间增大 N 倍。
    适用情况：
    - 适于用户数量少且用户数目固定的情况。
    - 适于通信量大且流量稳定的情况。
    - 不适用于突发性业务的情况。

  - 动态分配：通过多路访问协议（Multiple Access Protocol ）动态分配信道资源，提高信道利用率。信道是开放的且没有预分配。

- **分配单独的局域网地址（即通常所说的 MAC 地址），并将目标计算机的物理地址添加到数据帧上**。当此数据帧传递到对端的 MAC 子层后，它会检查该地址是否与自己的地址相匹配，如果帧中的地址与自己的地址不匹配，就将这一帧抛弃；如果相匹配，就将它发送到上一层中。

## 4. Refer Links
