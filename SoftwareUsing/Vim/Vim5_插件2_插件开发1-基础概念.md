- [Vim 插件开发：基础概念](#vim-插件开发基础概念)
  - [1. 项目结构](#1-项目结构)
  - [2. 插件载入顺序](#2-插件载入顺序)
  - [4. Refer Links](#4-refer-links)

# Vim 插件开发：基础概念

## 1. 项目结构

Vim 插件标准的目录结构为：
```
autoload/               自动载入脚本
colors/                 颜色主题
plugin/                 在 Vim 启动时将被载入的脚本
ftdetect/               文件类型识别脚本
syntax/                 语法高亮文件
ftplugin/               文件类型相关插件
compiler/	              编译器
indent/                 语法对齐
```

- `after/`: 
- `autoload/`: 该目录下的脚本会在特定条件下自动被载入。这里的特定条件指的是当某一个 autoload 类型的函数被调用，并且 Vim 当前环境下并未定义该函数时。如调用 `call helloworld#init()` 时，Vim 会先检测当前环境下是否定义了该函数，若没有，则在 `autoload/` 目录下找 `helloworld.vim` 这一文件，并将其载入，载入完成后再执行 `call helloworld#init()`。
- `colors/`: 该目录下主要存储一些颜色主题脚本，当执行 `:colorscheme theme_name` 命令时，对应的颜色主题脚本将被载入。
- `compiler/`: 该目录下是一些预设的编译器参数，主要给 `:make` 命令使用的。在最新版的 Vim 中可以使用 `:compiler! compiler_name` 来为当前缓冲区设定编译器。如执行 `:compiler! helloworld` 时，`compiler/helloworld.vim` 这一脚本将被载入。
- `ftdetect/`: 该目录下通常存放的是文件类型检测脚本，该目录下的文件也是在 Vim 启动时被载入的。如：`autocmd BufNewFile,BufRead *.helloworld set filetype=helloworld`。
- `ftplugin/`: 
- `indent/`: 该目录下主要是一些语法对齐相关的脚本。
- `plugin/`: 该目录下的文件将在 Vim 启动时被运行，通常，可以将插件的快捷键、命令的定义保留在这个文件夹里。
- `syntax/`: 该目录下的文件通常用于定义语法高亮，一般文件名前缀和对应的语言类型相同，比如 Java 的语法文件文件名为 `java.vim`。

## 2. 插件载入顺序

[GitHub: exvim/test-loading](https://github.com/exvim/test-loading)

- When Vim started
  1. .vimrc
  1. ftdetect/*.vim
  1. after/ftdetect/*.vim
  1. plugin/*.vim
  1. after/plugin/*.vim

- When set filetype=foobar
  1. ftplugin/foobar.vim
  1. after/ftplugin/foobar.vim
  1. indent/foobar.vim
  1. after/indent/foobar.vim
  1. syntax/foobar.vim
  1. after/syntax/foobar.vim

- When call foo#bar#hello_world()
  1. autoload/foo/bar.vim

  NOTE: autoload never check after/ folders

- When :compiler foobar
  1. compiler/foobar.vim
  1. after/compiler/foobar.vim

- When :colorscheme foobar
  1. colors/foobar.vim

## 4. Refer Links

[如何用 vim 的插件开发？有什么实际中的技巧？](https://www.zhihu.com/question/25819155)

[Vim 插件开发指南](https://github.com/wsdjeg/vim-plugin-dev-guide)
