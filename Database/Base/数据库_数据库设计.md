- [数据库：数据库设计](#)
  - [1. 概述](#1)
    - [1.1. 数据库设计特点](#11)
    - [1.2. 数据库设计方法](#12)
    - [1.3. 数据库设计步骤](#13)
  - [2. 需求分析](#2)
    - [2.1. 分析方法](#21)
    - [2.2. 数据字典](#22)
      - [2.2.1. 数据项](#221)
      - [2.2.2. 数据结构](#222)
      - [2.2.3. 数据流](#223)
      - [2.2.4. 数据存储](#224)
      - [2.2.5. 处理过程](#225)
  - [3. 概念结构设计](#3)
    - [3.1. 概念模型](#31)
    - [3.2. E-R 模型](#32-e-r)
    - [3.3. UML](#33-uml)
  - [4. 逻辑结构设计](#4)
  - [5. 物理结构设计](#5)
    - [5.1. 关系模式存取方法选择](#51)
    - [5.2. 数据库存储结构确定](#52)
    - [5.3. 评价物理结构](#53)
  - [6. 数据库的实施和维护](#6)
    - [6.1. 数据的载入和应用程序的调试](#61)
    - [6.2. 数据库的试运行](#62)
    - [6.3. 数据库的运行和维护](#63)

# 数据库：数据库设计

## 1. 概述

数据库设计，从广义上讲，是数据库及其应用系统的设计，即设计整个数据库应用系统；从狭义上讲，是设计数据库本身，即设计数据库的各级模式并建立数据库，这是数据库应用系统设计的一部分。

数据库设计是指定对于一个给定的应用环境，构造（设计）优化的数据库逻辑模式和物理结构，并据此建立数据库及其应用系统，使之能够有效地存储和管理数据，满足各种用户的应用需求，包括信息管理要求和数据操作要求。

数据库设计的目标是为用户和各种应用系统提供一个信息基础设施和高效的运行环境。高效的运行环境指数据库数据的存取效率、数据库存储空间的利用率、数据库系统运行管理的效率等都是高的。

### 1.1. 数据库设计特点

- 数据库建设的基本规律

  “三分技术，七分管理，十二分基础数据”是数据库设计的特点之一。

- 结构（数据）设计和行为（处理）设计相结合

  数据库设计应该和应用系统设计相结合。也就是说，整个设计过程中要把数据库结构设计和对数据的处理设计密切结合起来。这是数据库设计的特点之二。

  传统软件工程忽视对应用中数据语义的分析和抽象，这种方法对于数据库应用系统的设计显然是不妥的。

### 1.2. 数据库设计方法

早期数据库设计主要采用手工与经验相结合的方法，设计质量往往与设计人员的经验和水平有直接的关系。数据库设计是一种技艺，缺乏科学理论和工程方法的支持，设计质量难以保证。常常是数据库运行一段时间后又不同程度地发现各种问题，需要进行修改甚至重新设计，增加了系统维护的代价。

为此，人们经过探索，提出了各种数据库设计的方法：
- 新奥尔良方法
- 基于 E-R 模型的设计方法
- 3NF 的设计方法
- 面向对象的数据库设计方法
- 统一建模语言（UML）方法

### 1.3. 数据库设计步骤

按照结构化系统设计的方法，考虑数据库及其应用系统开发的全过程，将数据库设计分为以下阶段：
- 需求设计

  进行数据库设计首先必须准确了解与分析用户需求（包括数据与处理）。需求分析是整个设计过程的基础，是最困难和最耗费时间的一步。作为“地基”的需求分析是是否做得充分与准确，决定了在其上构建数据库“大厦”的速度和质量。需求分析做的不好，可能回导致整个数据库设计返工重做。

- 概念结构设计

  概念结构设计是整个数据库设计的关键，它通过对用户需求进行综合、归纳与抽象，形成一个独立于具体数据库管理系统的概念模型。

- 逻辑结构设计

  逻辑结构设计是将概念结构转换为某个数据库管理系统所支持的数据模型，并对其进行优化。

- 物理结构设计

  物理结构设计是为逻辑数据模型选取一个最适合应用环境的物理结构（包括存储结构和存取方法）。

- 数据库实施

  在数据库实施阶段，设计人员运用数据库管理系统提供的数据库语言及其宿主语言根据逻辑设计和物理设计的结果建立数据库，编写与调试应用程序，组织数据入库，并进行试运行。

- 数据库运行和维护

  数据库应用系统经过试运行后即可投入正式运行。在数据库系统运行过程中必须不断地对其进行评估、调整与修改。

需要指出的是，设计一个完善的数据库应用系统不可能是一蹴而就的，它往往是上述 6 个阶段的不断反复。这些设计步骤既是数据库设计的过程，也包括了数据库应用系统的设计过程。

## 2. 需求分析

需求分析简单的说就是分析用户的要求。需求分析的任务是通过详细调查现实世界要处理的对象（组织、部门、企业等），充分了解原系统（手工系统或计算机系统）的工作概况，明确用户的各种需求，然后在此基础上确定新系统的功能。新系统必须充分考虑今后可能的扩充和改变，不能仅仅按当前应用需求来设计数据库。

需求调查的重点是“数据”和“处理”，获取用户对数据库的如下要求：
- 信息要求。即用户需要从数据库中活的信息的内容与性质。
- 处理要求。即用户要完成的数据处理功能，对处理性能的要求。
- 安全性与完整性要求。

充分确定用户需求是一件很困难的事，一方面因为用户缺少计算机知识，另一方面设计人员缺少用户的专业知识。因此设计人员必须不断与用户进行深入交流，才能逐步确定用户的实际需求。

### 2.1. 分析方法

常用的需求调查方法有：
- 跟班作业
- 开调查会
- 请专人介绍
- 询问
- 设计调查表请用户填写
- 查阅记录

### 2.2. 数据字典

数据字典是进行详细的数据收集和数据分析所获得的主要成果。它是关于数据库中数据的描述，即元数据，而不是数据本身。数据字典是在需求分析阶段建立，在数据库设计过程中不断修改、充实和完善的。

数据字典通过包括以下几部分：
#### 2.2.1. 数据项

数据项是不可再分的数据单位。数据项的描述通常包含以下内容：

数据项描述 = { 数据项名，数据项含义说明，别名，数据类型，长度，取值范围，取值含义，与其它数据项的逻辑关系，数据项之间的联系 }

#### 2.2.2. 数据结构

数据结构反映了数据之间的组合关系。一个数据结构可以由若干个数据项组成，也可以由若干个数据结构组成，或由若干个数据项和数据结构混合组成。

数据结构描述 = { 数据结构名，含义说明，组成：{ 数据项或数据结构 } }

#### 2.2.3. 数据流

数据流是数据结构在系统内传输的路径。

数据流描述 = { 数据流名，说明，数据流来源，数据流去向，组成：{ 数据结构 }，平均流量，高峰期流量 }

#### 2.2.4. 数据存储

数据存储是数据结构停留或保存的地方，也是数据流的来源和去向之一。它可以是手工文档或手工凭单，也可以是计算机文档。

数据存储描述 = { 数据存储名，说明，编号，输入的数据流，输出的数据流，组成：{ 数据结构 }，数据量，存取频度，存取方式 }

#### 2.2.5. 处理过程

处理过程的具体处理逻辑一般用判定表或判定树来描述。数据字典中只需要描述处理过程的说明性信息即可。

处理过程描述 = { 处理过程名，说明，输入：{数据流}，输出：{数据流}，处理：{ 简要说明 } }

## 3. 概念结构设计

将需求分析得到的用户需求抽象为信息结构（即概念模型）的过程就是概念结构设计。它是整个数据设计的关键。

### 3.1. 概念模型

概念模型的主要特点：
- 能真实、充分地反映显示世界，包括事物和事物之间的联系，能满足用户的处理要求，是显现实世界的一个真实模型。
- 易于理解，可以用它和不熟悉计算机的用户交互意见，用户的积极参与是数据库设计成功的关键。
- 易于修改：当应用环境和应用要求都要求改变时容易对进行概念模型
- 易于删除：易于向关系、网状、层次等各种数据库模型转换

### 3.2. E-R 模型

概念模型是各种数据模型是共同基础，它比数据模型更加独立于及其、更抽象，从而更加稳定。描述概念模型的有力工具是 E-R 模型。

E-R 图提供了表示实体型、属性和联系的方法：
- 用矩形表示实体型，矩形框内写明实体名
- 用椭圆形表示属性，并用无向边将其与相应的实体型连接起来
- 用菱形表示联系，菱形框内写明联系名，并用无向边分别与有关实体型连接起来，同时在无向边旁标注联系的类型（1:1、1:n 或 m:n）。需要注意的是，如果一个联系具有属性，则这些属性也要用无向边与该联系连接起来。

### 3.3. UML

表示 E-R 图的方法有若干种，使用统一建模语言 UML 是其中之一。

## 4. 逻辑结构设计

概念结构是独立于任何一种数据模型的信息结构，逻辑结构设计的任务就是把概念结构设计阶段设计好的基本 E-R 图转化为与选用数据库管理系统产品所支持的数据模型相符合的逻辑结构。

E-R 图向关系模型的转换，即如何将实体型和实体间的联系转化为关系模型，如何确定这些关系模式的属性和码。

转换的一般原则：一个实体型转换为一个关系模式，关系的属性就是实体的属性，关系的码就是实体的码。

对于实体间的联系有以下不同情况：
- 一个 1:1 联系可以转换为一个独立的关系模式，也可以与任意一端对应的关系模式合并。
- 一个 1:n 联系可以转换为一个独立的关系模式，也可以与 n 端对应的关系模式合并。
- 一个 m:n 联系转换为一个关系模式。
- 三个或三个以上实体间的一个多元联系可以转换为一个关系模式。
- 具有相同码的关系模式可合并。

## 5. 物理结构设计

数据库在物理设备上的存储结构与存取方法称为数据库的物理结构，它依赖于选定的数据库管理系统。为一个给定的逻辑数据模型选取一个最适合应用要求的物理结构的过程，就是数据库的物理设计。

数据库的物理设计通常分为两步：
- 确定数据库的物理结构，在关系数据库中主要指存取方法和存储结构
- 对物理结构进行评价，评价的重点是时间和空间效率

如果评价结果满足原设计要求，则可进入到物理实施阶段，否则，就需要重新设计或更改物理结构，有时甚至要返回逻辑设计阶段修改数据模型。

通常关系数据库物理设计的内容主要包括为关系模式选择存取方法，以及设计关系、索引等数据库文件的物理存储结构。

### 5.1. 关系模式存取方法选择

存取方法是快速存取数据库中数据的技术。数据库管理系统一般提供多种存取方法。常用的存取方法为索引方法和聚簇方法。

- B+ 树索引存取方法选择

  索引存取方法的选择，实际上就是根据应用要求确定对关系的哪些属性列建立索引、哪些属性列建立组合索引、哪些索引要设计为唯一索引等。

  一般满足以下情况之一可考虑在属性上建立索引：
  - 一个属性经常在查询条件中出现
  - 一个属性经常作为最大值和最小值等聚集函数的参数
  - 一个属性经常在连接操作的连接条件中出现

- Hash 索引存取方法选择

  如果一个关系的属性主要出现在等值连接条件中或主要出现在等值比较选择条件中，而且满足以下条件之一，则此关系可选择 hash 存取方法：
  - 一个关系的大小可预知，且不变
  - 关系的大小动态改变，但数据库管理系统提供了动态 hash 存取方法

- 聚簇存取方法选择

  为提供某个属性的查询速度，把这个或这些属性上具有相同值的元组集中存放在连续的物理块中称为聚簇。该属性称为聚簇码。

  聚簇功能可以大大提高按聚簇码进行查询的效率，通过将数据集中存放，每读一个物理块可以得到多个满足查询条件的元组，从而显著减少了访问磁盘的次数。

  一个数据库可以建立多个聚簇，一个关系只能加入一个聚簇。选择聚簇存取方法，即确定需要建立多少个聚簇，每个聚簇中包括哪些关系。

  一般满足以下条件之一可以考虑建立聚簇：
  - 经常在一起进行连接操作的关系
  - 单个关系的一组属性经常出现在相等比较条件中
  - 单个关系的一组属性上的额值重复率很高

  需要注意的是，聚簇只能提高某些应用的性能，而且建立与维护聚簇的开销是相当大的。对已有关系建立聚簇将导致关系中元组移动其物理存储位置，并使得该关系上原来建立的所有索引无效，必须重建。

### 5.2. 数据库存储结构确定

确定数据的存放位置和存储结构需要综合考虑存取时间、存储空间利用率和维护代价三方面的因素。

- 确定数据存放位置

  为提高系统性能，应该根据应用情况将数据的易变部分和稳定部分、经常存取部分和存取频率较低部分分开存放。

- 确定系统配置

  初始情况下，DBMS 都为系统配置变量提供了默认值，但这些值不一定适合每一种应用环境，需要设计人员在物理设计时重新对这些变量赋值，以改善系统的性能。

### 5.3. 评价物理结构

数据库物理设计过程种需要对时间效率、空间效率、维护代价和各种用户需求进行权衡，其结果可以产生多种方案。数据库设计人员必须对这些方案进行细致的评价，从中选择一个较优的方法作为数据库的物理结构。

## 6. 数据库的实施和维护

完成数据库的物理设计之后，设计人员需要用关系数据库管理系统提供的数据定义语言和其它实用程序将数据库逻辑设计和物理设计结果严格描述出来，成为关系数据库管理系统可以接收的源代码，再经过调试产生目标模式，然后就可以组织数据入库了，这就是数据库实施阶段。

### 6.1. 数据的载入和应用程序的调试

数据库实施阶段包括两项重要工作：
- 数据的载入
- 应用程序的编码和调试

### 6.2. 数据库的试运行

在原有系统的数据有一小部分已输入数据库后，就可以开始对数据库系统进行联合调试了，这称为数据库的试运行。

数据库的试运行阶段需要强调两点：
- 数据入库是十分费时费力的过程，因此推荐先输入小批量数据做调试用，待试运行基本合格后，再大批量输入数据，逐步增加数据量，逐步完成运行评价。
- 数据库试运行阶段，由于系统尚未稳定，因此需要做好数据库的转储和恢复工作。一旦故障发生，能使数据库尽快恢复，尽量减少对数据库的破坏。

### 6.3. 数据库的运行和维护

数据库试运行合格后，数据库的开发工作就基本完成，可以投入正式运行使用了。但由于应用环境再不断变化，数据库运行过程种物理存储也会不断变化，对数据库设计进行评价、调整、修改等维护工作是一个长期的任务，也是设计工作的继续和提高。

在数据库运行阶段，对数据库经常性的维护工作主要包括以下几个方面：
- 数据库的转储和恢复
- 数据库的安全性、完整性控制
- 数据库性能的监督、分析和改造
- 数据库的重组织与重构造