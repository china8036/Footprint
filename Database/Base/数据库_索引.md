- [数据库：索引](#)
  - [1. 基础概念](#1)
  - [2. 基本原理](#2)
  - [3. 索引类型](#3)
    - [3.1. B-Tree Index](#31-b-tree-index)
    - [3.2. Hash Index](#32-hash-index)
    - [3.3. R-Tree Index](#33-r-tree-index)
    - [3.4. Full-text Index](#34-full-text-index)
    - [3.5. 支持情况](#35)
  - [4. 优缺点](#4)
  - [5. Refer Links](#5-refer-links)

# 数据库：索引

## 1. 基础概念

> 索引，在 MySQL 中称为键 (key)，是存储引擎用于快速查询的一种数据结构。

## 2. 基本原理

索引在数据库中的工作角色，就类似于一本书“中目录“的角色，如果想在整本书中找到某一个特定的主题，可以对整本书进行遍历，一页一页的查找，但如果先在目录中查找，找到该主题对应的页码，便可以直接快速的找到该主题的位置。

在没有索引的情况下，查询操作必须从第一条记录开始然后读完整个表直到找出所有匹配的相关行，表越大，花费的时间越多。

在查找条件有索引的情况下，执行查询操作时先在索引中找到匹配的对应值，然后根据匹配的索引记录找到实际表中所对应的记录行。

## 3. 索引类型

索引是在存储引擎层中实现的，而不是在服务层实现的。因此，对于不同存储引擎，索引没有同一的标准：不同的存储引擎的索引的工作方式不一样，所支持的索引类型也不一样；即便多个存储引擎都支持同一种类型的索引，其底层的实现原理也可能互不相同。

### 3.1. B-Tree Index

- B 树索引是最常见的索引类型，也是大部分引擎都支持的索引。
- B 树索引采用 B-Tree 数据结构来存储数据，而实际上很多存储引擎使用的是 B+ Tree。
- B 树索引之所以称为“B-Tree“，是因为 MySQL 在 CREATE TABE 和其它语句中使用该关键字，但实际上其底层的存储引擎可能采用的是不一样的数据结构：如 InnoDB 的默认索引类型是 BTREE，但其底层是用 B+ Tree 实现的。
- 存储引擎以不同方式使用 BTREE 索引，性能也各有不同：如 InnoDB 按照原数据格式进行存储，myisam 使用前缀压缩进行存储；InnoDB 根据主键引用被索引的行，而 myisam 通过数据的物理地址引用被索引的行。

BTREE 索引基本工作原理：

![image](http://otaivnlxc.bkt.clouddn.com/jpg/2018/4/30/9d670346bd949f1ff12ad13d736ca7f0.jpg)

### 3.2. Hash Index

只有 Memory 引擎支持，使用场景简单。

### 3.3. R-Tree Index

空间索引是 MyISAM 的一种特殊索引类型，主要用于地理空间数据类型。

### 3.4. Full-text Index

全文索引也是 MyISAM 的一种特殊索引类型，主要用于文本中的全文查找，InnoDB 从 MYSQL5.6 版本提供对全文索引的支持。

### 3.5. 支持情况

![image](http://otaivnlxc.bkt.clouddn.com/jpg/2018/4/30/776d1c7ecb89fcbe16df0cdb37cb79b0.jpg)

## 4. 优缺点

- 优点
  - 索引可以减少服务器需要扫描的数据量，从而大大提高查询效率。
  - 唯一索引能保证表中数据的唯一性。
  - 利用索引对数据存储的特性，可以使查询语句避免排序和创建临时表。
  - 索引可以将随机 I/O 变为顺序 I/O。

- 缺点
  - 虽然索引大大提高了查询速度，同时却会降低更新表的速度，如对表进行 INSERT、UPDATE 和 DELETE。因为更新表时，MySQL 不仅要保存数据，还要保存一下索引文件。
  - 建立索引会占用磁盘空间的索引文件。一般情况这个问题不太严重，但如果你在一个大表上创建了多种组合索引，索引文件的会膨胀很快。

不建议使用索引的情况：
- 数据量很小的表
- 空间紧张

## 5. Refer Links

[查询容易，优化不易，且写且珍惜](https://tech.meituan.com/mysql-index.html)

[索引原理讲解](https://www.cnblogs.com/hustcat/archive/2009/10/28/1591648.html)
