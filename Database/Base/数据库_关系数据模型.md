- [数据库：关系数据模型](#%E6%95%B0%E6%8D%AE%E5%BA%93%EF%BC%9A%E5%85%B3%E7%B3%BB%E6%95%B0%E6%8D%AE%E6%A8%A1%E5%9E%8B)
  - [1. 概述](#1-%E6%A6%82%E8%BF%B0)
  - [2. 关系数据结构](#2-%E5%85%B3%E7%B3%BB%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84)
    - [2.1. 形式化定义](#21-%E5%BD%A2%E5%BC%8F%E5%8C%96%E5%AE%9A%E4%B9%89)
      - [2.1.1. 域](#211-%E5%9F%9F)
      - [2.1.2. 笛卡尔积 & 元组 & 分量](#212-%E7%AC%9B%E5%8D%A1%E5%B0%94%E7%A7%AF-%E5%85%83%E7%BB%84-%E5%88%86%E9%87%8F)
      - [2.1.3. 关系](#213-%E5%85%B3%E7%B3%BB)
      - [2.1.4. 码](#214-%E7%A0%81)
      - [2.1.5. 关系模式](#215-%E5%85%B3%E7%B3%BB%E6%A8%A1%E5%BC%8F)
    - [2.2. 物理存储结构](#22-%E7%89%A9%E7%90%86%E5%AD%98%E5%82%A8%E7%BB%93%E6%9E%84)
  - [3. 关系操作](#3-%E5%85%B3%E7%B3%BB%E6%93%8D%E4%BD%9C)
    - [3.1. 基本关系操作](#31-%E5%9F%BA%E6%9C%AC%E5%85%B3%E7%B3%BB%E6%93%8D%E4%BD%9C)
      - [3.1.1. 数据查询](#311-%E6%95%B0%E6%8D%AE%E6%9F%A5%E8%AF%A2)
      - [3.1.2. 数据操作](#312-%E6%95%B0%E6%8D%AE%E6%93%8D%E4%BD%9C)
    - [3.2. 关系数据语言](#32-%E5%85%B3%E7%B3%BB%E6%95%B0%E6%8D%AE%E8%AF%AD%E8%A8%80)
  - [4. 关系完整性约束](#4-%E5%85%B3%E7%B3%BB%E5%AE%8C%E6%95%B4%E6%80%A7%E7%BA%A6%E6%9D%9F)
    - [4.1. 实体完整性](#41-%E5%AE%9E%E4%BD%93%E5%AE%8C%E6%95%B4%E6%80%A7)
    - [4.2. 参照完整性](#42-%E5%8F%82%E7%85%A7%E5%AE%8C%E6%95%B4%E6%80%A7)
    - [4.3. 用户定义的完整性](#43-%E7%94%A8%E6%88%B7%E5%AE%9A%E4%B9%89%E7%9A%84%E5%AE%8C%E6%95%B4%E6%80%A7)

# 数据库：关系数据模型

关系数据库（Relational database），是建立在关系模型基础上的数据库，借助于集合代数等数学概念和方法来处理数据库中的数据。现实世界中的各种实体以及实体之间的各种联系均用关系模型来表示。

## 1. 概述

关系模型由 E.F.Codd 于 1970 年首先提出的，并配合“科德十二定律”。

优点：
- 建立在严格的数据概念的基础上。
- 概念单一。实体、实体间联系、对数据的检索和更新的结果都是关系，使得数据结构简单、清晰，用户易懂易用。
- 存取路径对用户透明，从而具有更高的数据独立性、更好的安全保密性，也简化了程序员的工作和数据库开发建立的工作。

缺点：
- 由于存取路径对用户隐藏，查询效率往往不如格式化模型。
- 为提高性能，数据库管理系统必须对用户的查询请求进行优化，增加了开发数据库管理系统的难度。

按照数据模型的三个要素，关系模型由关系数据结构、关系操作集合、关系完整性约束三部分组成。

## 2. 关系数据结构

关系模型不同于格式化数据模型，它建立在严格的数学概念（集合代数）的基础上，但关系模型的数据结构非常简单，只包含单一的数据结构：关系。从用户观点上看，关系模型由一组关系组成。每个关系的数据结构是一张规范化的扁平的二维表。

关系模型要求关系必须是规范化的，规范化关系称为范式。规范条件最基本的一条是关系的每一个分量必须是一个不可分的数据项。

### 2.1. 形式化定义

#### 2.1.1. 域

域：一组具有相同数据类型的值的集合，属性的取值范围来自某个域。

#### 2.1.2. 笛卡尔积 & 元组 & 分量

- 集合代数定义：

  给定一组域 D1, D2, D3, ..., Dn，允许其中某些域是相同的，D1, D2, D3, ..., Dn 的笛卡尔积为：
  ```
  D1 x D2 x ... x Dn = {(d1, d2, ..., dn) | di ∈ Di, i=1, 2, ..., n}
  ```
  其中，每一个元素`(d1, d2, ..., dn)`称为一个元组，每一个值 di 称为一个分量。

- 数据库定义：

  在关系数据库中，一个表中的一行为一个元组，表中的一列为一个属性。

一般情况下，D1, D2, D3, ..., Dn 的笛卡尔积是没有实际语义的，只有他的某个真子集才有实际含义。

#### 2.1.3. 关系

- 集合代数定义：

  `D1 x D2 x ... x Dn`的子集称为在域 D1, D2, D3, ..., Dn 上的关系，表示为`R(D1, D2, D3, ..., Dn)`，其中 R 为关系名，n 为关系的目或度。

- 数据库定义：

  在关系数据库中，一个关系对应通常说的一张表。

关系有三种类型：
- 基本关系 / 基本表 / 基表

  基本表是实际存在的表，是实际存储数据的逻辑表示。

- 查询表

  查询表是查询结果对应的表。

- 视图表

  视图表是由基本表或其它视图表导出的表，是虚表，不对应实际存储的数据。

#### 2.1.4. 码

码 / 码键：表中的某个属性组，它可以唯一确定一个元组。

- 候选码：若关系中的某一属性组的值能唯一地标识一个元素，而其子集不能，称该属性组为候选码。
- 主属性：候选码的各个属性称为主属性。
- 非主属性 / 非码属性：不包含在任何候选码中的属性称为非主属性 / 非码属性。
- 主码：若一个关系有多个候选码，则选定其中一个作为主码。
- 超码 / 超键：
- 全码：在最简单的情况下，候选码只包含一个属性。在最极端的情况下，关系模式的所有属性都是这个关系模式的候选码，称为全码。

#### 2.1.5. 关系模式

关系的描述称为关系模式，一般表示为 `关系名（属性 1，属性 2 ... 属性 n）`。

关系是关系模式在某一时刻的状态或内容。关系模式是静态稳定的，而关系是动态随时间不断变化的（因为关系操作在不断地更新数据库中的数据）。

### 2.2. 物理存储结构

关系数据库的物理组织结构根据各个数据库管理系统的具体实现而定。有的关系数据库管理系统中一个表对应一个操作系统文件，将物理数据组织交给操作系统完成；有的关系数据库管理系统从操作系统处申请若干大的文件，自己划分空间，组织表、索引等存储结构，并进行存储管理。

## 3. 关系操作

关系模型给出了关系操作的能力的说明，但不对关系数据库管理系统语言给出具体的语法要求，也就是说不同的关系数据库管理系统可以定义和开发不同的语言来实现这些操作。

关系操作的特点是集合操作方式，即操作的对象和结果都是集合。

### 3.1. 基本关系操作

关系模块中常用的操作包括数据查询和数据操作两个部分。

#### 3.1.1. 数据查询

- 基本查询操作
  - 选择
  - 投影
  - 并
  - 差
  - 笛卡尔积

- 其它查询操作

  其它查询操作可以用基本操作来定义和导出，就如乘法可以用加法定义和导出一样。
  - 连接
  - 交
  - 除

#### 3.1.2. 数据操作

- 插入
- 删除
- 修改
- 查询

### 3.2. 关系数据语言

- 关系代数语言（如 ISBL）

  用代数方式表示关系操作，用对关系的运算来表达查询要求。

- 关系演算语言
  
  用逻辑方式来表示关系操作，用谓词来表达查询要求。根据谓词变元的基本对象可分为：
  - 元组关系演算语言（如 ALPHA、QUEL）
  - 域关系演算语言（如 QBE）

- 结构化查询语言（SQL）

  SQL 是一种具有关系代数和关系演算双重特点的高度非过程化的结构化查询语言，不仅有丰富的查询功能，而且有数据定义和数据控制功能，是集查询、数据定义语言、数据操纵语言和数据控制语言于一体的关系数据语言，是关系数据库的标准语言。

## 4. 关系完整性约束

关系模型的数据操纵必须满足关系的完整性约束条件。

关系模型中有三类完整性约束：实体完整性、参照完整性和用户定义的完整性。

实体完整性和参照完整性是关系模型必须满足的完整性约束条件，称为关系的两个不变性，任何关系数据库系统都应该自动支持。用户定义的完整性是应用领域需要遵循的约束条件，体现了具体领域中的语义约束。

### 4.1. 实体完整性

若属性 A 是基本关系 R 的主属性，则 A 不能取空值（“不知道”、“不存在”、“无意义”的值）。

实体完整性约束保证了关系数据库中每个元组都是可区分的、唯一的。

### 4.2. 参照完整性

若属性 F 是基本关系 R 的外码，它与基本关系 S 的主码 Ks 相对应，则对于 R 中的每个元组在 F 上的值只能取以下两种类型：
- 取空值（F 的每个属性值均为空值）
- 非空值，等于 S 中某个元组的主码值

### 4.3. 用户定义的完整性

不同的关系数据库系统根据其应用环境的不同，往往还需要一些特殊的约束条件。用户定义的完整性就是针对某一具体关系数据库的约束条件，它反映某一具体应用所涉及的数据必须满足的语义要求。

关系模型应提供定义和检验这类完整性的机制，以便采用统一的系统的方法处理，而不需由应用程序承担这一功能。