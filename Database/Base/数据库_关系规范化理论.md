- [数据库：关系规范化理论](#%E6%95%B0%E6%8D%AE%E5%BA%93%EF%BC%9A%E5%85%B3%E7%B3%BB%E8%A7%84%E8%8C%83%E5%8C%96%E7%90%86%E8%AE%BA)
  - [1. 关系模式存在的问题](#1-%E5%85%B3%E7%B3%BB%E6%A8%A1%E5%BC%8F%E5%AD%98%E5%9C%A8%E7%9A%84%E9%97%AE%E9%A2%98)
    - [1.1. 操作异常](#11-%E6%93%8D%E4%BD%9C%E5%BC%82%E5%B8%B8)
      - [1.1.1. 插入异常](#111-%E6%8F%92%E5%85%A5%E5%BC%82%E5%B8%B8)
      - [1.1.2. 更新异常](#112-%E6%9B%B4%E6%96%B0%E5%BC%82%E5%B8%B8)
      - [1.1.3. 删除异常](#113-%E5%88%A0%E9%99%A4%E5%BC%82%E5%B8%B8)
    - [1.2. 数据冗余](#12-%E6%95%B0%E6%8D%AE%E5%86%97%E4%BD%99)
  - [2. 数据依赖](#2-%E6%95%B0%E6%8D%AE%E4%BE%9D%E8%B5%96)
    - [2.1. 函数依赖](#21-%E5%87%BD%E6%95%B0%E4%BE%9D%E8%B5%96)
      - [2.1.1. 完全函数依赖](#211-%E5%AE%8C%E5%85%A8%E5%87%BD%E6%95%B0%E4%BE%9D%E8%B5%96)
      - [2.1.2. 部分函数依赖](#212-%E9%83%A8%E5%88%86%E5%87%BD%E6%95%B0%E4%BE%9D%E8%B5%96)
      - [2.1.3. 传递函数依赖](#213-%E4%BC%A0%E9%80%92%E5%87%BD%E6%95%B0%E4%BE%9D%E8%B5%96)
    - [2.2. 多值依赖](#22-%E5%A4%9A%E5%80%BC%E4%BE%9D%E8%B5%96)
  - [3. 范式](#3-%E8%8C%83%E5%BC%8F)
    - [3.1. 第一范式](#31-%E7%AC%AC%E4%B8%80%E8%8C%83%E5%BC%8F)
    - [3.2. 第二范式](#32-%E7%AC%AC%E4%BA%8C%E8%8C%83%E5%BC%8F)
    - [3.3. 第三范式](#33-%E7%AC%AC%E4%B8%89%E8%8C%83%E5%BC%8F)
    - [3.4. BC 范式](#34-bc-%E8%8C%83%E5%BC%8F)
    - [3.5. 第四范式](#35-%E7%AC%AC%E5%9B%9B%E8%8C%83%E5%BC%8F)
    - [3.6. 第五范式](#36-%E7%AC%AC%E4%BA%94%E8%8C%83%E5%BC%8F)
    - [3.7. DK 范式](#37-dk-%E8%8C%83%E5%BC%8F)
    - [3.8. 第六范式](#38-%E7%AC%AC%E5%85%AD%E8%8C%83%E5%BC%8F)
  - [4. 规范化](#4-%E8%A7%84%E8%8C%83%E5%8C%96)
    - [4.1. 规范化](#41-%E8%A7%84%E8%8C%83%E5%8C%96)
    - [4.2. 模式分解](#42-%E6%A8%A1%E5%BC%8F%E5%88%86%E8%A7%A3)
  - [5. Refer Links](#5-refer-links)

# 数据库：关系规范化理论

由于关系模型具有严格的数学理论基础，并且可以向其它数据模型转换，因此，人们就以关系模型为背景来讨论这个问题，形成了数据库逻辑设计的一个有力工具————关系数据库的规范化理论。规范化理论虽然以关系模型为背景，但是它对于一般的数据库逻辑设计同样具有理论上的意义。

## 1. 关系模式存在的问题

在关系数据库中，对关系模式的基本要求是满足第一范式，这样的关系模式就是合法的、允许的。但是，人们发现有些关系模式存在插入、删除异常，以及修改复杂、数据冗余等问题。

一个好的模式应当不会发生插入异常、删除异常和更新异常，数据冗余应尽可能少。

### 1.1. 操作异常

#### 1.1.1. 插入异常

如果某实体随者另一个实体的存在而存在，即缺少某个实体时就无法表示这个实体，那么这个表就存在插入异常。

#### 1.1.2. 更新异常

如果更改表所对应的某个实体实例的单独属性时，需要将多行更新，那么这个表就存在更新异常。

#### 1.1.3. 删除异常

如果删除表的某一行来反映某实体实例失效时导致另一个不同实体实例信息丢失，那么这个表就存在删除异常。

### 1.2. 数据冗余

数据冗余是指相同的数据在多个地方存在，或者说表中的某个列可以由其它列计算得到，那么这个表就存在数据冗余。

## 2. 数据依赖

数据依赖是一个关系内部属性与属性之间的一种约束关系，这种约束关系是通过属性间值得相等与否体现出来的数据间相互联系。它是现实世界属性间相互联系的抽象，是数据内在的性质，是语义的体现。

数据依赖有许多种类型，其中最重要的是函数依赖和多值依赖。

### 2.1. 函数依赖

若在一张表中，在属性（或属性组）X 的值确定的情况下，必定能确定属性 Y 的值，那么就可以说 Y 函数依赖于 X，写作 X → Y。类似于函数关系 y = f(x)，在 x 的值确定的情况下，y 的值一定是确定的。也就是说，在数据表中，不存在任意两条记录，它们在 X 属性（或属性组）上的值相同，而在 Y 属性上的值不同。 	

#### 2.1.1. 完全函数依赖

在一张表中，若 X → Y，且对于 X 的任何一个真子集（假如属性组 X 包含超过一个属性的话），X ' → Y 不成立，那么我们称 Y 对于 X 完全函数依赖，记作 ![image](http://otaivnlxc.bkt.clouddn.com/jpg/2018/2/12/49811876b4fca8d980e2cc4d60fb1edf.jpg)。

#### 2.1.2. 部分函数依赖

假如 Y 函数依赖于 X，但同时 Y 并不完全函数依赖于 X，那么我们就称 Y 部分函数依赖于 X，记作 ![image](http://otaivnlxc.bkt.clouddn.com/jpg/2018/2/12/ae75f0bb44ff43717252f1d747737687.jpg)。

#### 2.1.3. 传递函数依赖

假如 Z 函数依赖于 Y，且 Y 函数依赖于 X （严格来说还有一个 X 不包含于 Y，且 Y 不函数依赖于 Z 的前提条件），那么我们就称 Z 传递函数依赖于 X ，记作 ![image](http://otaivnlxc.bkt.clouddn.com/jpg/2018/2/12/7d9588250a61c21af97f5932e32d890d.jpg)。

### 2.2. 多值依赖

多值依赖有以下特性：
- 对称性
- 传递性
- 函数依赖可以看作多值依赖的特殊情况

## 3. 范式

关系数据库中的关系是要满足一定要求的，满足不同程度要求的为不同范式。数据库范式分为 1NF，2NF，3NF，BCNF，4NF，5NF。符合高一级范式的设计，必定符合低一级范式，例如符合 2NF 的关系模式，必定符合 1NF。

一般在我们设计关系型数据库的时候，最多考虑到 BCNF 就够。而实际上现在数据库的设计最多满足 3NF，普遍认为范式过高，虽然具有对数据关系更好的约束性，但也导致数据关系表增加而令数据库 IO 更易繁忙，原来交由数据库处理的关系约束现更多在数据库使用程序中完成。

![image](http://otaivnlxc.bkt.clouddn.com/jpg/2018/2/12/6166333ead1b73c2e0541b62e523f7f6.jpg)

### 3.1. 第一范式

第一范式是为了要排除重复组的出现，**要求数据库的每个列的值域都是由原子值组成，每个字段的值都只能是单一值**，即数据表都为二维表，符合 1NF 的关系中的每个属性都不可再分。

例：

不符合 1NF 的要求：

![image](http://otaivnlxc.bkt.clouddn.com/jpg/2018/2/12/60f773388513c0eb6c14a4ae55359906.jpg)

符合 1NF 的要求：

![image](http://otaivnlxc.bkt.clouddn.com/jpg/2018/2/12/70bd4aaeaecd1406a9fa25561cb2a974.jpg)

实际上，1NF 是所有关系型数据库的最基本要求，在关系型数据库管理系统（RDBMS），例如 SQL Server，Oracle，MySQL 中创建数据表的时候，如果数据表的设计不符合这个最基本的要求，那么操作一定是不能成功的。也就是说，只要在 RDBMS 中已经存在的数据表，一定是符合 1NF 的。

但如果数据库设计仅仅符合 1NF，会存在数据冗余过大，插入异常，删除异常，修改异常的问题，如：

![image](http://otaivnlxc.bkt.clouddn.com/jpg/2018/2/12/26136c2847a4df59b781e7e87b475cf2.jpg)

- 每一名学生的学号、姓名、系名、系主任这些数据重复多次。每个系与对应的系主任的数据也重复多次——数据冗余过大。
- 假如学校新建了一个系，但是暂时还没有招收任何学生（比如 3 月份就新建了，但要等到 8 月份才招生），那么是无法将系名与系主任的数据单独地添加到数据表中去的——插入异常。
- 假如将某个系中所有学生相关的记录都删除，那么所有系与系主任的数据也就随之消失了（一个系所有学生都没有了，并不表示这个系就没有了）——删除异常。
- 假如李小明转系到法律系，那么为了保证数据库中数据的一致性，需要修改三条记录中系与系主任的数据——修改异常。

### 3.2. 第二范式

第二范式**要求每一个非主属性完全函数依赖于任何一个候选码**。如果有哪些数据只和一个键的一部分有关的话，就得把它们独立出来变成另一个数据表。如果一个数据表的键只有单个字段的话，它就一定匹配第二范式。数据表设计符合第二范式当且仅当：符合第一范式且所有非键的字段都一定是候选键全体字段的函数。

2NF 在 1NF 的基础之上，消除了非主属性对于码的部分函数依赖，即非主属性不部分依赖于候选码，**必须是完全函数依赖**。

所有单关键字的表都符合 2NF。

根据 2NF 的定义，判断的依据实际上就是看数据表中是否存在非主属性对于码的部分函数依赖。若存在，则数据表最高只符合 1NF 的要求，若不存在，则符合 2NF 的要求。判断的方法是：
1. 找出数据表中所有的码。
1. 根据第一步所得到的码，找出所有的主属性。
1. 数据表中，除去所有的主属性，剩下的就都是非主属性了。
1. 查看是否存在非主属性对码的部分函数依赖。

为了让仅仅符合 1NF 的数据表符合 2NF 的要求，必须消除表中的部分函数依赖，**只有一个办法，就是将大数据表拆分成两个或者更多个更小的数据表，在拆分的过程中，要达到更高一级范式的要求，这个过程叫做”模式分解“。**模式分解的采取的具体方法不是唯一的。

### 3.3. 第三范式

第三范式要求所有**非主属性都只和候选码有相关性，也就是说每一个非主属性都不传递函数依赖于码**。

在 2NF 的基础之上，**消除了非主属性对于码的传递函数依赖。**

符合 3NF 要求的数据库设计，**基本上解决了数据冗余过大，插入异常，修改异常，删除异常的问题。**

数据的标准化有助于消除数据库中的数据冗余。标准化有好几种形式，但**Third Normal Form（3NF）通常被认为在性能、扩展性和数据完整性方面达到了最好平衡。**

### 3.4. BC 范式

通常认为 BCNF 是修正的 3NF，也称为扩充的 3NF。

BCNF 要求**主属性内部也不能部分或传递依赖，即非主键外的所有字段必须互不依赖。**

一个满足 BCNF 的关系模式有：
- 所有非主属性对每一个码都是完全函数依赖。
- 所有主属性对每一个不包含它的码也是完全函数依赖。
- 没有任何属性完全函数依赖于非码的任何一组属性。

简单判断方法：箭头左边的必须是候选码，不是候选码的就不是 BC 范式。

### 3.5. 第四范式

第二范式、第三范式、BC 范式关注于属性集合之间的函数依赖；而第四范式关注更一般形式，称作多值依赖。

4NF 就是限制关系模式的属性之间不允许有非平凡且非函数依赖的多值依赖。

### 3.6. 第五范式

### 3.7. DK 范式

### 3.8. 第六范式

## 4. 规范化

### 4.1. 规范化

一个低一级范式的关系模式通过模式分解可以转换为若干个高一级范式的关系模式的集合，这种过程即称为规范化。

规范化的基本思想是逐步消除数据依赖中不合适的部分，使模式中个关系模式达到某种程度的“分离”，即“一事一地”的模式设计原则。让一个关系描述一个概念、一个实体或实体间的一种联系。若多于一个概念就将它“分离”出去。因此，规范化实质上是概念的单一化。

人们认识这个原则是经历了一个过程的。从认识非主属性的部分函数依赖的危害开始，NF 的相继提出是这个认识过程逐步深化的标志：
- 1NF -> 2NF: 消除非主属性对码的部分函数依赖
- 2NF -> 3NF: 消除非主属性对码的传递函数依赖
- 3NF -> BCNF: 消除主属性对码的部分和传递函数依赖
- BCNF -> 4NF: 消除非平凡且非函数依赖的多值依赖

### 4.2. 模式分解

关系模式的规范化过程是通过对关系模式的分解来实现的，即把低一级的关系模式分解为若干个高一级的关系模式。

对一个模式的分解可以是多种多样的，但分解后产生的模式应与原模式等价。

分解的三条准则：
- 分解具有无损连接性
- 分解要保持函数依赖
- 分解既要保持函数依赖，又要具有无损连接性
按照不同的分解准则，模式能达到的分离程度各不相同，各种范式就是对分离程度的测度。

## 5. Refer Links

https://www.zhihu.com/question/24696366
