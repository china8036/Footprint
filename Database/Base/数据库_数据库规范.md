- [数据库：数据库规范](#)
  - [1. 命名规范](#1)
    - [1.1. 数据库命名规范](#11)
    - [1.2. 表命名规范](#12)
    - [1.3. 字段命名规范](#13)
  - [2. 表结构规范](#2)
    - [2.1. 数据类型选择](#21)
    - [2.2. 主键设计](#22)
      - [2.2.1. 主键设计原则](#221)
      - [2.2.2. 常用方案](#222)
    - [2.3. 其他](#23)
  - [3. 文档规范](#3)
  - [4. 业务规范](#4)
    - [4.1. 企业应用](#41)
    - [4.2. 互联网应用](#42)

# 数据库：数据库规范

## 1. 命名规范

基本规则：
- 命名字符采用 26 个英文字母（区分大小写) 和 0-9 这十个自然数，加上下划线'_'组成，共 63 个字符，不能出现其他字符。
- 命名不得超过 30 个字符的系统限制。变量名的长度限制为 29（不包括标识字符 @)。
- 数据对象、变量的命名都采用英文字符，禁止使用中文命名。

范例：

![image](http://otaivnlxc.bkt.clouddn.com/jpg/2018/4/29/12c09269e71e624bb484b267b7212734.jpg)

### 1.1. 数据库命名规范

规范：
- 数据库名采用前缀，前缀名称一般不超过 5 个字符。
- 使用小写英文以及下划线组成。
- 尽量能说明是那个应用或者系统在使用的。
- 备份数据库名使用正式库名加上备份时间组成。

举例：

### 1.2. 表命名规范

- 规范
  - 数据表名采用前缀，表前缀用项目名称首字母缩写，相关应用的数据表使用同一前缀，如论坛的表使用 cdb_前缀，博客的数据表使用 supe_前缀，前缀名称一般不超过 5 个字符。
  - 使用小写英文以及下划线组成，单词之间用下划线分开，单词都用单数形式。

- 常用约定表名
  - user – 用户
  - category – 分类
  - goods – 商品、产品等一切可交易网站的物品都用此命名
  - good_gallery – 物品的相册
  - good_cate – 物品的分类，除了单独作为表名，其他地方分类单词一律用缩写 cate
  - attr – 属性
  - article – 文章、新闻、帮助中心等以文章形式出现的，一般都用此命名
  - cart – 购物车
  - feedback – 用户反馈
  - order – 订单
  - site_nav – 包括页头和页尾导航
  - site_config – 系统配置表
  - admin – 后台用户 【RBAC 标准表】
  - role – 后台用户角色【RBAC 标准表】
  - access – 后台操作权限，相当于 action【RBAC 标准表】
  - role_admin – 后台用户对应的角色【RBAC 标准表】
  - access_role – 后台角色对应的权限【RBAC 标准表】

### 1.3. 字段命名规范

- 规范：
  - 使用小写英文以及下划线组成，单词之间用下划线分开，如 open_id, create_time。
  - 对应 java 代码中：采用驼峰命名规范，如 openId, createTime。
  - 表与表之间的相关联字段要用统一名称。

- 常用约定字段名：
  - 表名_id – 通常用作外键命名
  - cid – 特殊的编号，带有元数据，方便关联查询，你可以把它理解成类别（层次) 编号。举个例子，产品在分类时，往往需要将其归类到子分类下，相应的字段中也一般只记录子分类的 id，这时若需要知道该产品属于哪个主分类，就需要通过子分类信息再查询到主分类信息，这是比较麻烦的，cid 字段就是要解决这个问题。一般的站点几十个分类肯定是够用了，所以这里假设某一主分类的 cid 为 11，则子分类的 cid 从 1101 开始编号，处理时只需截取前两位数值便可知道该产品属于哪一个主分类了。
  - add_time – 添加时间、上架时间等
  - last_time – 最后操作时间，如登录、修改记录
  - expire_time – 过期时间
  - name – 商品名称、商家名称等，不要跟 title 混用，title 只用于文章标题、职称等
  - price – 价格
  - thumb – 只要是列表页面中的窗口图，一律用此命名
  - image_src – 相册中的图片地址一律用此命名，不要出现各种 img,image,img_url,thumb_url 等
  - head_thumb – 用户头像， 虽然有点长，一定要遵守。不要出现上述情况
  - image_alt – 相册中图片的 alt 属性
  - desc – 描述、简介，比如 goods_desc，不要出现 goods_txt 这种
  - details – 详情、文章内容等
  - order_id – 排序
  - telephone – 座机号码
  - mobile – 手机号码
  - phone – 当不区分手机和座机时，请用 phone 命名
  - address – 地址，单独出现不要用 addr 缩写，组合出现时需用缩写，比如 mac 地址，mac_addr
  - zipcode – 邮编
  - region – 地区，大的区域，比如记录杭州市、温州市等
  - area – 区域，小的，比如上城区，江干区等
  - avg_cost – 人均消费

## 2. 表结构规范

### 2.1. 数据类型选择

规则：用尽量少的存储空间来存数一个字段的数据。
- 能用 int 的就不用 char 或者 varchar 
- 能用 tinyint 的就不用 int 
- 能用 varchar(20) 的就不用 varchar(255) 
- 时间戳字段尽量用 int 型，如 created: 表示从'1970-01-01 08:00:00′开始的 int 秒数，采用英文单词的过去式；gmtCreated: 表示 datetime 类型的时间，即形如'1980-01-01 00:00:00′的时间串，Java 中对应的类型为 Timestamp

### 2.2. 主键设计

https://www.cnblogs.com/xiekeli/p/5398374.html 

#### 2.2.1. 主键设计原则

- 主键应当是对用户没有意义的。
- 主键应该是单列的，以便提高连接和筛选操作的效率。
- 永远也不要更新 MySQL 主键。
- 主键不应包含动态变化的数据，如时间戳、创建时间列、修改时间列等。
- 主键应当有计算机自动生成。

#### 2.2.2. 常用方案

- 自增 id
  优点：
  - 数据库自动编号，速度快，而且是增量增长，聚集型主键按顺序存放，对于检索非常有利。
  - 数字型，占用空间小，易排序，在程序中传递方便。
  缺点：
  - 不支持水平分片架构，水平分片的设计当中，这种方法显然不能保证全局唯一。
  - 表锁
  - 自增主键不连续
  - 泄露数据记录信息

- uuid
  
  优点：
  - 全局唯一性、安全性、可移植性。
  - 能够保证独立性，程序可以在不同的数据库间迁移，效果不受影响。
  - 保证生成的 ID 不仅是表独立的，而且是库独立的，在你切分数据库的时候尤为重要
  缺点：
  - 针对 InnoDB 引擎会徒增 IO 压力，InnoDB 为聚集主键类型的引擎，数据会按照主键进行排序，由于 UUID 的无序性，InnoDB 会产生巨大的 IO 压力。InnoDB 主键索引和数据存储位置相关（簇类索引），uuid 主键可能会引起数据位置频繁变动，严重影响性能。
  - UUID 长度过长，一个 UUID 占用 128 个比特（16 个字节）。主键索引 KeyLength 长度过大，而影响能够基于内存的索引记录数量，进而影响基于内存的索引命中率，而基于硬盘进行索引查询性能很差。严重影响数据库服务器整体的性能表现。

- 自定义序列表
  
  在库中建一张用于生成序列的表来存储序列信息，序列生成的策略通过程序层面来实现。

### 2.3. 其他

- 表中的第一个 id 字段一定是主键且为自动增长。
- 数值类型的字段请使用 UNSIGNED 属性。
- 排序字段 order_id 在程序中默认使用降序排列。
- 所有字段都设置 NOT NULL，并设置默认值。
- 所有的布尔值字段，如 is_hot、is_deleted，都必须设置一个默认值，并设为 0。
- 所有的数字类型字段，都必须设置一个默认值，并设为 0。
- 针对 varchar 类型字段的程序处理，请验证用户输入，不要超出其预设的长度。
- 建表时将数据字典中的字段中文名和属性备注写入数据表的备注中 (“PK、自动增长”不用写)。

## 3. 文档规范

所有数据库设计要写成文档，文档以模块化形式表达。大致格式如下： 
```sql
‘——————————————- 
‘ 表名： web_user 
‘ 作者： Aeolus（傻鱼) 
‘ 日期： 2007-04-11 
‘ 版本： 1.0 
‘ 描述： 保存用户资料 
‘ 具体内容： 
‘ UserID int, 自动增量 用户代码 
‘ UserName char(12) 用户名字 
‘ …… 
‘——————————————–
```

## 4. 业务规范

数据库应用领域基本分为两种：互联网高并发应用、企业内部业务管理应用；

### 4.1. 企业应用

在企业应用中，业务逻辑可适当放在数据库层。

如 SAP、peopleSoft、ERP 等企业级别应用，由于业务逻辑修改频繁，而且大多为通用，因此会使用存储过程和触发器，把一些业务逻辑编写成存储过程，减少开发成本；

服务器的负载是可控，即系统访问量可控且相对稳定，因此，性能的影响在这时不是主要因素；

### 4.2. 互联网应用

在互联网应用中，业务逻辑应完全放在应用层。

如淘宝、知乎、微博，数据库访问量和并发量都不可控制且量级一般较大，数据库的 I/O 是 web 应用的主要瓶颈，因此一般会尽可能的减少数据库的操作，把业务逻辑放到服务端的代码 / 应用层，而且可以借助一些 LVS 等类型软硬件做负载均衡，以及平滑增减 Web 层的服务器，从而减轻数据库压力，达到线性的增减而支持大规模的访问；
