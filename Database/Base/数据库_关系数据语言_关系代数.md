- [数据库：关系数据语言 - 关系代数](#%E6%95%B0%E6%8D%AE%E5%BA%93%EF%BC%9A%E5%85%B3%E7%B3%BB%E6%95%B0%E6%8D%AE%E8%AF%AD%E8%A8%80---%E5%85%B3%E7%B3%BB%E4%BB%A3%E6%95%B0)
  - [1. 传统的集合运算](#1-%E4%BC%A0%E7%BB%9F%E7%9A%84%E9%9B%86%E5%90%88%E8%BF%90%E7%AE%97)
    - [1.1. 并](#11-%E5%B9%B6)
    - [1.2. 差](#12-%E5%B7%AE)
    - [1.3. 交](#13-%E4%BA%A4)
    - [1.4. 笛卡尔积](#14-%E7%AC%9B%E5%8D%A1%E5%B0%94%E7%A7%AF)
  - [2. 专门的关系运算](#2-%E4%B8%93%E9%97%A8%E7%9A%84%E5%85%B3%E7%B3%BB%E8%BF%90%E7%AE%97)
    - [2.1. 选择 (σ)](#21-%E9%80%89%E6%8B%A9-%CF%83)
    - [2.2. 投影 (π)](#22-%E6%8A%95%E5%BD%B1-%CF%80)
    - [2.3. 连接 (⋈)](#23-%E8%BF%9E%E6%8E%A5-%E2%8B%88)
      - [2.3.1. 等值连接](#231-%E7%AD%89%E5%80%BC%E8%BF%9E%E6%8E%A5)
      - [2.3.2. 自然连接](#232-%E8%87%AA%E7%84%B6%E8%BF%9E%E6%8E%A5)
        - [2.3.2.1. 外连接](#2321-%E5%A4%96%E8%BF%9E%E6%8E%A5)
        - [2.3.2.2. 半连接](#2322-%E5%8D%8A%E8%BF%9E%E6%8E%A5)
    - [2.4. 除运算 (÷)](#24-%E9%99%A4%E8%BF%90%E7%AE%97-%C3%B7)

# 数据库：关系数据语言 - 关系代数

关系代数是一种抽象的查询语言，它用对关系的运算来表达查询。

经有限次复合运算后形成的表达式称为关系代数表达式。

关系代数的运算按照运算符的不同，可分为传统的集合运算和专门的关系运算。

## 1. 传统的集合运算

传统的集合运算将关系看成元组的集合，其运算是从关系的“水平”方向，即行的角度来进行。

### 1.1. 并

关系 R 和关系 S 的并记作：`R ∪ S = {t | t ∈ R ∨ t ∈ S}`。结果仍为 n 目关系，由属于 R 或属于 S 的元组组成。

### 1.2. 差

关系 R 和关系 S 的差记作：`R - S = {t | t ∈ R ∧ t ∉ S}`。结果仍为 n 目关系，由属于 R 而不属于 S 的所有元组组成。

### 1.3. 交

关系 R 和关系 S 的交记作：`R ∩ S = {t | t ∈ R ∧ t ∈ S}`。结果仍为 n 目关系，由属于 R 又属于 S 的元组组成。

### 1.4. 笛卡尔积

两个分别为 n 目与 m 目的关系 R 和 S 的笛卡尔积是一个 (m+n) 列的元组的集合。

关系 R 和关系 S 的笛卡尔积记作：`R x S = {trts | tr ∈ R ∧ ts ∈ S}`。结果为 `(m+n)` 目关系。

## 2. 专门的关系运算

专门的关系运算不仅涉及行，而且涉及列。

### 2.1. 选择 (σ)

选择运算实际上是从关系 R 中选取使逻辑表达式 F 为真的元组，是一种从行的角度进行的运算。

例：`σ age>20(Student)` 从 Student 表中查询 age 大于 20 的记录。

### 2.2. 投影 (π)

关系 R 上的投影是从 R 中选择出若干属性列组成新的关系，是一种从列的角度进行的运算。

例：`π name,age,gender(Student)`从 Student 表中显示包含 name、age、gender 列的所有记录。

### 2.3. 连接 (⋈)

连接也成为θ连接，它从两个关系的笛卡尔积中选取属性间满足一定条件的元组，即 `R ⋈θ S = σθ(R × S)`。

连接运算中最重要也最常用的连接：等值连接和自然连接。

#### 2.3.1. 等值连接
  
θ中的比较运算符为`=`的连接运算为等值连接。等值连接从关系 R 与 S 的广义笛卡尔积中选取 A、B 属性值相等的所有元组。

例：

| A    | B    | C    |
| ---- | ---- | ---- |
| a1   | b1   | 5    |
| a1   | b2   | 6    |
| a2   | b3   | 8    |
| a2   | b4   | 12   |

| B    | E    |
| ---- | ---- |
| b1   | 3    |
| b2   | 7    |
| b3   | 10   |
| b3   | 2    |
| b5   | 2    |

等值连接：

| A    | R.B  | C    | S.B  | E    |
| ---- | ---- | ---- | ---- | ---- |
| a1   | b1   | 5    | b1   | 3    |
| a1   | b2   | 6    | b2   | 7    |
| a2   | b3   | 8    | b3   | 10   |
| a2   | b3   | 8    | b3   | 2    |

#### 2.3.2. 自然连接
  
一种特殊的等值连接，它要求两个关系中进行比较的分量必须是同名的属性组，并且在结果中把重复的属性列去掉。

一般的连接运算是从行的角度进行运算，但自然连接还需要去除重复列，因此是同时对行和列进行运算。

悬浮元组：关系 R 和 S 在进行自然连接时，由于 R 中某些元组有可能在 S 中不存在公共属性上值相等的元组，从而造成 R 中这些元组在操作时被舍弃了，同理 S 中某些元组也可能被舍弃，这些被舍弃的元组称为悬浮元组。

例：自然连接

| A    | B    | C    | E    |
| ---- | ---- | ---- | ---- |
| a1   | b1   | 5    | 3    |
| a1   | b2   | 6    | 7    |
| a2   | b3   | 8    | 10   |
| a2   | b3   | 8    | 2    |

##### 2.3.2.1. 外连接
  
如果将悬浮元组也保存在结果关系中，而在其他属性上填空值 NULL，这种连接称为外连接。

例：外连接

| A    | B    | C    | E    |
| ---- | ---- | ---- | ---- |
| a1   | b1   | 5    | 3    |
| a1   | b2   | 6    | 7    |
| a2   | b3   | 8    | 10   |
| a2   | b3   | 8    | 2    |
| a2   | b4   | 12   | NULL |
| NULL | b5   | NULL | 2    |

##### 2.3.2.2. 半连接

- 左外连接
  
  如果只保留左边关系 R 中的悬浮元组，这种连接称为左外连接，记作`⋊`。

  例：左外连接

  | A    | B    | C    | E    |
  | ---- | ---- | ---- | ---- |
  | a1   | b1   | 5    | 3    |
  | a1   | b2   | 6    | 7    |
  | a2   | b3   | 8    | 10   |
  | a2   | b3   | 8    | 2    |
  | a2   | b4   | 12   | NULL |

- 右外连接
  
  如果只保留右边关系 S 中的悬浮元组，这种连接称为右外连接，记作`⋉`。

  例：右外连接

  | A    | B    | C    | E    |
  | ---- | ---- | ---- | ---- |
  | a1   | b1   | 5    | 3    |
  | a1   | b2   | 6    | 7    |
  | a2   | b3   | 8    | 10   |
  | a2   | b3   | 8    | 2    |
  | NULL | b5   | NULL | 2    |

### 2.4. 除运算 (÷)

设关系 R 除以关系 S 的结果为关系 T，则 T 包含所有在 R 但不在 S 中的属性及其值，且 T 的元组与 S 的元组的所有组合都在 R 中。

除操作是同时从行和列的角度进行运算。

例：

R

| A    | B    | C    |
| ---- | ---- | ---- |
| a1   | b1   | c2   |
| a2   | b3   | c7   |
| a3   | b4   | c6   |
| a1   | b2   | c3   |
| a4   | b6   | c6   |
| a2   | b2   | c3   |
| a1   | b2   | c1   |

S

| B    | C    | D    |
| ---- | ---- | ---- |
| b1   | c2   | d1   |
| b2   | c1   | d1   |
| b2   | c3   | d2   |

R ÷ S

| A    |
| ---- |
| a1   |