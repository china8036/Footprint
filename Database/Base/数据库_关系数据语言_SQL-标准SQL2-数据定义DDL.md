- [数据库：关系数据语言 - 标准 SQL - 数据定义 (DDL)](#数据库关系数据语言---标准-sql---数据定义-ddl)
  - [1. 模式的定义与删除](#1-模式的定义与删除)
    - [1.1. 模式的定义](#11-模式的定义)
    - [1.2. 模式的删除](#12-模式的删除)
  - [2. 表的定义、修改与删除](#2-表的定义修改与删除)
    - [2.1. 表的定义](#21-表的定义)
    - [2.2. 表的修改](#22-表的修改)
    - [2.3. 表的删除](#23-表的删除)
    - [2.4. 表的清空](#24-表的清空)
  - [3. 索引的建立、修改与删除](#3-索引的建立修改与删除)
    - [3.1. 建立索引](#31-建立索引)
    - [3.2. 修改索引](#32-修改索引)
    - [3.3. 删除索引](#33-删除索引)
  - [4. 视图的建立与删除](#4-视图的建立与删除)
    - [4.1. 定义视图](#41-定义视图)
      - [4.1.1. 建立视图](#411-建立视图)
      - [4.1.2. 删除视图](#412-删除视图)
    - [4.2. 查询视图](#42-查询视图)
    - [4.3. 更新视图](#43-更新视图)
  - [5. Refer Links](#5-refer-links)

# 数据库：关系数据语言 - 标准 SQL - 数据定义 (DDL)

关系数据库系统支持三级模式结构，其模式、外模式、内模式中的基本对象都有模式、表、视图、视图和索引等。因此，**SQL 的数据定义功能包括模式定义、表定义、视图定义和索引定义**：

- **SQL 标准只为表定义提供了修改操作，没有模式、视图、索引定义的修改操作**。因此，用户若希望修改这些对象，只能先将它们删除然后重建。
- **SQL 标准也没有提供索引相关的语句，但为提高查询效率，商用关系数据库管理系统通常都提供了索引机制和相关的语句**。

**一个关系数据库管理系统的实例中可以建立多个数据库，一个数据库中可以建立多个模式，一个模式下通常包含多个表、视图、索引等数据库对象**。

> 数据库 > 模式 > 表 / 视图 / 索引

## 1. 模式的定义与删除

### 1.1. 模式的定义

```sql
CREATE SCHEMA <schema_name> AUTHORIZATION <user_name>
```

**若没有指定模式名，则模式名隐含为用户名**。

**模式的定义实际上定义了一个命名空间**，在这个命名空间中可以进一步定义该模式包含的数据库对象，如基本表、视图、索引等。

### 1.2. 模式的删除

```sql
DROP SCHEAM <schema_name> <CASCADE | RESTRICTT>
```

其中，`CASCADE` 和 `RESTRICTT` 两者必选其一：
- `CASCADE`：级联，表示在删除模式的同时把该模式中所有的数据库对象全部删除。
- `RESTRICTT`：限制，表示如果该模式中已经定义了下属的数据库对象（如表、视图等），则拒绝该删除语句的执行。只有当该模式中没有任何下属的对象时才能执行 `DROP SCHEMA` 语句。

## 2. 表的定义、修改与删除

### 2.1. 表的定义

```sql
CREATE TABLE <table_name> （	列名 1 数据类型 列级完整性约束条件，
                              ...，
                              列名 n 数据类型 列级完整性约束条件，
                              表级完整性约束条件)
```

### 2.2. 表的修改

```sql
ALTER TABLE <table_name> 
ADD [COLUMN] 新列名 数据类型 完整性约束条件
ADD 表级完整性约束条件
DROP [COLUMN] [CASCADE | RESTRICTT]
DROP 表级完整性约束条件 [CASCADE | RESTRICTT]
ALTER COLUMN 列名 数据类型
```

### 2.3. 表的删除

> DROP TABLE removes one or more tables. You must have the DROP privilege for each table. Be careful with this statement! It removes the table definition and all table data. For a partitioned table, it permanently removes the table definition, all its partitions, and all data stored in those partitions. It also removes partition definitions associated with the dropped table.

`DROP` 语句会立即删除表的所有数据和整个表的结构定义。

```sql
DROP [TEMPORARY] TABLE [IF EXISTS]
    tbl_name [, tbl_name] ...
    [RESTRICT | CASCADE]
```
其中，CASCADE 和 RESTRICTT 两者必选其一：
- `CASCADE`：表示该表的删除没有限制条件。在删除基本表时，相关的依赖对象（如视图）都将被一起删除。
- `RESTRICTT`：表示该表的删除是有限制条件的。欲删除的表不能被其它表的约束所使用，不能有视图，不能有触发器，不能有存储过程或函数等。若存在这些依赖该表的对象，则此表不能被删除。

### 2.4. 表的清空

> TRUNCATE TABLE empties a table completely. It requires the DROP privilege. Logically, TRUNCATE TABLE is similar to a DELETE statement that deletes all rows, or a sequence of DROP TABLE and CREATE TABLE statements.

`TRUNCATE` 语句会清空整个表，但不会删除表结构定义，等效于 `DELETE *` 或 `DROP tbl_name; CREATE tbl_name`。

```sql
TRUNCATE [TABLE] tbl_name
```

## 3. 索引的建立、修改与删除

当表的数据量比较大时，查询操作会比较耗时，这种情况下建立索引是加快查询速度的有效手段，用户可以根据应用环境的需要在基本表上建立一个或多个索引，以提供多种存取路径，加快查找速度。

数据库索引有多种类型，常见索引包括以下几种：
- 顺序文件上的索引：针对按指定属性值升序或降序存储的关系，在该属性上建立一个顺序索引文件，索引文件由属性值和相应的元组指针组成。
- B+ 树索引：将索引属性组织成 B+ 树形式，B+ 树的叶结点为属性值和相应的元组指针。B+ 树索引具有动态平衡的优点。
- 散列索引：建立若干个桶，将索引属性按照其散列函数值映射到相应桶中，桶中存放索引属性值和相应的元组指针。散列索引具有速度快的优点。
- 位图索引：用位向量记录索引属性中可能出现的值，每个位向量对应一个可能值。

索引虽能加速数据库查询，但需要占用一定的存储空间，当基本表更新时，索引要进行相应的维护，这些操作都会相应地增加数据库的负担，因此要根据实际应用的需求有选择地创建索引。

**关系数据库管理系统在执行查询时会自动选择合适的索引作为存取路径，用户不必也不能显式地选择索引。因此，索引是关系数据库管理系统的内部实现技术，属于内模式的范畴。**

### 3.1. 建立索引

```sql
CREATE [UNIQUE] [CLUSTER] INDEX 索引名
ON 表名 ( 列名 次序，列名 次序 ... )
```
索引可建立在该表的一列或多列上，各列名之间用逗号分隔，每个列名后可以指定索引值的排列次序，可选 `ASC` 或 `DESC`。

`UNIQUE` 表示该索引的每一个索引值只对应唯一的数据记录。

`CLUSTER` 表示要建立的索引是聚簇索引。

### 3.2. 修改索引

对于已建立的索引，若需要对其进行重命名，可以通过修改索引实现：
```sql
ALTER INDEX 旧索引名 RENAME TO 新索引名
```

### 3.3. 删除索引

```sql
DROP INDEX 索引名
```
删除索引后，系统会同时从数据字典中删除有关该索引的描述（数据字典是关系数据库管理系统内部的一组系统表，它记录了数据库中所有的定义信息。执行 DDL 时，实际上就是在更新数据字典中的相应信息）。

## 4. 视图的建立与删除

视图是从一个或几个基本表（或视图）导出的表。**与基本表不同，视图是一个虚表，数据库中只存放视图的定义，而不存放视图对应的数据，这些数据仍存放在原来的基本表中**。

**视图就像一个窗口，透过它可以看到数据库中自己感兴趣的数据及其变化**。

合理使用视图能有许多好处：

- 简化用户操作
- 使用户能以多种角度看待同一数据
- 对重构数据库提供了一定程度的逻辑独立性
- 对机密数据提供安全保护
- 合理利用视图可以更清晰地表达查询

视图定义后，可以和基本表一样被查询、删除，还可以在视图上再定义新的视图，但对视图的更新操作则有一定的限制。

### 4.1. 定义视图

#### 4.1.1. 建立视图

```sql
CREATE VIEW 视图名 [( 列名，列名 ... )]
AS 子查询
[WITH CHECK OPTION];
```
其中，`WITH CHECK OPTION` 表示对视图进行更新、插入、删除操作时要保证相应的行满足视图定义中的谓词条件（即子查询中的条件表达式）。

#### 4.1.2. 删除视图

```sql
DROP VIEW 视图名 [CASCADE];`
```

### 4.2. 查询视图

视图定义后，可以像对基本表一样对视图进行查询。

关系数据库管理系统执行对视图的查询时，首先进行有效性检查，检查查询中涉及的表、视图等是否存在。如果存在，则从数据字典中去除视图的定义，把定义中的子查询和用户的查询结合起来，转换成等价的对基本表的查询，然后再执行修正了的查询。这一过程称为**视图消解**。

### 4.3. 更新视图

更新视图指的是通过视图来插入、删除、修改数据。

**由于视图是不实际存储数据的虚表，因此对视图的更新最终要转换成对基本表的更新。与视图查询类型，视图更新也需要通过视图消解，转换为对基本表的更新操作**。

在关系数据库中，并不是所有的视图都是可更新的，因为有些视图的更新不能唯一地有意义地转换成对相应基本表的更新。目前，各个关系数据库管理系统一般都只允许对行列子集视图进行更新，而且各个 DBMS 对视图的更新还有更进一步的规定。由于实现方法上的差异，这些规定都不尽相同。需要注意的是，不可更新的视图和不允许更新的视图是两个不同的概念。

## 5. Refer Links