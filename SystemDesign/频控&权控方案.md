- [权控 & 频控方案](#权控--频控方案)
	- [1. 权控](#1-权控)
	- [2. 频控](#2-频控)
	- [3. Refer Links](#3-refer-links)

# 权控 & 频控方案

频控和权控是一个健壮系统中不可或缺的部分。该模块一般位于处理请求的第一步，起到对后端业务限流保护的作用，因此稳定性和可用性是频控权控模块一个非常重要的衡量指标。

## 1. 权控

权限控制，是指根据不同业务（AppId）对不同服务（SDK）提供灵活的多粒度的访问权限控制。

业界鉴权方案分为三种：
- AppId + 明文 + Secret + rawData
	- 优点
		- 方案简单，方便用户接入
	- 缺点
		- rawData 可能被篡改
		- 明文 Secret 在网络上传输不安全
	- 应用场景较少

- AppId + 签名校验 + rawData

	签名校验的原理是，客户端和服务器端共有一个秘钥 SecretKey，该 SecretKey 不会在网络上进行传播。在客户端请求服务的过程中，客户端使用 SecretKey 通过哈希算法，得到 rawData 的签名串 AuthKey。然后客户端将生成的 AuthKey 和 rawData 一起发送给服务器端。在服务端，使用相同的 SecretKey 对 rawData 进行同样的哈希算法，然后比较生成的 AuthKey 和服务端传来的 AuthKey，如果相同，则证明 rawData 没有被篡改，这时可以判断该 AppId 有没有相应的访问权限。
	- 优点
		- 校验比较简单，能够防止 rawData 被篡改
	- 缺点
		- rawData 有泄露的风险，但对于敏感 rawData，可以采用 https 的方式提供对内容的加密保护
		- 需要在用户端实现签名串算法
	- 应用场景
		- 各类开放平台 API，如支付宝开放平台、腾讯开放平台等

- AppId + 密文
	- 优点
		- 能够在协议层面避免 rawData 泄露
	- 缺点
		- 实现复杂，加密成本高
	- 应用场景
		- 微信敏感数据 API，如 openId

## 2. 频控

频控系统可以对流量进行削峰整形，使进入后台服务的请求量在一个可以控制的范围内，防止后台出现过载甚至雪崩。此外，频控系统还可以控制各个业务的频控额度管理，提供差异化的服务。

频控的算法有计数法、漏桶算法、令牌桶法等，漏桶算法中，请求到来类似于向一个固定容积的桶中注入水，同时这个漏桶以固定的速率向下滴水（向后端发出请求），当桶中水溢出时（请求过多）请求将被丢弃。这样漏桶算法就可以平滑向后端请求的流量。令牌桶算法与漏桶算法类似，但是令牌桶算法可以允许向后端的一定量突发请求。

## 3. Refer Links