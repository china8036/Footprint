- [API 防刷方案](#api-防刷方案)
	- [1. 攻击意图](#1-攻击意图)
	- [2. 攻击方式](#2-攻击方式)
	- [3. 防刷方式](#3-防刷方式)
	- [4. Refer Links](#4-refer-links)

# API 防刷方案

## 1. 攻击意图

对接口进行攻击的原因一般有以下几种：
- SQL 注入、渗透检测
- 暴力破解、暴力猜解（比如猜测登录密码）
- 恶意刷接口（比如刷积分、刷订单、刷投票等）

## 2. 攻击方式

对接口进行请求的方式一般有以下几种：
- 对接口的某次请求进行多次重放，可用于多次发起扣款或加积分等
- 修改接口的请求参数之后再进行重放（常用于登录密码猜解或进行入侵、注入检测）

刷接口的方式一般有以下几种：
- 重放
	- 截获某个用户的网络请求，使用此请求包进行重放攻击
	- 抓取自己的 http 请求进行重放
- CSRF 来发起接口的恶意调用
- 使用软件或编程工具来实现模拟请求

## 3. 防刷方式

- 对于 CSRF 方式的刷接口行为，我们需要使用 CSRF 的策略来应对。比如 Access-Allow-Origin 只设置为自己网站的域名。

- 对于登录接口，我们可以限制 IP 调用频次，使用验证码或锁死用户。

- 对于非登录接口，无法使用验证码的机制来阻止，因此只能通过各种手段来增加他的调用成本：
	- 针对重放

		借鉴 CSRF 的思想，让前端每次请求带上一个随机生成的 nonce 字符串，服务端记录该字符串 10s 时间，10s 内该 nonce 只能使用一次。
		
		另外，在请求参数中，可以增加一个 timestamp 的参数。这个参数来自于页面中另外一个 api 接口的返回，一方面保证跟服务端时间一致，另一方面让我们的接口依赖一个业务上的前置接口，增加黑客的成本。 服务端会检测请求的时间戳，跟当前服务器时间超过 10s 之后的请求也视为非法。

	- 防止修改请求参数

		在前端请求里增加了 md5(timestamp+params) 的签名机制，从而使得黑客不能随意修改请求参数中的值进行重放。当然，理论上黑客也是可以研究出其中的签名算法的，不过这增加了黑客的成本。

	- 单 IP 的调用量限制

		如单 IP 单用户 10 分钟内调用超过 100 次，则限制 1 小时。

## 4. Refer Links